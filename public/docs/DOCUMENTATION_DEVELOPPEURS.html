<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation DÃ©veloppeurs OTT V3.3 - HAPPLYZ MEDICAL</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        .nav-menu a, a {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body::before {
            content: 'CONFIDENTIEL - HAPPLYZ MEDICAL SAS';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 3rem;
            color: rgba(0, 0, 0, 0.03);
            z-index: -1;
            pointer-events: none;
            white-space: nowrap;
        }
        
        @media print {
            body { display: none !important; }
        }
        
        .confidential-banner {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1500;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            box-shadow: 0 3px 15px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header .subtitle {
            font-size: 1.4rem;
            opacity: 0.95;
            margin-top: 0.5rem;
        }
        
        .header .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            margin-top: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .nav-menu {
            position: sticky;
            top: 0;
            background: #2c3e50;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 2000;
            margin-top: 0;
        }
        
        /* S'assurer que le menu reste au-dessus mÃªme lors du scroll */
        .nav-menu::before {
            content: '';
            position: absolute;
            top: -100vh;
            left: 0;
            right: 0;
            height: 100vh;
            background: transparent;
            pointer-events: none;
        }
        
        body {
            position: relative;
        }
        
        .nav-menu ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            margin: 0.3rem;
            border-radius: 5px;
            transition: background 0.3s, transform 0.2s;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .nav-menu a:hover {
            background: #34495e;
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .section {
            background: white;
            margin-bottom: 2rem;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section h2 {
            color: #667eea;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.8rem;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.7rem;
            margin: 2rem 0 1rem 0;
        }
        
        .section h4 {
            color: #667eea;
            font-size: 1.3rem;
            margin: 1.5rem 0 0.8rem 0;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
            font-size: 0.9rem;
        }
        
        code {
            background: #f4f4f4;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
        
        .alert {
            padding: 1.2rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 5px solid;
        }
        
        .alert-success { background: #d4edda; border-color: #28a745; color: #155724; }
        .alert-warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .alert-danger { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .alert-info { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 0.9rem;
            border-bottom: 1px solid #ddd;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        ul, ol { margin-left: 2rem; }
        li { margin: 0.5rem 0; }
        
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }
        
    </style>
</head>
<body>
    <script>
        // Protection contre la copie et les fuites
        (function() {
            // DÃ©sactiver le clic droit
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // DÃ©sactiver les raccourcis clavier de copie
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey && (e.key === 'c' || e.key === 'C' || e.key === 'a' || e.key === 'A' || e.key === 's' || e.key === 'S' || e.key === 'p' || e.key === 'P' || e.key === 'u' || e.key === 'U')) || 
                    e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j' || e.key === 'C' || e.key === 'c'))) {
                    e.preventDefault();
                    alert('âš ï¸ Cette documentation est confidentielle et protÃ©gÃ©e. La copie est interdite.');
                    return false;
                }
            });
            
            // DÃ©sactiver le glisser-dÃ©poser
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Avertissement au chargement
            window.addEventListener('load', function() {
                console.log('%câš ï¸ ATTENTION', 'color: red; font-size: 50px; font-weight: bold;');
                console.log('%cCette documentation est confidentielle et propriÃ©tÃ© de HAPPLYZ MEDICAL SAS. Toute reproduction, copie ou diffusion non autorisÃ©e est strictement interdite et peut entraÃ®ner des poursuites judiciaires.', 'color: red; font-size: 16px;');
            });
        })();
    </script>

<div class="confidential-banner">
    âš ï¸ DOCUMENTATION CONFIDENTIELLE - PROPRIÃ‰TÃ‰ DE HAPPLYZ MEDICAL SAS - TOUTE REPRODUCTION INTERDITE
</div>

<div class="header">
    <h1>ğŸ¥ OTT - Dispositif MÃ©dical IoT</h1>
    <div class="subtitle">Solution Enterprise de Monitoring OxygÃ©nothÃ©rapie</div>
    <div class="version-badge">Version 3.3 - Documentation DÃ©veloppeurs</div>
    <p style="margin-top: 1rem; font-size: 1.1rem;">HAPPLYZ MEDICAL SAS</p>
</div>

<nav class="nav-menu">
    <ul>
        <li><a href="#intro">ğŸ“– Introduction</a></li>
        <li><a href="#structure">ğŸ“ Structure</a></li>
        <li><a href="#architecture">ğŸ—ï¸ Architecture</a></li>
        <li><a href="#database">ğŸ—„ï¸ Base de DonnÃ©es</a></li>
        <li><a href="#firmware">ğŸ”§ Firmware ESP32</a></li>
        <li><a href="#firmware-workflow">âš™ï¸ Compilation & Flash</a></li>
        <li><a href="#api">ğŸ”Œ API Backend</a></li>
        <li><a href="#dashboard">âš›ï¸ Dashboard React</a></li>
        <li><a href="#compatibility">ğŸ”— CompatibilitÃ©</a></li>
        <li><a href="#roles-permissions">ğŸ” RÃ´les & Permissions</a></li>
        <li><a href="#measurements-queue">ğŸ“Š Queue Mesures</a></li>
        <li><a href="#deployment">â˜ï¸ DÃ©ploiement</a></li>
        <li><a href="#troubleshooting">ğŸ› DÃ©pannage</a></li>
        <li><a href="#roadmap">ğŸš€ Roadmap</a></li>
    </ul>
</nav>

<div class="container">

<section id="intro" class="section">
    <h2>ğŸ“– Introduction</h2>
    
    <p style="font-size: 1.15rem; margin-bottom: 1.5rem;">
        <strong>OTT (Oxygen Therapy Tracker)</strong> est un dispositif mÃ©dical IoT complet pour le monitoring 
        en temps rÃ©el de l'oxygÃ©nothÃ©rapie Ã  domicile. Solution 100% cloud, sÃ©curisÃ©e et conforme aux normes mÃ©dicales.
    </p>
    
    <div class="alert alert-info">
        <strong>â„¹ï¸ Documentation Technique</strong><br>
        Cette documentation est rÃ©servÃ©e aux dÃ©veloppeurs autorisÃ©s. Elle contient les dÃ©tails techniques, 
        l'architecture, les APIs, le firmware et les procÃ©dures de dÃ©ploiement.
    </div>
    
    <h3>ğŸ¯ Stack Technique</h3>
    <ul>
        <li><strong>Firmware</strong> : C++ / Arduino IDE / ESP32</li>
        <li><strong>Backend</strong> : PHP 8.2 / PostgreSQL 14</li>
        <li><strong>Frontend</strong> : Next.js 14 / React / Tailwind CSS</li>
        <li><strong>Infrastructure</strong> : Render.com (API) + GitHub Pages (Dashboard)</li>
        <li><strong>Communication</strong> : 4G/LTE (SIM7600) + HTTPS</li>
    </ul>
</section>

<section id="architecture" class="section">
    <h2>ğŸ—ï¸ Architecture Technique</h2>
    
    
    <h3>ğŸ“ Vue d'Ensemble</h3>
    
    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32 + SIM    â”‚  â† Firmware C++
â”‚   (Dispositif)  â”‚     â€¢ Mesure capteur MPXV7007DP
â”‚                 â”‚     â€¢ Sleep profond (111j autonomie)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ POST HTTPS via 4G
         â”‚
         â”‚ 4G/LTE
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API PHP       â”‚  â† Backend Render.com
â”‚   PostgreSQL    â”‚     â€¢ JWT Authentication
â”‚   (Render.com)  â”‚     â€¢ Multi-users + Permissions
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ OTA Management
         â”‚
         â”‚ REST API
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard      â”‚  â† Frontend Next.js
â”‚  React/Next.js  â”‚     â€¢ 12 pages complÃ¨tes
â”‚  (GitHub Pages) â”‚     â€¢ PWA installable
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ Animations modernes
    </pre>
    
    <h3>ğŸ” Flux de donnÃ©es</h3>
    <ul>
        <li><strong>Montant (device â†’ cloud)</strong> : le firmware mesure (dÃ©bit, batterie) toutes les 5 min, propage via HTTPS/JSON vers <code>/api.php/devices/measurements</code> et <code>/logs</code>.</li>
        <li><strong>PersistÃ©</strong> : l'API Docker (Render) Ã©crit en PostgreSQL (tables <code>devices</code>, <code>measurements</code>, <code>alerts</code>, <code>audit_logs</code>â€¦), via PDO.</li>
        <li><strong>Descendant</strong> : le Dashboard Next.js (GitHub Pages) appelle l'API (<code>NEXT_PUBLIC_API_URL</code>) pour stats, cartes, notifications, OTA.</li>
        <li><strong>Auth</strong> : Next.js poste sur <code>/api.php/auth/login</code>, stocke le JWT (LocalStorage) et <code>fetchWithAuth</code> ajoute <code>Authorization: Bearer ...</code> Ã  chaque requÃªte.</li>
    </ul>
    
    <h3>ğŸ“ Structure du Projet</h3>
    
    <div class="file-tree">
maxime/
â”œâ”€â”€ ğŸ“± FRONTEND (Next.js)
â”‚   â”œâ”€â”€ app/                      # Pages Next.js (App Router)
â”‚   â”œâ”€â”€ components/               # Composants rÃ©utilisables
â”‚   â”œâ”€â”€ contexts/                 # Contextes React (Auth, USB)
â”‚   â””â”€â”€ public/                   # Assets statiques
â”‚
â”œâ”€â”€ ğŸ”Œ BACKEND (PHP)
â”‚   â”œâ”€â”€ api.php                   # API REST complÃ¨te
â”‚   â”œâ”€â”€ sql/schema.sql            # Base PostgreSQL (14 tables)
â”‚   â””â”€â”€ Dockerfile                # Container pour Render
â”‚
â”œâ”€â”€ ğŸ”§ hardware/                  # MatÃ©riel & Firmware
â”‚   â”œâ”€â”€ firmware/                 # Firmwares compilÃ©s et uploadÃ©s (par version)
â”‚   â”‚   â””â”€â”€ v3.0/                 # Version 3.0 (actuelle)
â”‚   â”‚       â”œâ”€â”€ *.bin             # Firmwares compilÃ©s
â”‚   â”‚       â””â”€â”€ *.ino             # Firmwares uploadÃ©s
â”‚   â””â”€â”€ lib/                      # BibliothÃ¨ques externes (TinyGSM)
â”‚
â””â”€â”€ ğŸ“š DOCUMENTATION
    â”œâ”€â”€ DOCUMENTATION_PRESENTATION.html
    â”œâ”€â”€ DOCUMENTATION_DEVELOPPEURS.html
    â””â”€â”€ DOCUMENTATION_COMMERCIALE.html
    </div>
    
</section>

<section id="firmware" class="section">
    <h2>ğŸ”§ Firmware ESP32</h2>
    
    
    <h3>ğŸ“¦ MatÃ©riel Requis</h3>
    <ul>
        <li>Carte ESP32 + Modem 4G : LILYGO TTGO T-A7670G (~40â‚¬)</li>
        <li>Capteur de pression : MPXV7007DP (~15â‚¬)</li>
        <li>Batterie Li-Ion : 18650 2000mAh (~5â‚¬)</li>
        <li>Carte SIM 4G : Free Mobile (2â‚¬/mois)</li>
    </ul>
    
    <h3>ğŸ”‹ Optimisation Autonomie</h3>
    <p>Le firmware est optimisÃ© pour une <strong>autonomie de 111 jours</strong> sur batterie 2000mAh grÃ¢ce au deep sleep ESP32.</p>
    
    <h3>ğŸ“¦ Compilation et Flash du Firmware</h3>
    <p>Le firmware est Ã©crit en C++ (Arduino) et peut Ãªtre compilÃ© de deux faÃ§ons :</p>
    
    <h4>Option 1 : Compilation en .bin (RecommandÃ©)</h4>
    <p>Pour un flash direct via le dashboard ou esptool, compilez le firmware en fichier .bin :</p>
    <pre><code># Windows PowerShell
.\scripts\build_firmware_bin.ps1

# Le fichier .bin sera gÃ©nÃ©rÃ© dans hardware/firmware/v3.0/
# Exemple : ott_firmware_v3.0-rebuild_20250121.bin</code></pre>
    <p>Le fichier .bin peut ensuite Ãªtre :</p>
    <ul>
        <li>UploadÃ© via le modal "Flash USB" dans le dashboard</li>
        <li>FlashÃ© directement avec esptool : <code>esptool.py --port COM6 write_flash 0x1000 firmware.bin</code></li>
    </ul>
    
    <h4>Option 2 : Compilation et Upload Direct</h4>
    <p>Pour compiler et flasher directement via arduino-cli :</p>
    <pre><code># Windows PowerShell
.\scripts\flash_firmware.ps1 -Port COM6

# Ou manuellement
arduino-cli compile --fqbn esp32:esp32:esp32 hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino
arduino-cli upload --fqbn esp32:esp32:esp32 -p COM6 hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino</code></pre>
    
    <h3>ğŸ”Œ Communication USB et device_info</h3>
    <p>DÃ¨s la connexion USB, le firmware envoie automatiquement un message <code>device_info</code> contenant :</p>
    <ul>
        <li><strong>ICCID</strong> : Identifiant de la carte SIM (lu depuis la SIM si disponible)</li>
        <li><strong>Serial</strong> : NumÃ©ro de sÃ©rie du dispositif</li>
        <li><strong>firmware_version</strong> : Version du firmware (ex: "3.0-rebuild")</li>
        <li><strong>device_name</strong> : Nom du dispositif (gÃ©nÃ©rÃ© automatiquement)</li>
    </ul>
    <p>Format JSON envoyÃ© :</p>
    <pre><code>{
  "type": "device_info",
  "iccid": "89330123456789012345",
  "serial": "OTT-PIERRE-001",
  "firmware_version": "3.0-rebuild",
  "device_name": "OTT-2345"
}</code></pre>
    <p>Le dashboard reÃ§oit automatiquement ces informations et :</p>
    <ul>
        <li>Identifie le dispositif dans la base de donnÃ©es (par ICCID, Serial ou device_name)</li>
        <li>Met Ã  jour automatiquement le <code>firmware_version</code> dans la base si la version a changÃ©</li>
        <li>DÃ©marre automatiquement le streaming USB si un dispositif est dÃ©tectÃ©</li>
    </ul>
    
    <h3>ğŸ”„ Mise Ã  Jour Automatique du Firmware Version</h3>
    <p>Lorsqu'un dispositif USB est connectÃ© et envoie son <code>device_info</code>, le systÃ¨me :</p>
    <ol>
        <li>ReÃ§oit le message <code>device_info</code> via le port sÃ©rie USB</li>
        <li>Parse le JSON et extrait l'ICCID/Serial et la version firmware</li>
        <li>Recherche le dispositif correspondant dans la base de donnÃ©es</li>
        <li>Compare la version reÃ§ue avec celle enregistrÃ©e</li>
        <li>Met Ã  jour automatiquement <code>devices.firmware_version</code> via l'API si diffÃ©rent</li>
    </ol>
    <p>Cette mise Ã  jour est transparente et ne nÃ©cessite aucune action manuelle.</p>
</section>

<section id="api" class="section">
    <h2>ğŸ”Œ API Backend (PHP + PostgreSQL)</h2>
    
    
    <h3>ğŸ“Š Base de DonnÃ©es PostgreSQL</h3>
    <p>Le schÃ©ma comprend <strong>14 tables</strong> : devices, patients, measurements, alerts, device_logs, users, roles, permissions, etc.</p>
    
    <h3>ğŸ” Authentification JWT</h3>
    <p>L'API utilise <strong>JWT (JSON Web Tokens)</strong> pour l'authentification avec expiration 24h.</p>
    
    <h3>ğŸŒ Endpoints API Principaux</h3>
    <ul>
        <li><code>GET/POST/PUT/DELETE /api.php/devices</code> - Gestion des dispositifs</li>
        <li><code>GET/POST/PUT/DELETE /api.php/patients</code> - Gestion des patients</li>
        <li><code>POST /api.php/measurements</code> - Enregistrement des mesures</li>
        <li><code>GET/POST /api.php/alerts</code> - Gestion des alertes</li>
        <li><code>GET/POST/PUT/DELETE /api.php/users</code> - Gestion des utilisateurs (admin only)</li>
    </ul>
</section>

<section id="dashboard" class="section">
    <h2>âš›ï¸ Dashboard React (Next.js 14)</h2>
    
    
    <h3>ğŸ¨ Technologies UtilisÃ©es</h3>
    <ul>
        <li><strong>Next.js 14</strong> - Framework React avec App Router et export statique</li>
        <li><strong>Tailwind CSS</strong> - Design system utility-first</li>
        <li><strong>Chart.js</strong> - Graphiques interactifs</li>
        <li><strong>React Context</strong> - Gestion d'Ã©tat (AuthContext, UsbContext)</li>
        <li><strong>Service Worker</strong> - PWA avec cache offline</li>
        <li><strong>Web Serial API</strong> - Communication USB directe avec les dispositifs</li>
    </ul>
    
    <h3>ğŸ“± 12 Pages ComplÃ¨tes</h3>
    <p>Le dashboard comprend 12 pages : Login, Vue d'Ensemble, Dispositifs, Patients, Alertes, Carte, Historique, Rapports, Utilisateurs, OTA, Audit, Documentation.</p>
</section>

<section id="deployment" class="section">
    <h2>â˜ï¸ DÃ©ploiement</h2>
    
    <h3>ğŸ“¦ DÃ©ploiement API sur Render</h3>
    <h4>1. CrÃ©er la base PostgreSQL</h4>
    <ol>
        <li>Aller sur https://dashboard.render.com</li>
        <li>CrÃ©er un nouveau service PostgreSQL (Free tier)</li>
        <li>Noter les variables de connexion (DB_HOST, DB_NAME, DB_USER, DB_PASS)</li>
        <li>Appliquer la migration : <code>DATABASE_URL="postgresql://..." ./scripts/db_migrate.sh --seed</code></li>
    </ol>
    
    <h4>2. DÃ©ployer l'API PHP</h4>
    <ol>
        <li>CrÃ©er un nouveau service Web sur Render</li>
        <li>Connecter le repository GitHub</li>
        <li>Configurer avec Dockerfile (dÃ©jÃ  prÃ©sent)</li>
        <li>DÃ©finir les variables d'environnement :
            <ul>
                <li><code>DB_HOST</code>, <code>DB_NAME</code>, <code>DB_USER</code>, <code>DB_PASS</code></li>
                <li><code>JWT_SECRET</code> (gÃ©nÃ©rer via <code>openssl rand -hex 32</code>)</li>
                <li><code>AUTH_DISABLED=false</code> (production)</li>
                <li><code>ENABLE_DEMO_RESET=false</code> (production)</li>
            </ul>
        </li>
        <li>Le service sera disponible Ã  <code>https://ott-jbln.onrender.com</code></li>
    </ol>
    
    <h3>ğŸ“± DÃ©ploiement Dashboard</h3>
    <h4>Option 1 : GitHub Pages (Gratuit)</h4>
    <ol>
        <li>Configurer <code>.env.local</code> avec <code>NEXT_PUBLIC_API_URL=https://ott-jbln.onrender.com</code></li>
        <li>Build : <code>npm run build && npm run export</code></li>
        <li>Push vers GitHub (le dossier <code>out/</code> sera dÃ©ployÃ© automatiquement)</li>
        <li>Activer GitHub Pages dans les paramÃ¨tres du repository</li>
    </ol>
    
    <h4>Option 2 : Render (RecommandÃ© pour production)</h4>
    <ol>
        <li>CrÃ©er un nouveau service Web sur Render</li>
        <li>Utiliser <code>Dockerfile.dashboard</code> (si disponible) ou build Next.js standard</li>
        <li>Variables d'environnement :
            <ul>
                <li><code>NEXT_PUBLIC_API_URL=https://ott-jbln.onrender.com</code></li>
                <li><code>NEXT_PUBLIC_ENABLE_DEMO_RESET=false</code></li>
                <li><code>NODE_ENV=production</code></li>
            </ul>
        </li>
        <li>Auto-deploy activÃ© sur push vers <code>main</code></li>
    </ol>
    
    <h3>ğŸ’° CoÃ»ts Mensuels</h3>
    <table>
        <tr>
            <th>Service</th>
            <th>Plan</th>
            <th>Prix</th>
        </tr>
        <tr>
            <td>PostgreSQL (Render)</td>
            <td>Free</td>
            <td><strong>0â‚¬</strong></td>
        </tr>
        <tr>
            <td>API Backend (Render)</td>
            <td>Starter</td>
            <td><strong>7â‚¬/mois</strong></td>
        </tr>
        <tr>
            <td>Dashboard (GitHub Pages)</td>
            <td>Free</td>
            <td><strong>0â‚¬</strong></td>
        </tr>
        <tr>
            <td>Dashboard (Render - Optionnel)</td>
            <td>Starter</td>
            <td><strong>7â‚¬/mois</strong></td>
        </tr>
        <tr>
            <td>Carte SIM 4G</td>
            <td>-</td>
            <td><strong>2â‚¬/dispositif/mois</strong></td>
        </tr>
        <tr>
            <td colspan="2"><strong>TOTAL (GitHub Pages)</strong></td>
            <td><strong>7â‚¬/mois</strong></td>
        </tr>
        <tr>
            <td colspan="2"><strong>TOTAL (Render complet)</strong></td>
            <td><strong>14â‚¬/mois</strong></td>
        </tr>
    </table>
    
    <div class="alert alert-success">
        <strong>ğŸ‰ Ã‰conomie</strong><br>
        vs 10 000â‚¬/mois avec solutions cloud classiques !
    </div>
    
    <h3>âœ… VÃ©rification Post-DÃ©ploiement</h3>
    <ol>
        <li>VÃ©rifier que l'API rÃ©pond : <code>curl https://ott-jbln.onrender.com/api.php/health</code></li>
        <li>VÃ©rifier que le dashboard se charge : <code>https://ymora.github.io/OTT/</code></li>
        <li>Tester la connexion : Le dashboard doit pouvoir se connecter Ã  l'API</li>
        <li>VÃ©rifier les CORS : L'API doit autoriser l'origine du dashboard</li>
    </ol>
</section>

<section id="troubleshooting" class="section">
    <h2>ğŸ› DÃ©pannage</h2>
    
    <h3>ğŸ”§ ProblÃ¨mes Courants</h3>
    
    <h4>ğŸ“± Firmware / Dispositif</h4>
    <ul>
        <li><strong>Modem not responding</strong> : VÃ©rifier l'antenne 4G et la carte SIM</li>
        <li><strong>Dispositif n'apparaÃ®t pas</strong> :
            <ol>
                <li>VÃ©rifier l'ICCID cÃ´tÃ© firmware (aprÃ¨s <code>SIM READY</code>, journaliser <code>modem.getSimCCID()</code>)</li>
                <li>S'assurer que le POST mesure cible bien l'API (<code>https://ott-jbln.onrender.com/api.php/devices/measurements</code>)</li>
                <li>Observer la rÃ©ponse API (en succÃ¨s : <code>{ success: true, device_id: &lt;id&gt; }</code>)</li>
                <li>Confirmer cÃ´tÃ© dashboard : rechercher l'ICCID sur la page "Dispositifs"</li>
                <li>Si toujours absent : relancer <code>scripts/db_migrate.sh --seed</code></li>
            </ol>
        </li>
        <li><strong>OTA Ã©choue</strong> : VÃ©rifier la connexion rÃ©seau, le MD5 du firmware, et les logs sÃ©rie</li>
        <li><strong>USB non dÃ©tectÃ©</strong> : VÃ©rifier que le navigateur supporte Web Serial API (Chrome/Edge), autoriser l'accÃ¨s au port</li>
    </ul>
    
    <h4>ğŸŒ API / Backend</h4>
    <ul>
        <li><strong>JWT verification failed</strong> : Token expirÃ©, se reconnecter</li>
        <li><strong>Failed to fetch</strong> : VÃ©rifier que l'API est en ligne et les headers CORS</li>
        <li><strong>Database connection failed</strong> : VÃ©rifier les variables d'environnement (DB_HOST, DB_NAME, DB_USER, DB_PASS)</li>
        <li><strong>500 Internal Server Error</strong> : VÃ©rifier les logs Render, souvent liÃ© Ã  une erreur SQL ou une variable manquante</li>
    </ul>
    
    <h4>âš›ï¸ Dashboard / Frontend</h4>
    <ul>
        <li><strong>Build Next.js Ã©choue</strong> : Supprimer le cache (<code>rm -rf .next node_modules</code>) et rÃ©installer les dÃ©pendances</li>
        <li><strong>Page blanche</strong> : VÃ©rifier la console du navigateur, souvent liÃ© Ã  une erreur JavaScript ou une variable d'environnement manquante</li>
        <li><strong>DonnÃ©es ne se chargent pas</strong> : VÃ©rifier <code>NEXT_PUBLIC_API_URL</code> dans <code>.env.local</code></li>
        <li><strong>Authentification Ã©choue</strong> : VÃ©rifier que l'API est accessible et que <code>JWT_SECRET</code> est correct</li>
    </ul>
    
    <h4>ğŸ—„ï¸ Base de DonnÃ©es</h4>
    <ul>
        <li><strong>Migration Ã©choue</strong> : VÃ©rifier <code>DATABASE_URL</code>, s'assurer que la base existe</li>
        <li><strong>Tables manquantes</strong> : Relancer <code>scripts/db_migrate.sh</code></li>
        <li><strong>DonnÃ©es corrompues</strong> : Utiliser le bouton "RÃ©initialiser la base de dÃ©mo" (si activÃ©) ou relancer les seeds</li>
    </ul>
    
    <h3>ğŸ” Outils de Diagnostic</h3>
    <ul>
        <li><strong>Page /diagnostics</strong> : Affiche l'Ã©tat de l'API, la base de donnÃ©es, et les variables d'environnement</li>
        <li><strong>Console navigateur</strong> : VÃ©rifier les erreurs JavaScript et les appels API</li>
        <li><strong>Logs Render</strong> : VÃ©rifier les logs du service API pour les erreurs backend</li>
        <li><strong>Network tab</strong> : VÃ©rifier les requÃªtes HTTP et leurs rÃ©ponses</li>
    </ul>
    
    <h3>ğŸ“‹ Checklist de VÃ©rification</h3>
    <ol>
        <li><strong>Backend Render</strong> : DB_HOST/PORT/NAME/USER/PASS renseignÃ©s, JWT_SECRET dÃ©fini, AUTH_DISABLED=false</li>
        <li><strong>Base de donnÃ©es</strong> : <code>psql $DATABASE_URL -c "SELECT COUNT(*) FROM measurements;"</code> retourne > 0</li>
        <li><strong>Frontend local</strong> : <code>.env.local</code> pointe vers l'API, <code>npm run lint && npm run build</code> passent</li>
        <li><strong>Frontend GitHub Pages</strong> : <code>npm run export</code> avant push, vÃ©rifier que le dashboard se charge</li>
    </ol>
</section>

<section id="screenshots" class="section">
    <h2>ğŸ“¸ Captures d'Ã‰cran de l'Interface</h2>
    
    <p>Cette section prÃ©sente les diffÃ©rentes vues de l'interface utilisateur et les modals disponibles dans le dashboard OTT.</p>
    
    <h3>ğŸ” Page de Connexion</h3>
    <p>La page d'authentification avec formulaire de connexion sÃ©curisÃ© :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/login.png" alt="Page de connexion" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Page de connexion avec authentification JWT</p>
    </div>
    
    <h3>ğŸ  Vue d'Ensemble (Dashboard)</h3>
    <p>La page principale avec les indicateurs clÃ©s et les graphiques :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/dashboard-overview.png" alt="Vue d'ensemble" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Vue d'ensemble avec KPI, graphiques et actions requises</p>
    </div>
    
    <h3>ğŸ”Œ Page Dispositifs</h3>
    <p>La liste des dispositifs avec leurs statuts et informations :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/devices-list.png" alt="Liste des dispositifs" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Liste des dispositifs avec recherche et filtres</p>
    </div>
    
    <h3>ğŸ¥ Page Patients</h3>
    <p>La gestion des patients avec leurs dispositifs associÃ©s :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/patients-list.png" alt="Liste des patients" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Liste des patients avec recherche, crÃ©ation, modification, assignation/dÃ©sassignation de dispositifs. Interface simplifiÃ©e sans alertes (accessibles via le modal de dÃ©tails du dispositif).</p>
    </div>
    
    <h3>ğŸ“ Carte Interactive</h3>
    <p>La visualisation gÃ©ographique des dispositifs :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/map.png" alt="Carte interactive" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Carte Leaflet avec marqueurs des dispositifs</p>
    </div>
    
    <h3>âš ï¸ Page Alertes</h3>
    <p>La liste des alertes avec leurs statuts :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/alerts.png" alt="Page alertes" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Gestion des alertes avec filtres et actions</p>
    </div>
    
    <h3>ğŸ‘¥ Page Utilisateurs</h3>
    <p>La gestion des utilisateurs et des permissions :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/users.png" alt="Page utilisateurs" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Gestion des utilisateurs avec rÃ´les, permissions, statut actif/inactif et derniÃ¨re connexion. Interface simplifiÃ©e sans alertes (accessibles via le modal de dÃ©tails dispositif).</p>
    </div>
    
    <h3>ğŸ”„ Page OTA</h3>
    <p>La gestion des mises Ã  jour OTA :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/ota.png" alt="Page OTA" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Gestion des mises Ã  jour OTA des dispositifs</p>
    </div>
    
    <h3>ğŸ“ Modals</h3>
    
    <h4>Modal CrÃ©ation/Ã‰dition Patient</h4>
    <p>Le modal pour crÃ©er ou modifier un patient :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-patient.png" alt="Modal patient" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de crÃ©ation/Ã©dition de patient avec formulaire complet</p>
    </div>
    
    <h4>Modal DÃ©tails Dispositif</h4>
    <p>Le modal avec les dÃ©tails complets d'un dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-device-details.png" alt="Modal dÃ©tails dispositif" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal avec onglets : DÃ©tails, Alertes, Logs, Commandes, Streaming USB</p>
    </div>
    
    <h4>Modal Assignation Dispositif</h4>
    <p>Le modal pour assigner un dispositif Ã  un patient :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-assign-device.png" alt="Modal assignation" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal d'assignation d'un dispositif libre Ã  un patient</p>
    </div>
    
    <h4>Modal CrÃ©ation/Ã‰dition Utilisateur</h4>
    <p>Le modal pour crÃ©er ou modifier un utilisateur :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-user.png" alt="Modal utilisateur" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de crÃ©ation/Ã©dition d'utilisateur avec gestion des rÃ´les</p>
    </div>
    
    <h4>Modal DÃ©sassignation Dispositif</h4>
    <p>Le modal pour dÃ©sassigner un dispositif d'un patient :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-unassign-device.png" alt="Modal dÃ©sassignation" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de confirmation pour dÃ©sassigner un dispositif d'un patient</p>
    </div>
    
    <h4>Modal Commande Dispositif</h4>
    <p>Le modal pour envoyer une commande Ã  un dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-command.png" alt="Modal commande" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal d'envoi de commandes (SET_SLEEP_SECONDS, PING, UPDATE_CONFIG, etc.)</p>
    </div>
    
    <h4>Modal Flash USB</h4>
    <p>Le modal pour le flash USB et le streaming sÃ©rie en temps rÃ©el :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-usb-streaming.png" alt="Modal flash USB" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de flash USB avec sÃ©lection de port sÃ©rie, choix de firmware, et terminal sÃ©rie avec filtres de logs et export</p>
    </div>
    
    <h4>Modal Upload Firmware</h4>
    <p>Le modal pour tÃ©lÃ©verser un nouveau firmware :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-upload-firmware.png" alt="Modal upload firmware" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de tÃ©lÃ©versement de firmware avec version, notes et option stable/beta</p>
    </div>
    
    <h4>Modal DÃ©tails Dispositif - Onglet Alertes</h4>
    <p>L'onglet Alertes du modal de dÃ©tails dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-device-alerts.png" alt="Modal alertes dispositif" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Onglet Alertes du modal de dÃ©tails avec liste des alertes du dispositif</p>
    </div>
    
    <h4>Modal DÃ©tails Dispositif - Onglet Journal</h4>
    <p>L'onglet Journal du modal de dÃ©tails dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-device-logs.png" alt="Modal logs dispositif" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Onglet Journal du modal de dÃ©tails avec historique des logs du dispositif</p>
    </div>
</section>

<section id="security" class="section">
    <h2>ğŸ”’ SÃ©curitÃ© & Permissions</h2>
    
    <h3>ğŸ›¡ï¸ SÃ©curitÃ© ComplÃ¨te de l'Application</h3>
    
    <p>L'application OTT implÃ©mente une sÃ©curitÃ© multi-niveaux pour protÃ©ger les donnÃ©es mÃ©dicales sensibles et garantir l'intÃ©gritÃ© du systÃ¨me.</p>
    
    <h4>1. ğŸ” Authentification et Autorisation</h4>
    
    <ul>
        <li><strong>JWT (JSON Web Tokens)</strong> : Tokens signÃ©s avec HMAC-SHA256, expiration 24h, vÃ©rification cÃ´tÃ© serveur</li>
        <li><strong>Passwords hashÃ©s</strong> : Bcrypt avec cost 10, jamais stockÃ©s en clair</li>
        <li><strong>SystÃ¨me de permissions</strong> : RÃ´les (admin, mÃ©decin, technicien) avec permissions granulaires</li>
        <li><strong>VÃ©rification d'activitÃ©</strong> : Seuls les utilisateurs actifs peuvent se connecter</li>
        <li><strong>Audit des connexions</strong> : Toutes les tentatives de connexion sont enregistrÃ©es</li>
    </ul>
    
    <h4>2. ğŸ›¡ï¸ Protection des DonnÃ©es</h4>
    
    <ul>
        <li><strong>SQL Injection Protection</strong> : 100% des requÃªtes utilisent PDO::prepare() avec paramÃ¨tres liÃ©s</li>
        <li><strong>Chiffrement HTTPS</strong> : Toutes les communications sont chiffrÃ©es</li>
        <li><strong>Soft Delete</strong> : Suppression logique pour rÃ©cupÃ©ration des donnÃ©es</li>
        <li><strong>Validation des donnÃ©es</strong> : Validation stricte cÃ´tÃ© serveur et client</li>
    </ul>
    
    <h3>ğŸ“Š Tableau RÃ©capitulatif des Droits par RÃ´le</h3>
    
    <p>Le systÃ¨me OTT utilise un systÃ¨me de permissions granulaires avec 3 rÃ´les principaux. Voici un rÃ©capitulatif complet des droits d'accÃ¨s pour chaque type d'utilisateur :</p>
    
    <table style="width: 100%; border-collapse: collapse; margin: 2rem 0; font-size: 0.95rem;">
        <thead>
            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;">FonctionnalitÃ© / Action</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #ddd;">ğŸ‘‘ Admin</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #ddd;">ğŸ‘¨â€âš•ï¸ MÃ©decin</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #ddd;">ğŸ”§ Technicien</th>
            </tr>
        </thead>
        <tbody>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ“Š VUE D'ENSEMBLE</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Consulter le tableau de bord (KPI, graphiques)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ”Œ DISPOSITIFS</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir la liste des dispositifs</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir les dÃ©tails d'un dispositif (statut, batterie, historique)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Modifier les informations d'un dispositif (nom, patient assignÃ©)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">DÃ©clencher une mise Ã  jour OTA (Over-The-Air)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Envoyer des commandes aux dispositifs (SET_SLEEP_SECONDS, PING, etc.)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ¥ PATIENTS</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir la liste des patients</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">CrÃ©er un nouveau patient</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Modifier les informations d'un patient</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Assigner un dispositif Ã  un patient</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ‘¥ UTILISATEURS</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir la liste des utilisateurs</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">CrÃ©er un nouvel utilisateur</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">GÃ©rer les rÃ´les et permissions des utilisateurs</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
            </tr>
        </tbody>
    </table>
    
    <div class="alert alert-info" style="margin-top: 2rem;">
        <strong>ğŸ’¡ Note importante :</strong>
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li><strong>Admin</strong> : AccÃ¨s complet Ã  toutes les fonctionnalitÃ©s. Seul rÃ´le pouvant gÃ©rer les utilisateurs et consulter l'audit.</li>
            <li><strong>MÃ©decin</strong> : AccÃ¨s en lecture/Ã©criture aux patients et dispositifs, mais pas aux fonctions techniques (OTA, commandes, firmware). Peut rÃ©soudre les alertes.</li>
            <li><strong>Technicien</strong> : AccÃ¨s technique complet (OTA, commandes, configuration, firmware) mais ne peut pas gÃ©rer les utilisateurs ni supprimer des patients/dispositifs.</li>
        </ul>
    </div>
</section>

<section id="structure" class="section">
    <h2>ğŸ“ Structure du Projet</h2>
    
    <h3>ğŸ¯ Organisation Principale</h3>
    <pre><code>maxime/
â”œâ”€â”€ ğŸ“± app/                          # Application Next.js (Frontend)
â”‚   â”œâ”€â”€ dashboard/                   # Pages du dashboard
â”‚   â”‚   â”œâ”€â”€ firmware-upload/         # Upload & compilation firmware
â”‚   â”‚   â”œâ”€â”€ devices/                 # Gestion dispositifs
â”‚   â”‚   â”œâ”€â”€ patients/                # Gestion patients
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ layout.js                    # Layout principal
â”‚
â”œâ”€â”€ ğŸ”§ api.php                       # API Backend PHP (monolithique)
â”‚
â”œâ”€â”€ ğŸ“¦ components/                   # Composants React rÃ©utilisables
â”‚   â”œâ”€â”€ FlashUSBModal.js             # Modal flash USB
â”‚   â”œâ”€â”€ Sidebar.js                   # Menu navigation
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ¨ contexts/                     # Contextes React (Ã©tat global)
â”‚   â”œâ”€â”€ AuthContext.js               # Authentification
â”‚   â””â”€â”€ UsbContext.js                # Gestion USB
â”‚
â”œâ”€â”€ ğŸ“š lib/                          # BibliothÃ¨ques utilitaires
â”‚   â”œâ”€â”€ api.js                       # Helpers API
â”‚   â”œâ”€â”€ config.js                    # Configuration
â”‚   â”œâ”€â”€ usbDevices.js                # Mapping USB devices
â”‚   â”œâ”€â”€ measurementSender.js         # Envoi mesures robuste
â”‚   â””â”€â”€ measurementQueue.js         # Queue mesures (IndexedDB)
â”‚
â”œâ”€â”€ ğŸ”Œ hardware/                     # MatÃ©riel & Firmware
â”‚   â”œâ”€â”€ firmware/                    # Firmware source et compilÃ©s
â”‚   â”‚   â”œâ”€â”€ fw_ott_optimized/        # Code source du firmware (versionnÃ©)
â”‚   â”‚   â”‚   â””â”€â”€ fw_ott_optimized.ino # Source principale v3.0-rebuild
â”‚   â”‚   â””â”€â”€ v3.0/                    # Firmwares compilÃ©s et uploadÃ©s (non versionnÃ©)
â”‚   â”‚       â”œâ”€â”€ *.bin                 # Firmwares compilÃ©s
â”‚   â”‚       â””â”€â”€ *.ino                 # Firmwares uploadÃ©s via dashboard
â”‚   â”œâ”€â”€ lib/                         # BibliothÃ¨ques externes (TinyGSM)
â”‚   â”œâ”€â”€ cad/                         # Plans CAO (STL, PDF)
â”‚   â””â”€â”€ docs/                        # Documentation matÃ©riel
â”‚
â”œâ”€â”€ ğŸ—„ï¸ sql/                          # SchÃ©mas & migrations base de donnÃ©es
â”‚   â”œâ”€â”€ schema.sql                   # SchÃ©ma principal
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ› ï¸ scripts/                     # Scripts utilitaires
â”‚   â”œâ”€â”€ build_firmware_bin.ps1       # Compile .ino â†’ .bin
â”‚   â”œâ”€â”€ flash_firmware.ps1           # Flash direct
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“„ public/                       # Fichiers statiques
â”‚   â”œâ”€â”€ DOCUMENTATION_*.html         # Documentation (3 fichiers)
â”‚   â””â”€â”€ screenshots/                 # Captures d'Ã©cran
â”‚
â”œâ”€â”€ ğŸ³ Dockerfile                    # Image Docker API
â”œâ”€â”€ ğŸ“‹ README.md                     # Documentation principale
â””â”€â”€ âš™ï¸ package.json                  # DÃ©pendances Node.js</code></pre>
    
    <h3>ğŸ“ Chemins Importants</h3>
    <ul>
        <li><strong>Firmware Source</strong> : <code>hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino</code> (v3.0-rebuild)</li>
        <li><strong>Firmwares CompilÃ©s</strong> : <code>hardware/firmware/vX.X/*.bin</code> (organisÃ©s par version)</li>
        <li><strong>Firmwares UploadÃ©s</strong> : <code>hardware/firmware/vX.X/*.ino</code> (organisÃ©s par version)</li>
        <li><strong>BibliothÃ¨ques</strong> : <code>hardware/lib/TinyGSM/</code></li>
        <li><strong>Scripts Build</strong> : <code>scripts/build_firmware_bin.ps1</code> et <code>scripts/flash_firmware.ps1</code></li>
    </ul>
    
    <h3>ğŸ”„ Workflow RecommandÃ©</h3>
    <h4>Pour un dÃ©veloppeur :</h4>
    <ol>
        <li>Modifier le firmware source : <code>hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino</code></li>
        <li>Compiler localement : <code>.\scripts\build_firmware_bin.ps1</code> (gÃ©nÃ¨re un .bin dans <code>hardware/firmware/v3.0/</code>)</li>
        <li>Tester : <code>.\scripts\flash_firmware.ps1 -Port COM6</code></li>
        <li>Ou uploader via dashboard : Menu "Firmware" â†’ Upload .ino â†’ Compilation automatique</li>
    </ol>
    
    <h4>Pour un admin/technicien :</h4>
    <ol>
        <li>Upload .ino : Menu "Firmware" â†’ Upload fichier</li>
        <li>Compilation automatique : Logs en direct</li>
        <li>Flash : Page "Dispositifs" â†’ SÃ©lectionner firmware â†’ OTA ou USB</li>
    </ol>
</section>

<section id="database" class="section">
    <h2>ğŸ—„ï¸ Base de DonnÃ©es PostgreSQL</h2>
    
    <h3>ğŸ“ SchÃ©ma Relationnel</h3>
    <p>Base PostgreSQL pour le systÃ¨me OTT - Gestion de dispositifs mÃ©dicaux IoT avec notifications, OTA, et audit.</p>
    
    <h4>ğŸ” Authentification & Permissions</h4>
    <ul>
        <li><strong>roles</strong> : RÃ´les utilisateurs (admin, medecin, technicien)</li>
        <li><strong>permissions</strong> : Permissions systÃ¨me (devices.view, patients.edit, etc.)</li>
        <li><strong>role_permissions</strong> : Table de liaison roles â†” permissions</li>
        <li><strong>users</strong> : Utilisateurs du systÃ¨me</li>
    </ul>
    
    <h4>ğŸ‘¥ Patients</h4>
    <ul>
        <li><strong>patients</strong> : Patients suivis</li>
        <li><strong>patient_notifications_preferences</strong> : PrÃ©fÃ©rences de notifications des patients</li>
    </ul>
    
    <h4>ğŸ“± Dispositifs</h4>
    <ul>
        <li><strong>devices</strong> : Dispositifs IoT OTT (PK: id, UNIQUE: sim_iccid, device_serial)</li>
        <li><strong>device_configurations</strong> : Configuration des dispositifs (firmware, OTA, calibration)</li>
        <li><strong>measurements</strong> : Mesures de dÃ©bit et batterie</li>
        <li><strong>alerts</strong> : Alertes systÃ¨me (batterie faible, offline, etc.)</li>
        <li><strong>device_logs</strong> : Logs Ã©vÃ©nements dispositifs</li>
        <li><strong>device_commands</strong> : Commandes envoyÃ©es aux dispositifs</li>
    </ul>
    
    <h4>ğŸ”„ Firmwares</h4>
    <ul>
        <li><strong>firmware_versions</strong> : Versions de firmware disponibles (PK: id, UNIQUE: version)</li>
    </ul>
    
    <h4>ğŸ“§ Notifications</h4>
    <ul>
        <li><strong>user_notifications_preferences</strong> : PrÃ©fÃ©rences de notifications des utilisateurs</li>
        <li><strong>notifications_queue</strong> : File d'attente des notifications Ã  envoyer</li>
    </ul>
    
    <h4>ğŸ“ Audit</h4>
    <ul>
        <li><strong>audit_logs</strong> : Logs d'audit de toutes les actions</li>
    </ul>
    
    <h3>ğŸ” Vues (Views)</h3>
    <ul>
        <li><strong>device_stats</strong> : Statistiques agrÃ©gÃ©es des dispositifs</li>
        <li><strong>users_with_roles</strong> : Utilisateurs enrichis avec rÃ´les et permissions</li>
    </ul>
    
    <h3>ğŸ”— RÃ¨gles de Cascade</h3>
    <p>Les suppressions en cascade sont configurÃ©es pour garantir l'intÃ©gritÃ© des donnÃ©es :</p>
    <ul>
        <li>Suppression d'un device â†’ suppression automatique des measurements, alerts, logs, commands associÃ©s</li>
        <li>Suppression d'un patient â†’ les devices associÃ©s ont leur patient_id mis Ã  NULL (ON DELETE SET NULL)</li>
        <li>Suppression d'un utilisateur â†’ les audit_logs conservent l'user_id (ON DELETE SET NULL)</li>
    </ul>
    
    <div class="alert alert-info">
        <strong>ğŸ“Š Statistiques</strong><br>
        - Total tables : 16<br>
        - Total vues : 2<br>
        - Total relations : 20+<br>
        - Index : 6<br>
        - Triggers : 7 (mise Ã  jour automatique de updated_at)
    </div>
</section>

<section id="firmware-workflow" class="section">
    <h2>ğŸ”§ Compilation et Flash du Firmware</h2>
    
    <h3>ğŸ“¤ Workflow Complet</h3>
    <p>Le systÃ¨me permet un workflow complet de gestion du firmware depuis le dashboard :</p>
    
    <h4>1. Upload du fichier .ino</h4>
    <ol>
        <li>Un admin/technicien se connecte au dashboard</li>
        <li>AccÃ¨de au menu "Firmware" (visible uniquement pour admin/technicien)</li>
        <li>Clique sur "Upload Firmware" et sÃ©lectionne un fichier <code>.ino</code></li>
        <li>Le fichier est uploadÃ© vers <code>hardware/firmware/vX.X/</code> avec extraction automatique de la version</li>
        <li>Un enregistrement est crÃ©Ã© dans la table <code>firmware_versions</code> avec le statut <code>pending_compilation</code></li>
    </ol>
    
    <h4>2. Compilation en Direct (SSE)</h4>
    <ol>
        <li>AprÃ¨s l'upload, la compilation dÃ©marre automatiquement</li>
        <li>Les logs de compilation sont streamÃ©s en temps rÃ©el via <strong>Server-Sent Events (SSE)</strong></li>
        <li>L'utilisateur voit la progression en direct dans une fenÃªtre dÃ©diÃ©e</li>
        <li>Le systÃ¨me utilise <code>arduino-cli</code> pour compiler le <code>.ino</code> en <code>.bin</code></li>
        <li>Le fichier <code>.bin</code> est gÃ©nÃ©rÃ© dans <code>hardware/firmware/vX.X/</code> (mÃªme dossier que le .ino)</li>
        <li>Le statut est mis Ã  jour Ã  <code>compiled</code> dans la base de donnÃ©es</li>
    </ol>
    
    <h4>3. Flash du Firmware</h4>
    <p>Une fois compilÃ©, le firmware peut Ãªtre flashÃ© de deux maniÃ¨res :</p>
    
    <h5>Via OTA (Over-The-Air)</h5>
    <ol>
        <li>Aller dans la page "Dispositifs"</li>
        <li>Ouvrir les dÃ©tails d'un dispositif en ligne</li>
        <li>Dans l'onglet "DÃ©tails", section "Flash Firmware"</li>
        <li>SÃ©lectionner le firmware compilÃ©</li>
        <li>Cliquer sur "Flash OTA"</li>
        <li>Le firmware est tÃ©lÃ©chargÃ© et flashÃ© via le rÃ©seau 4G</li>
    </ol>
    
    <h5>Via USB</h5>
    <ol>
        <li>Connecter le dispositif en USB</li>
        <li>Aller dans la page "Dispositifs"</li>
        <li>Ouvrir les dÃ©tails du dispositif connectÃ©</li>
        <li>Dans l'onglet "DÃ©tails", section "Flash Firmware"</li>
        <li>SÃ©lectionner le firmware compilÃ©</li>
        <li>Cliquer sur "Flash USB"</li>
        <li>Le firmware est flashÃ© directement via le port sÃ©rie USB</li>
    </ol>
    
    <h3>ğŸ”Œ Communication USB et device_info</h3>
    <p>Lors de la connexion USB, le firmware envoie automatiquement ses informations au format JSON :</p>
    <pre><code>{
  "type": "device_info",
  "iccid": "89330123456789012345",
  "serial": "OTT-1234",
  "firmware_version": "3.0-rebuild",
  "device_name": "OTT-1234"
}</code></pre>
    
    <p>Ces informations sont automatiquement :</p>
    <ul>
        <li>ParsÃ©es par le dashboard</li>
        <li>UtilisÃ©es pour identifier le dispositif dans la base de donnÃ©es</li>
        <li>Mises Ã  jour dans la base si le dispositif existe dÃ©jÃ </li>
    </ul>
    
    <h3>ğŸ”„ Mise Ã  Jour Automatique du Firmware Version</h3>
    <p>Lorsqu'un dispositif envoie un message <code>device_info</code> avec une version de firmware :</p>
    <ol>
        <li>Le dashboard reÃ§oit le message via USB</li>
        <li>La version est extraite du JSON</li>
        <li>Un callback est dÃ©clenchÃ© pour mettre Ã  jour la base de donnÃ©es</li>
        <li>Le champ <code>firmware_version</code> du dispositif est mis Ã  jour automatiquement</li>
        <li>La configuration du dispositif (<code>device_configurations</code>) est Ã©galement mise Ã  jour</li>
    </ol>
    
    <div class="alert alert-success">
        <strong>âœ… Avantages</strong><br>
        - Pas besoin de mise Ã  jour manuelle de la version<br>
        - Synchronisation automatique entre firmware et base de donnÃ©es<br>
        - TraÃ§abilitÃ© complÃ¨te des versions installÃ©es
    </div>
</section>

<section id="compatibility" class="section">
    <h2>ğŸ”— CompatibilitÃ© Firmware â†” API â†” Dashboard</h2>
    
    <h3>âœ… CompatibilitÃ© Firmware â†” API</h3>
    <h4>Format ICCID</h4>
    <ul>
        <li><strong>Firmware</strong> : Envoie <code>device_sim_iccid</code> dans le payload JSON et <code>X-Device-ICCID</code> dans les headers HTTP</li>
        <li><strong>API</strong> : Accepte <code>device_sim_iccid</code> OU <code>sim_iccid</code> dans le payload</li>
        <li><strong>Validation</strong> : Max 20 caractÃ¨res (VARCHAR(20) en base)</li>
    </ul>
    
    <h4>Payload Mesures</h4>
    <p>Le firmware envoie :</p>
    <pre><code>{
  "sim_iccid": "89330123456789012345",
  "flowrate": 2.34,
  "battery": 85.5,
  "rssi": -75,
  "firmware_version": "v2.0",
  "timestamp": "2025-01-15T10:30:00Z",
  "status": "TIMER"
}</code></pre>
    
    <p>L'API accepte :</p>
    <ul>
        <li><code>sim_iccid</code> OU <code>device_sim_iccid</code> âœ…</li>
        <li><code>flowrate</code> OU <code>flow</code> OU <code>payload.flowrate</code> âœ…</li>
        <li><code>battery</code> OU <code>payload.battery</code> âœ…</li>
        <li><code>signal_strength</code> OU <code>rssi</code> âœ…</li>
        <li><code>firmware_version</code> (optionnel) âœ…</li>
    </ul>
    
    <h3>âœ… CompatibilitÃ© Firmware â†” Dashboard</h3>
    <h4>Endpoints API</h4>
    <table>
        <tr>
            <th>Endpoint Firmware</th>
            <th>Endpoint API</th>
            <th>MÃ©thode</th>
            <th>Statut</th>
        </tr>
        <tr>
            <td><code>/api.php/devices/measurements</code></td>
            <td><code>/api.php/devices/measurements</code></td>
            <td>POST</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>/api.php/devices/{ICCID}/commands/pending</code></td>
            <td><code>/api.php/devices/{iccid}/commands/pending</code></td>
            <td>GET</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>/api.php/devices/commands/ack</code></td>
            <td><code>/api.php/devices/commands/ack</code></td>
            <td>POST</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>/api.php/devices/logs</code></td>
            <td><code>/api.php/devices/logs</code></td>
            <td>POST</td>
            <td>âœ…</td>
        </tr>
    </table>
    
    <h4>Commandes SupportÃ©es</h4>
    <table>
        <tr>
            <th>Commande</th>
            <th>Firmware</th>
            <th>Dashboard</th>
            <th>Statut</th>
        </tr>
        <tr>
            <td><code>SET_SLEEP_SECONDS</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>PING</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>UPDATE_CONFIG</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>UPDATE_CALIBRATION</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>OTA_REQUEST</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
    </table>
    
    <h4>Enregistrement Automatique des Dispositifs</h4>
    <p>Lorsqu'un dispositif envoie sa premiÃ¨re mesure ou log :</p>
    <ul>
        <li>âœ… Le dispositif est automatiquement dÃ©tectÃ© et enregistrÃ© dans la base de donnÃ©es</li>
        <li>âœ… Aucune configuration manuelle requise</li>
        <li>âœ… Les informations (ICCID, firmware_version, battery, etc.) sont capturÃ©es automatiquement</li>
        <li>âœ… Le statut est dÃ©fini Ã  <code>active</code> par dÃ©faut</li>
    </ul>
</section>

<section id="roles-permissions" class="section">
    <h2>ğŸ” RÃ´les et Permissions</h2>
    
    <h3>ğŸ‘‘ Administrateur (admin)</h3>
    <p><strong>AccÃ¨s complet Ã  toutes les fonctionnalitÃ©s</strong></p>
    <ul>
        <li>âœ… Gestion complÃ¨te des utilisateurs (crÃ©ation, modification, suppression)</li>
        <li>âœ… Gestion complÃ¨te des dispositifs (crÃ©ation, modification, suppression, OTA)</li>
        <li>âœ… Gestion complÃ¨te des patients (crÃ©ation, modification, suppression)</li>
        <li>âœ… Configuration systÃ¨me et paramÃ¨tres</li>
        <li>âœ… AccÃ¨s au journal d'audit complet</li>
        <li>âœ… Gestion des firmwares et dÃ©ploiements OTA</li>
        <li>âœ… RÃ©solution de toutes les alertes</li>
        <li>âœ… Export de toutes les donnÃ©es</li>
    </ul>
    <p><strong>Utilisateurs :</strong> Maxime, Yann (2 admins maximum)</p>
    
    <h3>ğŸ”§ Technicien (technicien)</h3>
    <p><strong>Maintenance et configuration des dispositifs</strong></p>
    <h4>âœ… Permissions</h4>
    <ul>
        <li><strong>Dispositifs</strong> : Voir, modifier, configurer, envoyer commandes, OTA</li>
        <li><strong>Alertes</strong> : Voir toutes les alertes, rÃ©soudre les alertes techniques</li>
        <li><strong>Rapports</strong> : Voir les rapports techniques</li>
    </ul>
    <h4>âŒ Restrictions</h4>
    <ul>
        <li>Ne peut pas gÃ©rer les patients</li>
        <li>Ne peut pas gÃ©rer les utilisateurs</li>
        <li>Ne peut pas accÃ©der au journal d'audit complet</li>
        <li>Ne peut pas modifier les paramÃ¨tres systÃ¨me</li>
    </ul>
    <p><strong>Utilisateurs :</strong> 3 techniciens maximum</p>
    
    <h3>ğŸ‘¨â€âš•ï¸ MÃ©decin (medecin)</h3>
    <p><strong>Consultation des patients et suivi mÃ©dical</strong></p>
    <h4>âœ… Permissions</h4>
    <ul>
        <li><strong>Patients</strong> : Voir tous les patients, modifier les donnÃ©es, exporter</li>
        <li><strong>Dispositifs</strong> : Voir la liste et les dÃ©tails (lecture seule)</li>
        <li><strong>Rapports</strong> : Voir les rapports mÃ©dicaux, exporter</li>
        <li><strong>Alertes</strong> : Voir les alertes (lecture seule)</li>
    </ul>
    <h4>âŒ Restrictions</h4>
    <ul>
        <li>Ne peut pas modifier les dispositifs</li>
        <li>Ne peut pas effectuer d'OTA ou envoyer des commandes</li>
        <li>Ne peut pas gÃ©rer les utilisateurs</li>
        <li>Ne peut pas accÃ©der au journal d'audit complet</li>
        <li>Ne peut pas rÃ©soudre les alertes techniques</li>
    </ul>
    <p><strong>Utilisateurs :</strong> 2 mÃ©decins maximum</p>
    
    <h3>ğŸ“Š Tableau des Permissions</h3>
    <table>
        <tr>
            <th>Permission</th>
            <th>Code</th>
            <th>Admin</th>
            <th>Technicien</th>
            <th>MÃ©decin</th>
        </tr>
        <tr>
            <td colspan="5"><strong>Dispositifs</strong></td>
        </tr>
        <tr>
            <td>Voir dispositifs</td>
            <td><code>devices.view</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td>Modifier dispositifs</td>
            <td><code>devices.edit</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
        </tr>
        <tr>
            <td>Mises Ã  jour OTA</td>
            <td><code>devices.ota</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
        </tr>
        <tr>
            <td colspan="5"><strong>Patients</strong></td>
        </tr>
        <tr>
            <td>Voir patients</td>
            <td><code>patients.view</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td>Modifier patients</td>
            <td><code>patients.edit</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td colspan="5"><strong>Utilisateurs</strong></td>
        </tr>
        <tr>
            <td>GÃ©rer utilisateurs</td>
            <td><code>users.manage</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âŒ</td>
        </tr>
        <tr>
            <td colspan="5"><strong>Audit</strong></td>
        </tr>
        <tr>
            <td>Voir audit</td>
            <td><code>audit.view</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âŒ</td>
        </tr>
    </table>
</section>

<section id="measurements-queue" class="section">
    <h2>ğŸ“Š SystÃ¨me de Queue de Mesures (IndexedDB)</h2>
    
    <h3>ğŸ”„ MÃ©canisme de Retry Robuste</h3>
    <p>Le systÃ¨me implÃ©mente un mÃ©canisme robuste pour garantir l'envoi des mesures mÃªme en cas de problÃ¨me rÃ©seau :</p>
    
    <h4>1. Queue Locale (IndexedDB)</h4>
    <ul>
        <li>Les mesures sont stockÃ©es localement dans IndexedDB si le rÃ©seau est indisponible</li>
        <li>La queue est persistante (survit aux redÃ©marrages du navigateur)</li>
        <li>Les mesures sont automatiquement rÃ©essayÃ©es lorsque le rÃ©seau revient</li>
    </ul>
    
    <h4>2. Retry avec Exponential Backoff</h4>
    <ul>
        <li>En cas d'Ã©chec, le systÃ¨me attend avant de rÃ©essayer</li>
        <li>Le dÃ©lai d'attente augmente exponentiellement : 1s, 2s, 4s, 8s, 16s, 32s (max)</li>
        <li>Maximum 5 tentatives avant de considÃ©rer l'Ã©chec comme dÃ©finitif</li>
    </ul>
    
    <h4>3. Validation des DonnÃ©es</h4>
    <ul>
        <li>Les donnÃ©es sont validÃ©es avant l'envoi (ICCID requis, valeurs numÃ©riques valides)</li>
        <li>Les mesures invalides sont rejetÃ©es et ne sont pas ajoutÃ©es Ã  la queue</li>
    </ul>
    
    <h3>ğŸ“ˆ AmÃ©liorations des Statistiques</h3>
    <p>Les graphiques ont Ã©tÃ© amÃ©liorÃ©s pour afficher plus d'informations :</p>
    
    <h4>Statistiques AffichÃ©es</h4>
    <ul>
        <li><strong>Min</strong> : Valeur minimale sur la pÃ©riode</li>
        <li><strong>Max</strong> : Valeur maximale sur la pÃ©riode</li>
        <li><strong>Moy</strong> : Valeur moyenne sur la pÃ©riode</li>
        <li><strong>Dernier</strong> : DerniÃ¨re valeur enregistrÃ©e</li>
    </ul>
    
    <h4>PrÃ©vention du DÃ©bordement</h4>
    <ul>
        <li>Les graphiques ont des limites dÃ©finies pour Ã©viter le dÃ©bordement</li>
        <li>L'axe Y est limitÃ© Ã  0-100% pour la batterie</li>
        <li>Le nombre de ticks sur l'axe X est limitÃ© Ã  10 pour Ã©viter l'encombrement</li>
    </ul>
    
    <h4>Tooltips AmÃ©liorÃ©s</h4>
    <ul>
        <li>Les tooltips affichent les unitÃ©s (L/min ou %)</li>
        <li>Formatage des nombres avec sÃ©parateurs de milliers</li>
    </ul>
</section>

<section id="roadmap" class="section">
    <h2>ğŸš€ Roadmap & AmÃ©liorations Futures</h2>
    
    <div class="alert alert-success">
        <strong>âœ… Version 3.3 (Actuelle - 2025)</strong><br>
        Version actuellement dÃ©ployÃ©e avec les fonctionnalitÃ©s suivantes :
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li>âœ… PWA installable (manifest.json, service worker)</li>
            <li>âœ… Streaming USB en temps rÃ©el avec UsbContext</li>
            <li>âœ… DÃ©tection automatique des dispositifs USB (Web Serial API)</li>
            <li>âœ… Dashboard React/Next.js complet avec authentification JWT</li>
            <li>âœ… Gestion multi-utilisateurs avec permissions granulaires</li>
            <li>âœ… API REST complÃ¨te avec PostgreSQL</li>
            <li>âœ… Mise Ã  jour OTA (Over-The-Air) du firmware</li>
            <li>âœ… Carte interactive Leaflet avec gÃ©olocalisation</li>
            <li>âœ… SystÃ¨me d'alertes et notifications</li>
        </ul>
    </div>
    
    <h3>ğŸ“… Version 3.4 (Q2-Q3 2025)</h3>
    
    <h4>ğŸ” SÃ©curitÃ© AvancÃ©e</h4>
    <ul>
        <li>âœ¨ Authentification 2FA (Google Authenticator, SMS)</li>
        <li>âœ¨ Rotation automatique JWT secrets (90 jours)</li>
        <li>âœ¨ Logs d'audit avancÃ©s avec alertes automatiques</li>
        <li>âœ¨ DÃ©tection d'activitÃ©s suspectes</li>
    </ul>
    
    <h4>ğŸ“± PWA AmÃ©liorÃ©e</h4>
    <ul>
        <li>âœ¨ Notifications Push natives</li>
        <li>âœ¨ Mode offline complet (sync automatique)</li>
        <li>âœ¨ IcÃ´nes PWA personnalisÃ©es</li>
        <li>âœ¨ Installable sur iOS sans restrictions</li>
    </ul>
    
    <h4>ğŸ“Š Analytics & BI</h4>
    <ul>
        <li>âœ¨ Dashboard analytics avancÃ©</li>
        <li>âœ¨ PrÃ©dictions ML (pannes, batteries)</li>
        <li>âœ¨ Export automatique vers Excel/PDF</li>
        <li>âœ¨ Rapports programmÃ©s (hebdo, mensuel)</li>
    </ul>
    
    <h3>ğŸ“… Version 3.5 (Q4 2025)</h3>
    
    <h4>ğŸŒ Internationalisation</h4>
    <ul>
        <li>âœ¨ Support multi-langues (EN, ES, DE)</li>
        <li>âœ¨ Timezone awareness complet</li>
        <li>âœ¨ Formats de date localisÃ©s</li>
    </ul>
    
    <h4>âš¡ Performance</h4>
    <ul>
        <li>âœ¨ Migration vers TypeScript</li>
        <li>âœ¨ Server-Side Rendering (SSR)</li>
        <li>âœ¨ Optimisation base de donnÃ©es (indices)</li>
        <li>âœ¨ CDN pour assets statiques</li>
    </ul>
    
    <h3>ğŸ“… Version 4.0 (Q4 2026)</h3>
    
    <h4>ğŸ¤– Intelligence Artificielle</h4>
    <ul>
        <li>âœ¨ DÃ©tection anomalies automatique (ML)</li>
        <li>âœ¨ Maintenance prÃ©dictive</li>
        <li>âœ¨ Chatbot support intÃ©grÃ©</li>
        <li>âœ¨ Recommandations personnalisÃ©es</li>
    </ul>
    
    <h4>ğŸ¥ ConformitÃ© MÃ©dicale</h4>
    <ul>
        <li>âœ¨ Certification CE MÃ©dical Classe IIa</li>
        <li>âœ¨ ConformitÃ© RGPD complÃ¨te (audit externe)</li>
        <li>âœ¨ HDS (HÃ©bergement DonnÃ©es de SantÃ©)</li>
        <li>âœ¨ ISO 13485 (QualitÃ© dispositifs mÃ©dicaux)</li>
    </ul>
</section>

</div>

<div class="footer">
    <p style="font-size: 1.3rem; margin-bottom: 0.5rem;"><strong>Â© 2025 HAPPLYZ MEDICAL SAS</strong></p>
    <p>OTT - Version 3.3 Enterprise | Documentation DÃ©veloppeurs</p>
    <p style="margin-top: 1rem; font-size: 1rem; font-weight: bold;">
        ğŸ“š Documentation :
        <a href="DOCUMENTATION_PRESENTATION.html" style="color: white; text-decoration: underline; margin: 0 0.5rem;">ğŸ“¸ PrÃ©sentation</a> | 
        <a href="DOCUMENTATION_DEVELOPPEURS.html" style="color: white; text-decoration: underline; margin: 0 0.5rem;">ğŸ’» DÃ©veloppeurs</a> | 
        <a href="DOCUMENTATION_COMMERCIALE.html" style="color: white; text-decoration: underline; margin: 0 0.5rem;">ğŸ’¼ Commerciale</a>
    </p>
    <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        ğŸŒ <a href="https://ymora.github.io/OTT/" style="color: white; text-decoration: underline;">Dashboard Live</a>
    </p>
</div>

</body>
</html>

