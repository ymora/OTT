<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation DÃ©veloppeurs OTT v1.0 - HAPPLYZ MEDICAL</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Scrollbar personnalisÃ©e visible */
        html {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.4) rgba(0, 0, 0, 0.15);
        }
        
        html::-webkit-scrollbar {
            width: 14px;
        }
        
        html::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 7px;
        }
        
        html::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 7px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        
        html::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.6);
            background-clip: padding-box;
        }
        
        /* Dark mode scrollbar */
        html.dark {
            scrollbar-color: rgba(255, 255, 255, 0.4) rgba(255, 255, 255, 0.15);
        }
        
        html.dark::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.15);
        }
        
        html.dark::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.4);
            background-clip: padding-box;
        }
        
        html.dark::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.6);
            background-clip: padding-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        .nav-menu a, a {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body::before {
            content: 'CONFIDENTIEL - HAPPLYZ MEDICAL SAS';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 3rem;
            color: rgba(0, 0, 0, 0.03);
            z-index: -1;
            pointer-events: none;
            white-space: nowrap;
        }
        
        @media print {
            body { display: none !important; }
        }
        
        .confidential-banner {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1500;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            box-shadow: 0 3px 15px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header .subtitle {
            font-size: 1.4rem;
            opacity: 0.95;
            margin-top: 0.5rem;
        }
        
        .header .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            margin-top: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .nav-menu {
            position: sticky;
            top: 0;
            background: #2c3e50;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 2000;
            margin-top: 0;
        }
        
        /* S'assurer que le menu reste au-dessus mÃªme lors du scroll */
        .nav-menu::before {
            content: '';
            position: absolute;
            top: -100vh;
            left: 0;
            right: 0;
            height: 100vh;
            background: transparent;
            pointer-events: none;
        }
        
        body {
            position: relative;
        }
        
        .nav-menu ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            margin: 0.3rem;
            border-radius: 5px;
            transition: background 0.3s, transform 0.2s;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .nav-menu a:hover {
            background: #34495e;
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .section {
            background: white;
            margin-bottom: 2rem;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section h2 {
            color: #667eea;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.8rem;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.7rem;
            margin: 2rem 0 1rem 0;
        }
        
        .section h4 {
            color: #667eea;
            font-size: 1.3rem;
            margin: 1.5rem 0 0.8rem 0;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
            font-size: 0.9rem;
        }
        
        code {
            background: #f4f4f4;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
        
        .alert {
            padding: 1.2rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 5px solid;
        }
        
        .alert-success { background: #d4edda; border-color: #28a745; color: #155724; }
        .alert-warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .alert-danger { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .alert-info { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 0.9rem;
            border-bottom: 1px solid #ddd;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        ul, ol { margin-left: 2rem; }
        li { margin: 0.5rem 0; }
        
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #e0e0e0;
            }
            
            body::before {
                color: rgba(255, 255, 255, 0.03);
            }
            
            .section {
                background: #2d2d2d;
                color: #e0e0e0;
            }
            
            .section h2 {
                color: #9d8aff;
            }
            
            .section h3 {
                color: #b794f6;
            }
            
            .section h4 {
                color: #9d8aff;
            }
            
            code {
                background: #3d3d3d;
                color: #ff79c6;
            }
            
            .alert-success { background: #1e4620; border-color: #28a745; color: #90ee90; }
            .alert-warning { background: #4a3d00; border-color: #ffc107; color: #ffd700; }
            .alert-danger { background: #4a1e1e; border-color: #dc3545; color: #ff6b6b; }
            .alert-info { background: #1e3a4a; border-color: #17a2b8; color: #6bc5d4; }
            
            td {
                border-bottom: 1px solid #444;
            }
            
            tr:hover {
                background: #3a3a3a;
            }
        }
        
        /* Dark mode via classe (pour synchronisation avec parent) */
        html.dark body,
        body.dark {
            background: #1a1a1a;
            color: #e0e0e0;
        }
        
        html.dark body::before,
        body.dark::before {
            color: rgba(255, 255, 255, 0.03);
        }
        
        html.dark .section,
        body.dark .section {
            background: #2d2d2d;
            color: #e0e0e0;
        }
        
        html.dark .section h2,
        body.dark .section h2 {
            color: #9d8aff;
        }
        
        html.dark .section h3,
        body.dark .section h3 {
            color: #b794f6;
        }
        
        html.dark .section h4,
        body.dark .section h4 {
            color: #9d8aff;
        }
        
        html.dark code,
        body.dark code {
            background: #3d3d3d;
            color: #ff79c6;
        }
        
        html.dark .alert-success,
        body.dark .alert-success { background: #1e4620; border-color: #28a745; color: #90ee90; }
        html.dark .alert-warning,
        body.dark .alert-warning { background: #4a3d00; border-color: #ffc107; color: #ffd700; }
        html.dark .alert-danger,
        body.dark .alert-danger { background: #4a1e1e; border-color: #dc3545; color: #ff6b6b; }
        html.dark .alert-info,
        body.dark .alert-info { background: #1e3a4a; border-color: #17a2b8; color: #6bc5d4; }
        
        html.dark td,
        body.dark td {
            border-bottom: 1px solid #444;
        }
        
        html.dark tr:hover,
        body.dark tr:hover {
            background: #3a3a3a;
        }
        
        /* Images avec support dark mode */
        img {
            transition: opacity 0.3s ease;
        }
        
        html.dark img {
            opacity: 0.95;
        }
        
        html.dark img[style*="border"] {
            border-color: #555 !important;
        }
        
        /* Placeholders captures d'Ã©cran avec dark mode */
        html.dark div[style*="background: #f8f9fa"] {
            background: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        html.dark div[style*="background: #f8f9fa"] p[style*="color: #6c757d"] {
            color: #b0b0b0 !important;
        }
        
        html.dark div[style*="background: #f8f9fa"] p[style*="color: #adb5bd"] {
            color: #888 !important;
        }
        
    </style>
    <script>
        // DÃ©tecter le thÃ¨me AVANT le rendu pour Ã©viter le flash
        (function() {
            try {
                // Essayer de dÃ©tecter le thÃ¨me du parent immÃ©diatement
                if (window.parent && window.parent !== window) {
                    try {
                        const parentDoc = window.parent.document
                        if (parentDoc && parentDoc.documentElement) {
                            const isDark = parentDoc.documentElement.classList.contains('dark')
                            if (isDark) {
                                // Appliquer immÃ©diatement avant le rendu (seulement sur documentElement)
                                document.documentElement.classList.add('dark')
                            }
                        }
                    } catch (e) {
                        // Cross-origin, on ne peut pas accÃ©der au parent
                    }
                }
                
                // DÃ©tecter aussi le thÃ¨me systÃ¨me
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark')
                }
            } catch (e) {
                // Erreur silencieuse
            }
        })();
    </script>
</head>
<body>
    <script>
        // Fonction pour appliquer le thÃ¨me
        function applyTheme(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark')
            } else {
                document.documentElement.classList.remove('dark')
            }
        }
        
        // DÃ©tecter le thÃ¨me depuis le parent (pour les mises Ã  jour en temps rÃ©el)
        window.addEventListener('message', function(event) {
            // Accepter les messages de n'importe quelle origine pour le thÃ¨me
            if (event.data && event.data.type === 'theme') {
                applyTheme(event.data.isDark)
            }
        })
        
        // Demander le thÃ¨me au parent au chargement
        if (window.parent && window.parent !== window) {
            try {
                window.parent.postMessage({ type: 'request-theme' }, '*')
            } catch (e) {
                // Cross-origin, on ne peut pas envoyer de message
            }
        }
        
        // DÃ©tecter aussi le thÃ¨me systÃ¨me au chargement (fallback)
        if (window.matchMedia) {
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)')
            if (darkModeQuery.matches) {
                applyTheme(true)
            }
            // Ã‰couter les changements de prÃ©fÃ©rence systÃ¨me
            darkModeQuery.addEventListener('change', (e) => {
                applyTheme(e.matches)
            })
        }
        
        // Protection contre la copie et les fuites
        (function() {
            // DÃ©sactiver le clic droit
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // DÃ©sactiver les raccourcis clavier de copie
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey && (e.key === 'c' || e.key === 'C' || e.key === 'a' || e.key === 'A' || e.key === 's' || e.key === 'S' || e.key === 'p' || e.key === 'P' || e.key === 'u' || e.key === 'U')) || 
                    e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j' || e.key === 'C' || e.key === 'c'))) {
                    e.preventDefault();
                    alert('âš ï¸ Cette documentation est confidentielle et protÃ©gÃ©e. La copie est interdite.');
                    return false;
                }
            });
            
            // DÃ©sactiver le glisser-dÃ©poser
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Avertissement au chargement (supprimÃ© pour Ã©viter les warnings console)
            // Le message de confidentialitÃ© est dÃ©jÃ  affichÃ© dans le banner visible
        })();
    </script>

<div class="confidential-banner">
    âš ï¸ DOCUMENTATION CONFIDENTIELLE - PROPRIÃ‰TÃ‰ DE HAPPLYZ MEDICAL SAS - TOUTE REPRODUCTION INTERDITE
</div>

<div class="header">
    <h1>ğŸ¥ OTT - Dispositif MÃ©dical IoT</h1>
    <div class="subtitle">Solution Enterprise de Monitoring OxygÃ©nothÃ©rapie</div>
    <div class="version-badge">Version 1.0 Production - Documentation DÃ©veloppeurs</div>
    <p style="margin-top: 1rem; font-size: 1.1rem;">HAPPLYZ MEDICAL SAS</p>
</div>

<nav class="nav-menu">
    <ul>
        <li><a href="#intro">ğŸ“– Introduction</a></li>
        <li><a href="#structure">ğŸ“ Structure</a></li>
        <li><a href="#architecture">ğŸ—ï¸ Architecture</a></li>
        <li><a href="#database">ğŸ—„ï¸ Base de DonnÃ©es</a></li>
        <li><a href="#firmware">ğŸ”§ Firmware ESP32</a></li>
        <li><a href="#firmware-workflow">âš™ï¸ Compilation & Flash</a></li>
        <li><a href="#api">ğŸ”Œ API Backend</a></li>
        <li><a href="#dashboard">âš›ï¸ Dashboard React</a></li>
        <li><a href="#compatibility">ğŸ”— CompatibilitÃ©</a></li>
        <li><a href="#roles-permissions">ğŸ” RÃ´les & Permissions</a></li>
        <li><a href="#measurements-queue">ğŸ“Š Queue Mesures</a></li>
        <li><a href="#deployment">â˜ï¸ DÃ©ploiement</a></li>
        <li><a href="#troubleshooting">ğŸ› DÃ©pannage</a></li>
        <li><a href="#roadmap">ğŸš€ Roadmap</a></li>
    </ul>
</nav>

<div class="container">

<section id="intro" class="section">
    <h2>ğŸ“– Introduction</h2>
    
    <p style="font-size: 1.15rem; margin-bottom: 1.5rem;">
        <strong>OTT (Oxygen Therapy Tracker)</strong> est un dispositif mÃ©dical IoT complet pour le monitoring 
        en temps rÃ©el de l'oxygÃ©nothÃ©rapie Ã  domicile. Solution 100% cloud, sÃ©curisÃ©e et conforme aux normes mÃ©dicales.
    </p>
    
    <div class="alert alert-info">
        <strong>â„¹ï¸ Documentation Technique</strong><br>
        Cette documentation est rÃ©servÃ©e aux dÃ©veloppeurs autorisÃ©s. Elle contient les dÃ©tails techniques, 
        l'architecture, les APIs, le firmware et les procÃ©dures de dÃ©ploiement.
    </div>
    
    <h3>ğŸ¯ Stack Technique</h3>
    <ul>
        <li><strong>Firmware</strong> : C++ / Arduino IDE / ESP32</li>
        <li><strong>Backend</strong> : PHP 8.2 / PostgreSQL 15</li>
        <li><strong>Frontend</strong> : Next.js 14 / React 18 / Tailwind CSS</li>
        <li><strong>Infrastructure</strong> : Render.com (API) + GitHub Pages (Dashboard)</li>
        <li><strong>Communication</strong> : 4G/LTE (SIM7600) + HTTPS</li>
        <li><strong>Cache</strong> : Redis (optionnel) avec fallback mÃ©moire</li>
        <li><strong>Monitoring</strong> : Sentry (optionnel)</li>
        <li><strong>Documentation API</strong> : OpenAPI 3.0 / Swagger</li>
    </ul>
</section>

<section id="architecture" class="section">
    <h2>ğŸ—ï¸ Architecture Technique</h2>
    
    
    <h3>ğŸ“ Vue d'Ensemble</h3>
    
    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32 + SIM    â”‚  â† Firmware C++
â”‚   (Dispositif)  â”‚     â€¢ Mesure capteur MPXV7007DP
â”‚                 â”‚     â€¢ Sleep profond (111j autonomie)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ POST HTTPS via 4G
         â”‚
         â”‚ 4G/LTE
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API PHP       â”‚  â† Backend Render.com
â”‚   PostgreSQL    â”‚     â€¢ JWT Authentication
â”‚   (Render.com)  â”‚     â€¢ Multi-users + Permissions
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ OTA Management
         â”‚
         â”‚ REST API
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard      â”‚  â† Frontend Next.js
â”‚  React/Next.js  â”‚     â€¢ 12 pages complÃ¨tes
â”‚  (GitHub Pages) â”‚     â€¢ PWA installable
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ Animations modernes
    </pre>
    
    <div class="alert alert-info" style="margin-bottom: 2rem;">
        <strong>ğŸš€ Firmware v1.0 Production - Architecture OptimisÃ©e</strong>
        <ul style="margin-top: 0.8rem; margin-left: 1.5rem;">
            <li><strong>âš¡ Architecture USB optimisÃ©e</strong> : DÃ©tection USB en prioritÃ© (avant modem), streaming instantanÃ© (< 1s), aucun blocage possible</li>
            <li><strong>ğŸ”Œ DÃ©tection dynamique</strong> : VÃ©rification USB toutes les 500ms dans <code>loop()</code>, transitions fluides ON/OFF automatiques</li>
            <li><strong>ğŸ“¡ GPS intelligent</strong> : <code>getDeviceLocationFast()</code> (500ms timeout, cache) + <code>getDeviceLocation()</code> (3s timeout). GPS OFF par dÃ©faut (config <code>gpsEnabled</code>)</li>
            <li><strong>ğŸ›¡ï¸ Gestion erreur robuste</strong> : Modem en arriÃ¨re-plan, streaming fonctionne mÃªme si modem absent, watchdog optimisÃ©</li>
            <li><strong>ğŸ’¾ BDD migration</strong> : Nouveau champ <code>device_configurations.gps_enabled</code> (BOOLEAN DEFAULT false)</li>
            <li><strong>ğŸ“Š Code professionnel</strong> : 2300+ lignes, 0 code mort, score qualitÃ© 9.5/10, production-ready</li>
        </ul>
    </div>
    
    <h3>ğŸ” Flux de donnÃ©es</h3>
    <ul>
        <li><strong>Montant (device â†’ cloud)</strong> : le firmware mesure (dÃ©bit, batterie) toutes les 5 min, propage via HTTPS/JSON vers <code>/api.php/devices/measurements</code> et <code>/logs</code>.</li>
        <li><strong>USB streaming</strong> : En mode USB, envoi toutes les secondes via Web Serial API, parsing JSON cÃ´tÃ© React, affichage temps rÃ©el dans terminal. <strong>âš ï¸ Important</strong> : Le mode USB sert uniquement Ã  visualiser ce qui se passe en live. Le firmware continue de fonctionner normalement et d'envoyer en OTA. Aucun envoi sÃ©parÃ© n'est effectuÃ© depuis le dashboard pour Ã©viter les doublons.</li>
        <li><strong>PersistÃ©</strong> : l'API Docker (Render) Ã©crit en PostgreSQL (tables <code>devices</code>, <code>measurements</code>, <code>alerts</code>, <code>audit_logs</code>â€¦), via PDO.</li>
        <li><strong>Descendant</strong> : le Dashboard Next.js (GitHub Pages) appelle l'API (<code>NEXT_PUBLIC_API_URL</code>) pour stats, cartes, notifications, OTA.</li>
        <li><strong>Auth</strong> : Next.js poste sur <code>/api.php/auth/login</code>, stocke le JWT (LocalStorage) et <code>fetchWithAuth</code> ajoute <code>Authorization: Bearer ...</code> Ã  chaque requÃªte.</li>
    </ul>
    
    <h4>ğŸ“¤ Logs de Confirmation d'Envoi de DonnÃ©es</h4>
    <p>Le firmware affiche une sÃ©quence de logs pour confirmer l'envoi rÃ©ussi des mesures :</p>
    <pre><code>[MODEM] âœ… PrÃªt pour envoi de donnÃ©es
[MODEM] ğŸ“Š Ã‰tat connexion: RÃ©seau=OK | GPRS=OK
[API] ğŸ“¤ URL: https://ott-jbln.onrender.com:443/api.php/devices/measurements
[HTTP] POST /api.php/devices/measurements â†’ Status: 200
[API] âœ… Mesure reÃ§ue par la base de donnÃ©es avec succÃ¨s
[MODEM] âœ… Envoi des donnÃ©es effectuÃ© !</code></pre>
    <p>Le log final <code>[MODEM] âœ… Envoi des donnÃ©es effectuÃ© !</code> confirme que la transmission OTA a Ã©tÃ© complÃ©tÃ©e avec succÃ¨s. Ce log n'apparaÃ®t que si l'envoi a rÃ©ussi (status HTTP 200-299).</p>
    
    <h3>ğŸ“ Structure du Projet</h3>
    
    <div class="file-tree">
maxime/
â”œâ”€â”€ ğŸ“± FRONTEND (Next.js)
â”‚   â”œâ”€â”€ app/                      # Pages Next.js (App Router)
â”‚   â”œâ”€â”€ components/               # Composants rÃ©utilisables
â”‚   â”œâ”€â”€ contexts/                 # Contextes React (Auth, USB)
â”‚   â””â”€â”€ public/                   # Assets statiques
â”‚
â”œâ”€â”€ ğŸ”Œ BACKEND (PHP)
â”‚   â”œâ”€â”€ api.php                   # API REST complÃ¨te
â”‚   â”œâ”€â”€ sql/schema.sql            # Base PostgreSQL (14 tables)
â”‚   â””â”€â”€ Dockerfile                # Container pour Render
â”‚
â”œâ”€â”€ ğŸ”§ hardware/                  # MatÃ©riel & Firmware
â”‚   â”œâ”€â”€ firmware/                 # Firmwares compilÃ©s et uploadÃ©s (par version)
â”‚   â”‚   â””â”€â”€ fw_ott_optimized/    # Firmware v1.0 (production)
â”‚   â”‚       â”œâ”€â”€ *.bin             # Firmwares compilÃ©s
â”‚   â”‚       â””â”€â”€ *.ino             # Firmwares uploadÃ©s
â”‚   â””â”€â”€ lib/                      # BibliothÃ¨ques externes (TinyGSM)
â”‚
â””â”€â”€ ğŸ“š DOCUMENTATION
    â”œâ”€â”€ DOCUMENTATION_PRESENTATION.html
    â”œâ”€â”€ DOCUMENTATION_DEVELOPPEURS.html
    â””â”€â”€ DOCUMENTATION_COMMERCIALE.html
    </div>
    
</section>

<section id="firmware" class="section">
    <h2>ğŸ”§ Firmware ESP32</h2>
    
    
    <h3>ğŸ“¦ MatÃ©riel Requis</h3>
    <ul>
        <li>Carte ESP32 + Modem 4G : LILYGO TTGO T-A7670G (~40â‚¬)</li>
        <li>Capteur de pression : MPXV7007DP (~15â‚¬)</li>
        <li>Batterie Li-Ion : 18650 2000mAh (~5â‚¬)</li>
        <li>Carte SIM 4G : Free Mobile (2â‚¬/mois)</li>
    </ul>
    
    <h3>ğŸ”‹ Optimisation Autonomie</h3>
    <p>Le firmware est optimisÃ© pour une <strong>autonomie de 111 jours</strong> sur batterie 2000mAh grÃ¢ce au deep sleep ESP32.</p>
    
    <h3>ğŸ“¦ Compilation et Flash du Firmware</h3>
    <p>Le firmware est Ã©crit en C++ (Arduino) et peut Ãªtre compilÃ© de deux faÃ§ons :</p>
    
    <h4>Option 1 : Compilation en .bin (RecommandÃ©)</h4>
    <p>Pour un flash direct via le dashboard ou esptool, compilez le firmware en fichier .bin :</p>
    <pre><code># Windows PowerShell
.\scripts\build_firmware_bin.ps1

# Le fichier .bin sera gÃ©nÃ©rÃ© dans hardware/firmware/fw_ott_optimized/
# Exemple : ott_firmware_v1.0_20251203.bin</code></pre>
    <p>Le fichier .bin peut ensuite Ãªtre :</p>
    <ul>
        <li>UploadÃ© via le modal "Flash USB" dans le dashboard</li>
        <li>FlashÃ© directement avec esptool : <code>esptool.py --port COM6 write_flash 0x1000 firmware.bin</code></li>
    </ul>
    
    <h4>Option 2 : Compilation et Upload Direct</h4>
    <p>Pour compiler et flasher directement via arduino-cli :</p>
    <pre><code># Windows PowerShell
.\scripts\flash_firmware.ps1 -Port COM6

# Ou manuellement
arduino-cli compile --fqbn esp32:esp32:esp32 hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino
arduino-cli upload --fqbn esp32:esp32:esp32 -p COM6 hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino</code></pre>
    
    <h3>ğŸ”Œ Streaming USB v1.0 - Architecture OptimisÃ©e</h3>
    
    <div class="alert alert-success">
        <strong>âš¡ Firmware v1.0 - Optimisations Majeures</strong>
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li><strong>DÃ©marrage instantanÃ©</strong> : DÃ©tection USB AVANT modem â†’ streaming dÃ©marre en < 1s</li>
            <li><strong>DÃ©tection dynamique</strong> : VÃ©rification USB toutes les 500ms dans <code>loop()</code> â†’ plug & play sans reboot</li>
            <li><strong>GPS intelligent</strong> : Deux fonctions (<code>getDeviceLocationFast()</code> 500ms + <code>getDeviceLocation()</code> 3s), OFF par dÃ©faut</li>
            <li><strong>ZÃ©ro blocage</strong> : Modem en arriÃ¨re-plan, streaming fonctionne mÃªme si modem Ã©choue</li>
        </ul>
    </div>
    
    <h4>ğŸ“‹ Format JSON Streaming USB</h4>
    <p>Le firmware envoie des messages JSON toutes les secondes en mode USB :</p>
    <pre><code>{
  // Identifiants
  "sim_iccid": "89331508...",
  "device_serial": "OTT-XX-XXX",
  "firmware_version": "1.0",
  "device_name": "OTT-8837",
  
  // Mesures
  "flow_lpm": 2.5,           // DÃ©bit oxygÃ¨ne (L/min)
  "flowrate": 2.5,           // Alias compatibilitÃ©
  "battery_percent": 85,     // % batterie
  "battery": 85,             // Alias
  "rssi": -65,               // Signal (dBm), 0 si modem pas prÃªt
  "signal_strength": -65,    // Alias
  
  // Position (si GPS activÃ©)
  "latitude": 48.856614,     // null si GPS OFF
  "longitude": 2.352222,     // null si GPS OFF
  
  // MÃ©tadonnÃ©es
  "status": "USB_STREAM",
  "mode": "usb_stream",
  "seq": 123,                // NumÃ©ro sÃ©quence
  "timestamp_ms": 12345,
  "interval_ms": 1000,
  
  // Configuration
  "calibration_coefficients": [0.0, 1.0, 0.0],
  "sleep_minutes": 5,
  "airflow_passes": 2
}</code></pre>
    
    <h4>ğŸ¯ Variables de Configuration GPS</h4>
    <ul>
        <li><strong><code>gpsEnabled</code></strong> : Boolean, OFF par dÃ©faut (Ã©vite blocages modem + Ã©conomie batterie)</li>
        <li><strong>NVS</strong> : SauvegardÃ© en mÃ©moire persistante (<code>prefs.getBool("gps_enabled", false)</code>)</li>
        <li><strong>BDD</strong> : Champ <code>device_configurations.gps_enabled</code> synchronisÃ© via UPDATE_CONFIG</li>
    </ul>
    <p>Le dashboard reÃ§oit automatiquement ces informations et :</p>
    <ul>
        <li>Identifie le dispositif dans la base de donnÃ©es (par ICCID, Serial ou device_name)</li>
        <li>Met Ã  jour automatiquement le <code>firmware_version</code> dans la base si la version a changÃ©</li>
        <li>DÃ©marre automatiquement le streaming USB si un dispositif est dÃ©tectÃ©</li>
    </ul>
    
    <h3>âš™ï¸ Valeurs par DÃ©faut du Firmware</h3>
    
    <div class="alert alert-info">
        <strong>â„¹ï¸ Configuration Minimale</strong><br>
        Le firmware <strong>a des valeurs par dÃ©faut</strong> pour tous les paramÃ¨tres. Vous n'Ãªtes <strong>pas obligÃ©</strong> de tout configurer via le dashboard. Le firmware fonctionnera avec les valeurs par dÃ©faut, mais vous pouvez les personnaliser via le dashboard si nÃ©cessaire.
    </div>
    
    <h4>ğŸ“‹ RÃ©seau & Connexion</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>APN</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>"free"</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Point d'accÃ¨s rÃ©seau (Free Mobile)</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>SIM PIN</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>"1234"</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Code PIN de la carte SIM</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>ICCID</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>"89330123456789012345"</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Identifiant SIM (sera remplacÃ© automatiquement par l'ICCID rÃ©el)</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Serial</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>"OTT-XX-XXX"</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">NumÃ©ro de sÃ©rie temporaire (sera remplacÃ© automatiquement par le backend)</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>ItinÃ©rance</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>true</code> (activÃ©e)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Permet l'utilisation d'autres rÃ©seaux opÃ©rateurs</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ’¤ Sommeil & Envoi</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Sleep Minutes</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>1440</code> (24 heures)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">DurÃ©e entre chaque envoi de mesure</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Send Every N Wakeups</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>1</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Envoi Ã  chaque wakeup (1 = Ã  chaque fois)</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸŒ¬ï¸ Mesure Airflow</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Passes</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>2</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Nombre de passes de mesure</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Samples per Pass</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>10</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Nombre d'Ã©chantillons par passe</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Delay (ms)</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>5</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">DÃ©lai entre chaque Ã©chantillon</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ“¡ Modem & Timeouts</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Modem Boot Timeout</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>20000</code> ms (20s)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Timeout de dÃ©marrage du modem</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>SIM Ready Timeout</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>45000</code> ms (45s)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Timeout de prÃ©paration de la SIM</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Network Attach Timeout</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>120000</code> ms (120s)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Timeout d'attachement au rÃ©seau</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Modem Max Reboots</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>3</code></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Nombre maximum de redÃ©marrages du modem</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ›¡ï¸ Watchdog</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Watchdog Timeout</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>30</code> secondes</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Timeout du watchdog (minimum: 5s)</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ“ GPS</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>GPS Enabled</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>false</code> (dÃ©sactivÃ©)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">GPS dÃ©sactivÃ© par dÃ©faut (peut bloquer le modem/consommer la batterie)</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ”§ Calibration</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>Coefficients a0, a1, a2</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><code>NAN</code> (non dÃ©finis)</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Pas de calibration par dÃ©faut</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ”„ OTA (Over-The-Air)</h4>
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">ParamÃ¨tre</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Valeur par DÃ©faut</th>
                <th style="padding: 0.75rem; border: 1px solid #ddd; text-align: left;">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>OTA Primary URL</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Vide</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">URL principale pour les mises Ã  jour OTA</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>OTA Fallback URL</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Vide</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">URL de secours pour les mises Ã  jour OTA</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;"><strong>OTA MD5</strong></td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Vide</td>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Hash MD5 attendu pour les mises Ã  jour OTA</td>
            </tr>
        </tbody>
    </table>
    
    <h4>ğŸ”„ Comportement au DÃ©marrage</h4>
    <ol>
        <li><strong>Premier boot</strong> : Le firmware utilise toutes les valeurs par dÃ©faut ci-dessus</li>
        <li><strong>Chargement NVS</strong> : La fonction <code>loadConfig()</code> charge les valeurs depuis la mÃ©moire non-volatile (NVS)</li>
        <li><strong>Si valeur absente</strong> : Si une valeur n'est pas trouvÃ©e en NVS, la valeur par dÃ©faut est utilisÃ©e</li>
        <li><strong>Sauvegarde</strong> : Les valeurs configurÃ©es via le dashboard sont sauvegardÃ©es en NVS et persistent aprÃ¨s un reset</li>
    </ol>
    
    <h4>âœ… Ce qui est Automatique</h4>
    <ul>
        <li><strong>ICCID</strong> : DÃ©tectÃ© automatiquement depuis la carte SIM</li>
        <li><strong>Serial</strong> : GÃ©nÃ©rÃ© automatiquement par le backend au format <code>OTT-YY-NNN</code> (ex: <code>OTT-25-001</code>)</li>
        <li><strong>APN</strong> : DÃ©tection automatique de l'opÃ©rateur et utilisation de l'APN recommandÃ© si disponible</li>
    </ul>
    
    <h4>ğŸ¯ Recommandations de Configuration</h4>
    
    <div class="alert alert-success">
        <strong>âœ… Configuration Minimale Requise</strong><br>
        Pour un fonctionnement de base, vous pouvez laisser <strong>toutes les valeurs par dÃ©faut</strong>. Le firmware fonctionnera avec :
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li>APN <code>"free"</code> (si vous utilisez Free Mobile)</li>
            <li>Sleep de 24 heures (1 envoi par jour)</li>
            <li>ItinÃ©rance activÃ©e</li>
        </ul>
    </div>
    
    <p><strong>Configuration RecommandÃ©e</strong> : Pour optimiser le fonctionnement, configurez au minimum :</p>
    <ol>
        <li><strong>APN</strong> : Selon votre opÃ©rateur (ex: <code>"free"</code> pour Free, <code>"orange"</code> pour Orange, <code>"sfr"</code> pour SFR)</li>
        <li><strong>SIM PIN</strong> : Le code PIN rÃ©el de votre carte SIM</li>
        <li><strong>Sleep Minutes</strong> : Selon vos besoins (ex: <code>5</code> pour un envoi toutes les 5 minutes)</li>
    </ol>
    
    <p><strong>Configuration AvancÃ©e</strong> : Pour un contrÃ´le total, configurez Ã©galement :</p>
    <ul>
        <li><strong>Watchdog</strong> : Selon vos besoins de stabilitÃ©</li>
        <li><strong>Timeouts Modem</strong> : Si vous avez des problÃ¨mes de connexion</li>
        <li><strong>GPS</strong> : Activer si vous avez besoin de la localisation</li>
        <li><strong>Calibration</strong> : Si vous avez calibrÃ© votre capteur</li>
    </ul>
    
    <div class="alert alert-warning">
        <strong>ğŸ’¡ Important</strong><br>
        <strong>Vous n'Ãªtes pas obligÃ© de tout configurer !</strong> Le firmware fonctionne avec les valeurs par dÃ©faut. Configurez uniquement ce qui est nÃ©cessaire pour votre cas d'usage spÃ©cifique.
    </div>
    
    <h3>ğŸ”„ Mise Ã  Jour Automatique du Firmware Version</h3>
    <p>Lorsqu'un dispositif USB est connectÃ© et envoie son <code>device_info</code>, le systÃ¨me :</p>
    <ol>
        <li>ReÃ§oit le message <code>device_info</code> via le port sÃ©rie USB</li>
        <li>Parse le JSON et extrait l'ICCID/Serial et la version firmware</li>
        <li>Recherche le dispositif correspondant dans la base de donnÃ©es</li>
        <li>Compare la version reÃ§ue avec celle enregistrÃ©e</li>
        <li>Met Ã  jour automatiquement <code>devices.firmware_version</code> via l'API si diffÃ©rent</li>
    </ol>
    <p>Cette mise Ã  jour est transparente et ne nÃ©cessite aucune action manuelle.</p>
</section>

<section id="api" class="section">
    <h2>ğŸ”Œ API Backend (PHP + PostgreSQL)</h2>
    
    
    <h3>ğŸ“Š Base de DonnÃ©es PostgreSQL</h3>
    <p>Le schÃ©ma comprend <strong>16 tables</strong> : devices, patients, measurements, alerts, device_logs, users, roles, permissions, device_configurations, firmware_versions, etc.</p>
    
    <h4>ğŸ“¦ Archivage des Mesures</h4>
    <p>La table <code>measurements</code> inclut une colonne <code>deleted_at</code> (TIMESTAMPTZ) pour l'archivage logiciel (soft delete) :</p>
    <ul>
        <li><strong>Archivage</strong> : Les mesures peuvent Ãªtre archivÃ©es via <code>DELETE /api.php/measurements/{id}?archive=true</code>, ce qui dÃ©finit <code>deleted_at</code> sans supprimer l'enregistrement</li>
        <li><strong>Restauration</strong> : Les mesures archivÃ©es peuvent Ãªtre restaurÃ©es via <code>PATCH /api.php/measurements/{id}</code> avec <code>{deleted_at: null}</code> (admin only)</li>
        <li><strong>Filtrage</strong> : Par dÃ©faut, les requÃªtes excluent les mesures archivÃ©es (<code>deleted_at IS NULL</code>), sauf si le paramÃ¨tre <code>show_archived=true</code> est fourni</li>
        <li><strong>Suppression dÃ©finitive</strong> : Les administrateurs peuvent supprimer dÃ©finitivement une mesure via <code>DELETE /api.php/measurements/{id}?permanent=true</code></li>
    </ul>
    
    <h3>âš¡ Performance & Cache</h3>
    <ul>
        <li><strong>Cache Redis</strong> : SystÃ¨me de cache avec support Redis optionnel (variables <code>REDIS_HOST</code>, <code>REDIS_PORT</code>, <code>REDIS_PASSWORD</code>)</li>
        <li><strong>Fallback mÃ©moire</strong> : Si Redis n'est pas disponible, le systÃ¨me utilise automatiquement un cache en mÃ©moire</li>
        <li><strong>TTL configurable</strong> : Cache avec TTL de 30 secondes pour les listes de dispositifs</li>
    </ul>
    
    <h3>ğŸ“Š Monitoring & ObservabilitÃ©</h3>
    <ul>
        <li><strong>Sentry</strong> : IntÃ©gration Sentry pour le monitoring des erreurs (variables <code>NEXT_PUBLIC_SENTRY_DSN</code>, <code>SENTRY_ORG</code>, <code>SENTRY_PROJECT</code>)</li>
        <li><strong>Session Replay</strong> : 10% des sessions en production</li>
        <li><strong>Performance Monitoring</strong> : 10% des transactions en production</li>
    </ul>
    
    <h3>ğŸ“š Documentation API</h3>
    <ul>
        <li><strong>OpenAPI 3.0</strong> : Documentation complÃ¨te disponible via <code>GET /api.php/docs/openapi.json</code></li>
        <li><strong>Swagger UI</strong> : Compatible avec Swagger UI et Postman pour la visualisation</li>
    </ul>
    
    <h3>ğŸ” Authentification JWT</h3>
    <p>L'API utilise <strong>JWT (JSON Web Tokens)</strong> pour l'authentification avec expiration 24h.</p>
    
    <h3>ğŸŒ Endpoints API Principaux</h3>
    <ul>
        <li><code>GET/POST/PUT/DELETE /api.php/devices</code> - Gestion des dispositifs (avec pagination)</li>
        <li><code>GET/POST/PUT/DELETE /api.php/patients</code> - Gestion des patients (avec pagination)</li>
        <li><code>POST /api.php/devices/measurements</code> - Enregistrement des mesures</li>
        <li><code>GET /api.php/devices/{id}/history</code> - Historique des mesures d'un dispositif (avec filtres <code>show_archived</code>)</li>
        <li><code>DELETE /api.php/measurements/{id}?archive=true</code> - Archivage d'une mesure (soft delete)</li>
        <li><code>DELETE /api.php/measurements/{id}?permanent=true</code> - Suppression dÃ©finitive d'une mesure (admin only)</li>
        <li><code>PATCH /api.php/measurements/{id}</code> - Restauration d'une mesure archivÃ©e (admin only)</li>
        <li><code>GET /api.php/alerts</code> - Gestion des alertes (avec pagination)</li>
        <li><code>GET /api.php/commands</code> - Liste des commandes (avec pagination, admin only)</li>
        <li><code>GET/POST/PUT/DELETE /api.php/users</code> - Gestion des utilisateurs (avec pagination, admin only)</li>
        <li><code>POST /api.php/migrate</code> - ExÃ©cution de scripts SQL de migration (admin only)</li>
        <li><code>GET /api.php/docs/openapi.json</code> - Documentation OpenAPI/Swagger</li>
    </ul>
    
    <div class="alert alert-info">
        <strong>â„¹ï¸ Pagination</strong><br>
        Tous les endpoints de liste supportent maintenant la pagination avec les paramÃ¨tres :
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li><code>limit</code> : Nombre d'Ã©lÃ©ments par page (dÃ©faut: 100, max: 500)</li>
            <li><code>offset</code> : DÃ©calage pour la pagination (dÃ©faut: 0)</li>
            <li><code>page</code> : NumÃ©ro de page (dÃ©faut: 1)</li>
        </ul>
    </div>
</section>

<section id="dashboard" class="section">
    <h2>âš›ï¸ Dashboard React (Next.js 14)</h2>
    
    
    <h3>ğŸ¨ Technologies UtilisÃ©es</h3>
    <ul>
        <li><strong>Next.js 14</strong> - Framework React avec App Router et export statique</li>
        <li><strong>Tailwind CSS</strong> - Design system utility-first</li>
        <li><strong>Chart.js</strong> - Graphiques interactifs</li>
        <li><strong>React Context</strong> - Gestion d'Ã©tat (AuthContext, UsbContext)</li>
        <li><strong>Service Worker</strong> - PWA avec cache offline</li>
        <li><strong>Web Serial API</strong> - Communication USB directe avec les dispositifs</li>
    </ul>
    
    <h3>ğŸ“± Pages Disponibles</h3>
    <p>Le dashboard comprend <strong>12 pages principales</strong> accessibles depuis le menu latÃ©ral :</p>
    <ul>
        <li><strong>ğŸ  Vue d'Ensemble</strong> : KPI, graphiques, actions requises</li>
        <li><strong>ğŸ”Œ Dispositifs OTT</strong> : Gestion complÃ¨te (liste, carte, dÃ©tails, OTA, commandes, logs, streaming USB)</li>
        <li><strong>ğŸ¥ Patients</strong> : Gestion des patients avec assignation/dÃ©sassignation de dispositifs</li>
        <li><strong>ğŸ‘¨â€ğŸ’¼ Utilisateurs</strong> : Gestion des utilisateurs, rÃ´les et permissions (admin uniquement)</li>
        <li><strong>ğŸ› ï¸ Migrations</strong> : Page admin pour exÃ©cuter des scripts SQL de migration (admin uniquement)</li>
        <li><strong>âš™ï¸ Outils</strong> : Upload firmware, compilation, flash USB, streaming USB, configuration dispositifs</li>
        <li><strong>ğŸ“š Documentation</strong> : 3 documentations intÃ©grÃ©es (PrÃ©sentation, DÃ©veloppeurs, Commerciale) + Suivi temps</li>
    </ul>
    
    <h3>ğŸ¯ FonctionnalitÃ©s Disponibles Directement dans l'Interface</h3>
    
    <h4>ğŸ”Œ Gestion des Dispositifs</h4>
    <ul>
        <li><strong>Configuration</strong> : Modifier les paramÃ¨tres (intervalle rÃ©veil, durÃ©e mesure, coefficients calibration a0/a1/a2) directement depuis l'onglet "Configuration"</li>
        <li><strong>Commandes OTA</strong> : Envoyer des commandes (SET_SLEEP_SECONDS, PING, UPDATE_CONFIG, UPDATE_CALIBRATION, OTA_REQUEST) depuis le modal de dÃ©tails</li>
        <li><strong>Flash Firmware</strong> : Flasher un firmware compilÃ© via OTA ou USB depuis le modal de dÃ©tails</li>
        <li><strong>Streaming USB</strong> : Visualiser les mesures en temps rÃ©el via USB avec affichage min/max (dÃ©bit, batterie, RSSI)</li>
        <li><strong>Carte Interactive</strong> : Visualisation gÃ©ographique des dispositifs avec Leaflet</li>
        <li><strong>Logs</strong> : Consulter les mesures, logs et alertes de chaque dispositif</li>
        <li><strong>Archivage Mesures</strong> : Administrateurs peuvent archiver, restaurer ou supprimer dÃ©finitivement les mesures dans l'historique</li>
    </ul>
    
    <h4>âš™ï¸ Outils Techniques</h4>
    <ul>
        <li><strong>Upload Firmware</strong> : Uploader un fichier .ino depuis l'onglet "Firmware"</li>
        <li><strong>Compilation Automatique</strong> : Compilation en direct avec logs SSE (Server-Sent Events)</li>
        <li><strong>Flash USB</strong> : Flasher un firmware directement via USB depuis l'onglet "Flash USB"</li>
        <li><strong>Streaming USB</strong> : Monitoring en temps rÃ©el des logs et mesures USB</li>
        <li><strong>Configuration Dispositifs</strong> : Interface complÃ¨te pour configurer les paramÃ¨tres et coefficients de calibration</li>
    </ul>
    
    <h4>ğŸ“Š Visualisation & Monitoring</h4>
    <ul>
        <li><strong>Graphiques</strong> : Graphiques de dÃ©bit, batterie, signal (Chart.js)</li>
        <li><strong>Min/Max</strong> : Affichage des valeurs min/max pour dÃ©bit, batterie et RSSI</li>
        <li><strong>Alertes</strong> : Gestion des alertes (batterie faible, offline, etc.) avec rÃ©solution</li>
        <li><strong>Audit</strong> : Logs d'audit de toutes les actions (admin uniquement)</li>
    </ul>
    
    <h3>ğŸ”§ Architecture Frontend</h3>
    
    <h4>Hooks & Utilitaires</h4>
    <ul>
        <li><strong><code>hooks/useTimer.js</code></strong> : Gestion timers avec cleanup automatique (<code>useTimeout</code>, <code>useInterval</code>, <code>useTimers</code>)</li>
        <li><strong><code>lib/apiHelpers.js</code></strong> : Wrappers API (<code>safeApiCall</code>, <code>apiCallWithRetry</code>, <code>batchApiCalls</code>)</li>
        <li><strong><code>lib/errorHandler.js</code></strong> : Gestion d'erreurs standardisÃ©e (<code>withErrorHandling</code>, <code>createErrorHandler</code>)</li>
    </ul>
    
    <h4>Gestion des Archives</h4>
    <ul>
        <li><strong>Mesures</strong> : Les administrateurs peuvent archiver, restaurer ou supprimer dÃ©finitivement les mesures depuis le modal d'historique</li>
        <li><strong>Filtre archives</strong> : Bouton "Afficher archivÃ©es" pour voir les mesures archivÃ©es dans l'historique</li>
        <li><strong>Ã‰lÃ©ments archivÃ©s</strong> : Exclusion automatique des statistiques et fonctionnalitÃ©s actives</li>
        <li><strong>Affichage visuel</strong> : Badge "ğŸ—„ï¸ ArchivÃ©" pour les Ã©lÃ©ments archivÃ©s, icÃ´nes d'action conditionnelles (archive/restauration)</li>
    </ul>
    
    <h4>ğŸ› ï¸ Page Migrations Admin</h4>
    <ul>
        <li><strong>Interface</strong> : Page dÃ©diÃ©e accessible depuis le menu (admin uniquement) pour exÃ©cuter des scripts SQL</li>
        <li><strong>Scripts disponibles</strong> : SÃ©lection dans une liste dÃ©roulante (migration complÃ¨te, migrations spÃ©cifiques, scripts de nettoyage)</li>
        <li><strong>SÃ©curitÃ©</strong> : VÃ©rification du rÃ´le admin cÃ´tÃ© serveur avant exÃ©cution</li>
        <li><strong>Exemples</strong> : Nettoyage des noms de dispositifs, ajout de colonnes (deleted_at), migrations de schÃ©ma</li>
    </ul>
    
    <h4>âœ… Modals de Confirmation UnifiÃ©s</h4>
    <ul>
        <li><strong>ConfirmModal</strong> : Composant unifiÃ© pour toutes les confirmations utilisateur (remplace window.confirm)</li>
        <li><strong>UX amÃ©liorÃ©e</strong> : Interface cohÃ©rente avec design system, messages personnalisables</li>
        <li><strong>Utilisation</strong> : Archivage, suppression, restauration, et autres actions critiques</li>
    </ul>
    
    <h4>DÃ©ploiement</h4>
    <ul>
        <li>Mode serveur : Docker standalone (port 3000)</li>
        <li>Mode statique : GitHub Pages (export Next.js)</li>
        <li>Scripts d'export : <code>export_static.sh</code> et <code>export_static.ps1</code></li>
    </ul>
</section>

<section id="deployment" class="section">
    <h2>â˜ï¸ DÃ©ploiement</h2>
    
    <h3>ğŸ“¦ DÃ©ploiement API sur Render</h3>
    <h4>1. CrÃ©er la base PostgreSQL</h4>
    <ol>
        <li>Aller sur https://dashboard.render.com</li>
        <li>CrÃ©er un nouveau service PostgreSQL (Free tier)</li>
        <li>Noter les variables de connexion (DB_HOST, DB_NAME, DB_USER, DB_PASS)</li>
        <li>Appliquer la migration : <code>DATABASE_URL="postgresql://..." ./scripts/db_migrate.sh --seed</code></li>
    </ol>
    
    <h4>2. DÃ©ployer l'API PHP</h4>
    <ol>
        <li>CrÃ©er un nouveau service Web sur Render</li>
        <li>Connecter le repository GitHub</li>
        <li>Configurer avec Dockerfile (dÃ©jÃ  prÃ©sent)</li>
        <li>DÃ©finir les variables d'environnement :
            <ul>
                <li><code>DB_HOST</code>, <code>DB_NAME</code>, <code>DB_USER</code>, <code>DB_PASS</code></li>
                <li><code>JWT_SECRET</code> (gÃ©nÃ©rer via <code>openssl rand -hex 32</code>)</li>
                <li><code>AUTH_DISABLED=false</code> (production)</li>
                <li><code>ENABLE_DEMO_RESET=false</code> (production)</li>
            </ul>
        </li>
        <li>Le service sera disponible Ã  <code>https://ott-jbln.onrender.com</code></li>
    </ol>
    
    <h3>ğŸ“± DÃ©ploiement Dashboard</h3>
    <h4>Option 1 : GitHub Pages (Gratuit)</h4>
    <ol>
        <li>Configurer <code>.env.local</code> avec <code>NEXT_PUBLIC_API_URL=https://ott-jbln.onrender.com</code></li>
        <li>Build : <code>npm run build && npm run export</code></li>
        <li>Push vers GitHub (le dossier <code>out/</code> sera dÃ©ployÃ© automatiquement)</li>
        <li>Activer GitHub Pages dans les paramÃ¨tres du repository</li>
    </ol>
    
    <h4>Option 2 : Render (RecommandÃ© pour production)</h4>
    <ol>
        <li>CrÃ©er un nouveau service Web sur Render</li>
        <li>Utiliser <code>Dockerfile.dashboard</code> (si disponible) ou build Next.js standard</li>
        <li>Variables d'environnement :
            <ul>
                <li><code>NEXT_PUBLIC_API_URL=https://ott-jbln.onrender.com</code></li>
                <li><code>NEXT_PUBLIC_ENABLE_DEMO_RESET=false</code></li>
                <li><code>NODE_ENV=production</code></li>
            </ul>
        </li>
        <li>Auto-deploy activÃ© sur push vers <code>main</code></li>
    </ol>
    
    <h3>ğŸ’° CoÃ»ts Mensuels</h3>
    <table>
        <tr>
            <th>Service</th>
            <th>Plan</th>
            <th>Prix</th>
        </tr>
        <tr>
            <td>PostgreSQL (Render)</td>
            <td>Free</td>
            <td><strong>0â‚¬</strong></td>
        </tr>
        <tr>
            <td>API Backend (Render)</td>
            <td>Starter</td>
            <td><strong>7â‚¬/mois</strong></td>
        </tr>
        <tr>
            <td>Dashboard (GitHub Pages)</td>
            <td>Free</td>
            <td><strong>0â‚¬</strong></td>
        </tr>
        <tr>
            <td>Dashboard (Render - Optionnel)</td>
            <td>Starter</td>
            <td><strong>7â‚¬/mois</strong></td>
        </tr>
        <tr>
            <td>Carte SIM 4G</td>
            <td>-</td>
            <td><strong>2â‚¬/dispositif/mois</strong></td>
        </tr>
        <tr>
            <td colspan="2"><strong>TOTAL (GitHub Pages)</strong></td>
            <td><strong>7â‚¬/mois</strong></td>
        </tr>
        <tr>
            <td colspan="2"><strong>TOTAL (Render complet)</strong></td>
            <td><strong>14â‚¬/mois</strong></td>
        </tr>
    </table>
    
    <div class="alert alert-success">
        <strong>ğŸ‰ Ã‰conomie</strong><br>
        vs 10 000â‚¬/mois avec solutions cloud classiques !
    </div>
    
    <h3>âœ… VÃ©rification Post-DÃ©ploiement</h3>
    <ol>
        <li>VÃ©rifier que l'API rÃ©pond : <code>curl https://ott-jbln.onrender.com/api.php/health</code></li>
        <li>VÃ©rifier que le dashboard se charge : <code>https://ymora.github.io/OTT/</code></li>
        <li>Tester la connexion : Le dashboard doit pouvoir se connecter Ã  l'API</li>
        <li>VÃ©rifier les CORS : L'API doit autoriser l'origine du dashboard</li>
    </ol>
</section>

<section id="troubleshooting" class="section">
    <h2>ğŸ› DÃ©pannage</h2>
    
    <h3>ğŸ”§ ProblÃ¨mes Courants</h3>
    
    <h4>ğŸ“± Firmware / Dispositif</h4>
    <ul>
        <li><strong>Modem not responding</strong> : VÃ©rifier l'antenne 4G et la carte SIM</li>
        <li><strong>Dispositif n'apparaÃ®t pas</strong> :
            <ol>
                <li>VÃ©rifier l'ICCID cÃ´tÃ© firmware (aprÃ¨s <code>SIM READY</code>, journaliser <code>modem.getSimCCID()</code>)</li>
                <li>S'assurer que le POST mesure cible bien l'API (<code>https://ott-jbln.onrender.com/api.php/devices/measurements</code>)</li>
                <li>Observer la rÃ©ponse API (en succÃ¨s : <code>{ success: true, device_id: &lt;id&gt; }</code>)</li>
                <li>Confirmer cÃ´tÃ© dashboard : rechercher l'ICCID sur la page "Dispositifs"</li>
                <li>Si toujours absent : relancer <code>scripts/db_migrate.sh --seed</code></li>
            </ol>
        </li>
        <li><strong>OTA Ã©choue</strong> : VÃ©rifier la connexion rÃ©seau, le MD5 du firmware, et les logs sÃ©rie</li>
        <li><strong>USB non dÃ©tectÃ©</strong> : VÃ©rifier que le navigateur supporte Web Serial API (Chrome/Edge), autoriser l'accÃ¨s au port</li>
    </ul>
    
    <h4>ğŸŒ API / Backend</h4>
    <ul>
        <li><strong>JWT verification failed</strong> : Token expirÃ©, se reconnecter</li>
        <li><strong>Failed to fetch</strong> : VÃ©rifier que l'API est en ligne et les headers CORS</li>
        <li><strong>Database connection failed</strong> : VÃ©rifier les variables d'environnement (DB_HOST, DB_NAME, DB_USER, DB_PASS)</li>
        <li><strong>500 Internal Server Error</strong> : VÃ©rifier les logs Render, souvent liÃ© Ã  une erreur SQL ou une variable manquante</li>
    </ul>
    
    <h4>âš›ï¸ Dashboard / Frontend</h4>
    <ul>
        <li><strong>Build Next.js Ã©choue</strong> : Supprimer le cache (<code>rm -rf .next node_modules</code>) et rÃ©installer les dÃ©pendances</li>
        <li><strong>Page blanche</strong> : VÃ©rifier la console du navigateur, souvent liÃ© Ã  une erreur JavaScript ou une variable d'environnement manquante</li>
        <li><strong>DonnÃ©es ne se chargent pas</strong> : VÃ©rifier <code>NEXT_PUBLIC_API_URL</code> dans <code>.env.local</code></li>
        <li><strong>Authentification Ã©choue</strong> : VÃ©rifier que l'API est accessible et que <code>JWT_SECRET</code> est correct</li>
    </ul>
    
    <h4>ğŸ—„ï¸ Base de DonnÃ©es</h4>
    <ul>
        <li><strong>Migration Ã©choue</strong> : VÃ©rifier <code>DATABASE_URL</code>, s'assurer que la base existe</li>
        <li><strong>Tables manquantes</strong> : Relancer <code>scripts/db_migrate.sh</code></li>
        <li><strong>DonnÃ©es corrompues</strong> : Utiliser le bouton "RÃ©initialiser la base de dÃ©mo" (si activÃ©) ou relancer les seeds</li>
    </ul>
    
    <h3>ğŸ” Outils de Diagnostic</h3>
    <ul>
        <li><strong>Page /diagnostics</strong> : Affiche l'Ã©tat de l'API, la base de donnÃ©es, et les variables d'environnement</li>
        <li><strong>Console navigateur</strong> : VÃ©rifier les erreurs JavaScript et les appels API</li>
        <li><strong>Logs Render</strong> : VÃ©rifier les logs du service API pour les erreurs backend</li>
        <li><strong>Network tab</strong> : VÃ©rifier les requÃªtes HTTP et leurs rÃ©ponses</li>
    </ul>
    
    <h3>ğŸ“‹ Checklist de VÃ©rification</h3>
    <ol>
        <li><strong>Backend Render</strong> : DB_HOST/PORT/NAME/USER/PASS renseignÃ©s, JWT_SECRET dÃ©fini, AUTH_DISABLED=false</li>
        <li><strong>Base de donnÃ©es</strong> : <code>psql $DATABASE_URL -c "SELECT COUNT(*) FROM measurements;"</code> retourne > 0</li>
        <li><strong>Frontend local</strong> : <code>.env.local</code> pointe vers l'API, <code>npm run lint && npm run build</code> passent</li>
        <li><strong>Frontend GitHub Pages</strong> : <code>npm run export</code> avant push, vÃ©rifier que le dashboard se charge</li>
    </ol>
</section>

<section id="screenshots" class="section">
    <h2>ğŸ“¸ Captures d'Ã‰cran de l'Interface</h2>
    
    <p>Cette section prÃ©sente les diffÃ©rentes vues de l'interface utilisateur et les modals disponibles dans le dashboard OTT.</p>
    
    <h3>ğŸ” Page de Connexion</h3>
    <p>La page d'authentification avec formulaire de connexion sÃ©curisÃ© :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/login.png" alt="Page de connexion" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Page de connexion avec authentification JWT</p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/login.png</p>
        </div>
    </div>
    
    <h3>ğŸ  Vue d'Ensemble (Dashboard)</h3>
    <p>La page principale avec les indicateurs clÃ©s et les graphiques :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/dashboard-overview.png" alt="Vue d'ensemble" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/dashboard-overview.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Vue d'ensemble avec KPI, graphiques et actions requises</p>
    </div>
    
    <h3>ğŸ”Œ Page Dispositifs</h3>
    <p>La liste des dispositifs avec leurs statuts et informations :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/devices-list.png" alt="Liste des dispositifs" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/devices-list.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Liste des dispositifs avec recherche et filtres</p>
    </div>
    
    <h3>ğŸ¥ Page Patients</h3>
    <p>La gestion des patients avec leurs dispositifs associÃ©s :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/patients-list.png" alt="Liste des patients" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/patients-list.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Liste des patients avec recherche, crÃ©ation, modification, assignation/dÃ©sassignation de dispositifs. Interface simplifiÃ©e sans alertes (accessibles via le modal de dÃ©tails du dispositif).</p>
    </div>
    
    <h3>ğŸ“ Carte Interactive</h3>
    <p>La visualisation gÃ©ographique des dispositifs :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/map.png" alt="Carte interactive" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/map.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Carte Leaflet avec marqueurs des dispositifs</p>
    </div>
    
    <h3>âš ï¸ Page Alertes</h3>
    <p>La liste des alertes avec leurs statuts :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/alerts.png" alt="Page alertes" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/alerts.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Gestion des alertes avec filtres et actions</p>
    </div>
    
    <h3>ğŸ‘¥ Page Utilisateurs</h3>
    <p>La gestion des utilisateurs et des permissions :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/users.png" alt="Page utilisateurs" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/users.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Gestion des utilisateurs avec rÃ´les, permissions, statut actif/inactif et derniÃ¨re connexion. Interface simplifiÃ©e sans alertes (accessibles via le modal de dÃ©tails dispositif).</p>
    </div>
    
    <h3>ğŸ”„ Page OTA</h3>
    <p>La gestion des mises Ã  jour OTA :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/ota.png" alt="Page OTA" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/ota.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Gestion des mises Ã  jour OTA des dispositifs</p>
    </div>
    
    <h3>ğŸ“ Modals</h3>
    
    <h4>Modal CrÃ©ation/Ã‰dition Patient</h4>
    <p>Le modal pour crÃ©er ou modifier un patient :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-patient.png" alt="Modal patient" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/modal-patient.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de crÃ©ation/Ã©dition de patient avec formulaire complet</p>
    </div>
    
    <h4>Modal DÃ©tails Dispositif</h4>
    <p>Le modal avec les dÃ©tails complets d'un dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-device-details.png" alt="Modal dÃ©tails dispositif" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/modal-device-details.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal avec onglets : DÃ©tails, Alertes, Logs, Commandes, Streaming USB</p>
    </div>
    
    <h4>Modal Assignation Dispositif</h4>
    <p>Le modal pour assigner un dispositif Ã  un patient :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-assign-device.png" alt="Modal assignation" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/modal-assign-device.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal d'assignation d'un dispositif libre Ã  un patient</p>
    </div>
    
    <h4>Modal CrÃ©ation/Ã‰dition Utilisateur</h4>
    <p>Le modal pour crÃ©er ou modifier un utilisateur :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-user.png" alt="Modal utilisateur" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/modal-user.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de crÃ©ation/Ã©dition d'utilisateur avec gestion des rÃ´les</p>
    </div>
    
    <h4>Modal DÃ©sassignation Dispositif</h4>
    <p>Le modal pour dÃ©sassigner un dispositif d'un patient :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-unassign-device.png" alt="Modal dÃ©sassignation" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/modal-unassign-device.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de confirmation pour dÃ©sassigner un dispositif d'un patient</p>
    </div>
    
    <h4>Modal Commande Dispositif</h4>
    <p>Le modal pour envoyer une commande Ã  un dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-command.png" alt="Modal commande" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div style="background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; padding: 3rem; color: #6c757d; display: none;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¸</p>
            <p><strong>Capture d'Ã©cran Ã  venir</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: #adb5bd;">screenshots/modal-command.png</p>
        </div>
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal d'envoi de commandes (SET_SLEEP_SECONDS, PING, UPDATE_CONFIG, etc.)</p>
    </div>
    
    <h4>Modal Flash USB</h4>
    <p>Le modal pour le flash USB et le streaming sÃ©rie en temps rÃ©el :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-usb-streaming.png" alt="Modal flash USB" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de flash USB avec sÃ©lection de port sÃ©rie, choix de firmware, et terminal sÃ©rie avec filtres de logs et export</p>
    </div>
    
    <h4>Modal Upload Firmware</h4>
    <p>Le modal pour tÃ©lÃ©verser un nouveau firmware :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-upload-firmware.png" alt="Modal upload firmware" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Modal de tÃ©lÃ©versement de firmware avec version, notes et option stable/beta</p>
    </div>
    
    <h4>Modal DÃ©tails Dispositif - Onglet Alertes</h4>
    <p>L'onglet Alertes du modal de dÃ©tails dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-device-alerts.png" alt="Modal alertes dispositif" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Onglet Alertes du modal de dÃ©tails avec liste des alertes du dispositif</p>
    </div>
    
    <h4>Modal DÃ©tails Dispositif - Onglet Journal</h4>
    <p>L'onglet Journal du modal de dÃ©tails dispositif :</p>
    <div style="text-align: center; margin: 2rem 0;">
        <img src="screenshots/modal-device-logs.png" alt="Modal logs dispositif" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
        <p class="text-sm text-gray-600" style="margin-top: 0.5rem;">Onglet Journal du modal de dÃ©tails avec logs du dispositif</p>
    </div>
</section>

<section id="security" class="section">
    <h2>ğŸ”’ SÃ©curitÃ© & Permissions</h2>
    
    <h3>ğŸ›¡ï¸ SÃ©curitÃ© ComplÃ¨te de l'Application</h3>
    
    <p>L'application OTT implÃ©mente une sÃ©curitÃ© multi-niveaux pour protÃ©ger les donnÃ©es mÃ©dicales sensibles et garantir l'intÃ©gritÃ© du systÃ¨me.</p>
    
    <h4>1. ğŸ” Authentification et Autorisation</h4>
    
    <ul>
        <li><strong>JWT (JSON Web Tokens)</strong> : Tokens signÃ©s avec HMAC-SHA256, expiration 24h, vÃ©rification cÃ´tÃ© serveur</li>
        <li><strong>Passwords hashÃ©s</strong> : Bcrypt avec cost 10, jamais stockÃ©s en clair</li>
        <li><strong>SystÃ¨me de permissions</strong> : RÃ´les (admin, mÃ©decin, technicien) avec permissions granulaires</li>
        <li><strong>VÃ©rification d'activitÃ©</strong> : Seuls les utilisateurs actifs peuvent se connecter</li>
        <li><strong>Audit des connexions</strong> : Toutes les tentatives de connexion sont enregistrÃ©es</li>
    </ul>
    
    <h4>2. ğŸ›¡ï¸ Protection des DonnÃ©es</h4>
    
    <ul>
        <li><strong>SQL Injection Protection</strong> : 100% des requÃªtes utilisent PDO::prepare() avec paramÃ¨tres liÃ©s</li>
        <li><strong>Chiffrement HTTPS</strong> : Toutes les communications sont chiffrÃ©es</li>
        <li><strong>Soft Delete</strong> : Suppression logique pour rÃ©cupÃ©ration des donnÃ©es</li>
        <li><strong>Validation des donnÃ©es</strong> : Validation stricte cÃ´tÃ© serveur et client</li>
    </ul>
    
    <h3>ğŸ“Š Tableau RÃ©capitulatif des Droits par RÃ´le</h3>
    
    <p>Le systÃ¨me OTT utilise un systÃ¨me de permissions granulaires avec 3 rÃ´les principaux. Voici un rÃ©capitulatif complet des droits d'accÃ¨s pour chaque type d'utilisateur :</p>
    
    <table style="width: 100%; border-collapse: collapse; margin: 2rem 0; font-size: 0.95rem;">
        <thead>
            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;">FonctionnalitÃ© / Action</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #ddd;">ğŸ‘‘ Admin</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #ddd;">ğŸ‘¨â€âš•ï¸ MÃ©decin</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #ddd;">ğŸ”§ Technicien</th>
            </tr>
        </thead>
        <tbody>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ“Š VUE D'ENSEMBLE</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Consulter le tableau de bord (KPI, graphiques)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ”Œ DISPOSITIFS</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir la liste des dispositifs</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir les dÃ©tails d'un dispositif (statut, batterie, logs)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Modifier les informations d'un dispositif (nom, patient assignÃ©)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">DÃ©clencher une mise Ã  jour OTA (Over-The-Air)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Envoyer des commandes aux dispositifs (SET_SLEEP_SECONDS, PING, etc.)</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ¥ PATIENTS</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir la liste des patients</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">CrÃ©er un nouveau patient</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Modifier les informations d'un patient</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Assigner un dispositif Ã  un patient</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="4" style="padding: 0.75rem; font-weight: bold; background: #e9ecef;">ğŸ‘¥ UTILISATEURS</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">Voir la liste des utilisateurs</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">CrÃ©er un nouvel utilisateur</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
            </tr>
            <tr>
                <td style="padding: 0.75rem; border: 1px solid #ddd;">GÃ©rer les rÃ´les et permissions des utilisateurs</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âœ…</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
                <td style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">âŒ</td>
            </tr>
        </tbody>
    </table>
    
    <div class="alert alert-info" style="margin-top: 2rem;">
        <strong>ğŸ’¡ Note importante :</strong>
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li><strong>Admin</strong> : AccÃ¨s complet Ã  toutes les fonctionnalitÃ©s. Seul rÃ´le pouvant gÃ©rer les utilisateurs et consulter l'audit.</li>
            <li><strong>MÃ©decin</strong> : AccÃ¨s en lecture/Ã©criture aux patients et dispositifs, mais pas aux fonctions techniques (OTA, commandes, firmware). Peut rÃ©soudre les alertes.</li>
            <li><strong>Technicien</strong> : AccÃ¨s technique complet (OTA, commandes, configuration, firmware) mais ne peut pas gÃ©rer les utilisateurs ni supprimer des patients/dispositifs.</li>
        </ul>
    </div>
</section>

<section id="structure" class="section">
    <h2>ğŸ“ Structure du Projet</h2>
    
    <h3>ğŸ¯ Organisation Principale</h3>
    
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #667eea; margin-bottom: 1rem;">ğŸ“± Frontend (Next.js)</h4>
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>app/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Application Next.js principale</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â””â”€ <code>dashboard/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Pages du dashboard (12 pages)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>page.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Vue d'ensemble</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>devices/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Gestion dispositifs (carte, OTA, commandes)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>patients/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Gestion patients</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>users/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Gestion utilisateurs</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>outils/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Outils (firmware, USB, streaming)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>configuration/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Configuration dispositifs</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€ <code>firmware-upload/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Upload & compilation firmware</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;&nbsp;&nbsp;â””â”€ <code>documentation/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Documentation intÃ©grÃ©e</td>
            </tr>
        </table>
    </div>
    
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #667eea; margin-bottom: 1rem;">ğŸ“¦ Composants & Contextes</h4>
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>components/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Composants React rÃ©utilisables (20+ composants)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>configuration/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Onglets configuration (Device, Firmware, USB, Editor)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>Sidebar.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Menu navigation avec permissions</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â””â”€ <code>LeafletMap.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Carte interactive des dispositifs</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>contexts/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Contextes React (Ã©tat global)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>AuthContext.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Authentification JWT + refresh token</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â””â”€ <code>UsbContext.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Gestion USB (Web Serial API)</td>
            </tr>
        </table>
    </div>
    
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #667eea; margin-bottom: 1rem;">ğŸ“š BibliothÃ¨ques Utilitaires</h4>
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>lib/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">BibliothÃ¨ques utilitaires</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>api.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Helpers API (fetchJson, gestion erreurs)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>deviceCommands.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Construction payloads OTA (UPDATE_CONFIG, UPDATE_CALIBRATION)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>measurementSender.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Envoi mesures robuste avec retry</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â””â”€ <code>measurementQueue.js</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Queue mesures (IndexedDB) pour offline</td>
            </tr>
        </table>
    </div>
    
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #667eea; margin-bottom: 1rem;">ğŸ”§ Backend & Infrastructure</h4>
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>api.php</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">API Backend PHP (monolithique, REST)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>api/handlers/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Handlers modulaires (auth, devices, firmwares, notifications)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>sql/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">SchÃ©mas & migrations PostgreSQL</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â”œâ”€ <code>schema.sql</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">SchÃ©ma principal (16 tables)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â””â”€ <code>migration_*.sql</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Migrations (min/max, firmware, etc.)</td>
            </tr>
        </table>
    </div>
    
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #667eea; margin-bottom: 1rem;">ğŸ”Œ Hardware & Firmware</h4>
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>hardware/firmware/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Firmware source et compilÃ©s</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">&nbsp;&nbsp;â””â”€ <code>fw_ott_optimized/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">Code source du firmware (versionnÃ©)</td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;"><code>hardware/lib/TinyGSM/</code></td>
                <td style="padding: 0.5rem; border-bottom: 1px solid #dee2e6;">BibliothÃ¨que GSM (modem 4G)</td>
            </tr>
        </table>
    </div>
    
    <h3>ğŸ“ Chemins Importants</h3>
    <ul>
        <li><strong>Firmware Source</strong> : <code>hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino</code> (v1.0 production)</li>
        <li><strong>Firmwares CompilÃ©s</strong> : GÃ©nÃ©rÃ©s localement ou via dashboard (format .bin)</li>
        <li><strong>Firmwares UploadÃ©s</strong> : Via dashboard â†’ Menu Firmware â†’ Upload .ino</li>
        <li><strong>BibliothÃ¨ques</strong> : <code>hardware/lib/TinyGSM/</code></li>
        <li><strong>Scripts Build</strong> : <code>scripts/build_firmware_bin.ps1</code> et <code>scripts/flash_firmware.ps1</code></li>
    </ul>
    
    <h3>ğŸ”„ Workflow RecommandÃ©</h3>
    <h4>Pour un dÃ©veloppeur :</h4>
    <ol>
        <li>Modifier le firmware source : <code>hardware/firmware/fw_ott_optimized/fw_ott_optimized.ino</code></li>
        <li>Compiler localement : Via Arduino IDE ou <code>.\scripts\build_firmware_bin.ps1</code></li>
        <li>Tester : <code>.\scripts\flash_firmware.ps1 -Port COM6</code></li>
        <li>Ou uploader via dashboard : Menu "Firmware" â†’ Upload .ino â†’ Compilation automatique</li>
    </ol>
    
    <h4>Pour un admin/technicien :</h4>
    <ol>
        <li>Upload .ino : Menu "Firmware" â†’ Upload fichier</li>
        <li>Compilation automatique : Logs en direct</li>
        <li>Flash : Page "Dispositifs" â†’ SÃ©lectionner firmware â†’ OTA ou USB</li>
    </ol>
</section>

<section id="database" class="section">
    <h2>ğŸ—„ï¸ Base de DonnÃ©es PostgreSQL</h2>
    
    <h3>ğŸ“ SchÃ©ma Relationnel</h3>
    <p>Base PostgreSQL pour le systÃ¨me OTT - Gestion de dispositifs mÃ©dicaux IoT avec notifications, OTA, et audit.</p>
    
    <h4>ğŸ” Authentification & Permissions</h4>
    <ul>
        <li><strong>roles</strong> : RÃ´les utilisateurs (admin, medecin, technicien)</li>
        <li><strong>permissions</strong> : Permissions systÃ¨me (devices.view, patients.edit, etc.)</li>
        <li><strong>role_permissions</strong> : Table de liaison roles â†” permissions</li>
        <li><strong>users</strong> : Utilisateurs du systÃ¨me</li>
    </ul>
    
    <h4>ğŸ‘¥ Patients</h4>
    <ul>
        <li><strong>patients</strong> : Patients suivis</li>
        <li><strong>patient_notifications_preferences</strong> : PrÃ©fÃ©rences de notifications des patients</li>
    </ul>
    
    <h4>ğŸ“± Dispositifs</h4>
    <ul>
        <li><strong>devices</strong> : Dispositifs IoT OTT (PK: id, UNIQUE: sim_iccid, device_serial)</li>
        <li><strong>device_configurations</strong> : Configuration des dispositifs (firmware, OTA, calibration)</li>
        <li><strong>measurements</strong> : Mesures de dÃ©bit et batterie (inclut colonne <code>deleted_at</code> pour l'archivage logiciel)</li>
        <li><strong>alerts</strong> : Alertes systÃ¨me (batterie faible, offline, etc.)</li>
        <li><strong>device_logs</strong> : Logs Ã©vÃ©nements dispositifs</li>
        <li><strong>device_commands</strong> : Commandes envoyÃ©es aux dispositifs</li>
    </ul>
    
    <h4>ğŸ“¦ Archivage des Mesures (Soft Delete)</h4>
    <p>La table <code>measurements</code> utilise un systÃ¨me d'archivage logiciel avec la colonne <code>deleted_at</code> :</p>
    <ul>
        <li><strong>Colonne</strong> : <code>deleted_at TIMESTAMPTZ</code> (nullable, NULL = actif, valeur = archivÃ©)</li>
        <li><strong>Archivage</strong> : Les mesures archivÃ©es conservent leurs donnÃ©es mais sont exclues des requÃªtes par dÃ©faut</li>
        <li><strong>Restauration</strong> : Les mesures peuvent Ãªtre restaurÃ©es en remettant <code>deleted_at</code> Ã  NULL</li>
        <li><strong>Suppression dÃ©finitive</strong> : Option disponible uniquement pour les administrateurs</li>
        <li><strong>Migration</strong> : Script disponible : <code>sql/migration_add_measurements_deleted_at.sql</code></li>
    </ul>
    
    <h4>ğŸ”„ Firmwares</h4>
    <ul>
        <li><strong>firmware_versions</strong> : Versions de firmware disponibles (PK: id, UNIQUE: version)</li>
    </ul>
    
    <h4>ğŸ“§ Notifications</h4>
    <ul>
        <li><strong>user_notifications_preferences</strong> : PrÃ©fÃ©rences de notifications des utilisateurs</li>
        <li><strong>notifications_queue</strong> : File d'attente des notifications Ã  envoyer</li>
    </ul>
    
    <h4>ğŸ“ Audit</h4>
    <ul>
        <li><strong>audit_logs</strong> : Logs d'audit de toutes les actions</li>
    </ul>
    
    <h3>ğŸ” Vues (Views)</h3>
    <ul>
        <li><strong>device_stats</strong> : Statistiques agrÃ©gÃ©es des dispositifs</li>
        <li><strong>users_with_roles</strong> : Utilisateurs enrichis avec rÃ´les et permissions</li>
    </ul>
    
    <h3>ğŸ”— RÃ¨gles de Cascade</h3>
    <p>Les suppressions en cascade sont configurÃ©es pour garantir l'intÃ©gritÃ© des donnÃ©es :</p>
    <ul>
        <li>Suppression d'un device â†’ suppression automatique des measurements, alerts, logs, commands associÃ©s</li>
        <li>Suppression d'un patient â†’ les devices associÃ©s ont leur patient_id mis Ã  NULL (ON DELETE SET NULL)</li>
        <li>Suppression d'un utilisateur â†’ les audit_logs conservent l'user_id (ON DELETE SET NULL)</li>
    </ul>
    
    <h4>ğŸ› ï¸ Migrations SQL</h4>
    <p>Des scripts SQL de migration sont disponibles dans <code>sql/</code> :</p>
    <ul>
        <li><strong><code>migration.sql</strong></code> : Migration complÃ¨te (schÃ©ma + migrations)</li>
        <li><strong><code>migration_add_measurements_deleted_at.sql</strong></code> : Ajout de la colonne <code>deleted_at</code> Ã  <code>measurements</code></li>
        <li><strong><code>migration_cleanup_device_names.sql</strong></code> : Nettoyage des noms de dispositifs (suppression des noms de patients)</li>
        <li><strong>ExÃ©cution</strong> : Via la page "ğŸ› ï¸ Migrations" dans le dashboard (admin uniquement) ou directement en base de donnÃ©es</li>
    </ul>
    
    <div class="alert alert-info">
        <strong>ğŸ“Š Statistiques</strong><br>
        - Total tables : 16<br>
        - Total vues : 2<br>
        - Total relations : 20+<br>
        - Index : 6<br>
        - Triggers : 7 (mise Ã  jour automatique de updated_at)
    </div>
</section>

<section id="firmware-workflow" class="section">
    <h2>ğŸ”§ Compilation et Flash du Firmware</h2>
    
    <h3>ğŸ“¤ Workflow Complet</h3>
    <p>Le systÃ¨me permet un workflow complet de gestion du firmware depuis le dashboard :</p>
    
    <h4>1. Upload du fichier .ino</h4>
    <ol>
        <li>Un admin/technicien se connecte au dashboard</li>
        <li>AccÃ¨de au menu "Firmware" (visible uniquement pour admin/technicien)</li>
        <li>Clique sur "Upload Firmware" et sÃ©lectionne un fichier <code>.ino</code></li>
        <li>Le fichier est uploadÃ© vers <code>hardware/firmware/vX.X/</code> avec extraction automatique de la version</li>
        <li>Un enregistrement est crÃ©Ã© dans la table <code>firmware_versions</code> avec le statut <code>pending_compilation</code></li>
    </ol>
    
    <h4>2. Compilation en Direct (SSE)</h4>
    <p>La compilation utilise <strong>Server-Sent Events (SSE)</strong> pour streamer les logs et la progression en temps rÃ©el :</p>
    
    <h5>ğŸ”§ FonctionnalitÃ©s de Compilation</h5>
    <ul>
        <li><strong>Streaming en temps rÃ©el</strong> : Tous les logs de compilation sont affichÃ©s en direct dans le dashboard</li>
        <li><strong>Progression garantie</strong> : La barre de progression ne peut que monter (protection backend + frontend contre les retours en arriÃ¨re)</li>
        <li><strong>Gestion automatique du core ESP32</strong> : TÃ©lÃ©chargement et installation automatique si nÃ©cessaire (~568MB, une seule fois)</li>
        <li><strong>Progression dÃ©taillÃ©e</strong> : Suivi en temps rÃ©el du tÃ©lÃ©chargement du core (45-50% de la compilation totale)</li>
        <li><strong>Logs dÃ©taillÃ©s</strong> : Utilisation de <code>arduino-cli --verbose</code> pour un diagnostic complet</li>
        <li><strong>Gestion des timeouts</strong> : Timeouts adaptÃ©s pour les opÃ©rations longues (20 minutes pour le tÃ©lÃ©chargement du core)</li>
        <li><strong>VÃ©rification pÃ©riodique</strong> : Si la connexion SSE se ferme, le systÃ¨me vÃ©rifie pÃ©riodiquement le statut via l'API</li>
    </ul>
    
    <h5>ğŸ“Š Phases de Compilation</h5>
    <ol>
        <li><strong>DÃ©marrage (10%)</strong> : Validation du fichier .ino et prÃ©paration de l'environnement</li>
        <li><strong>VÃ©rification arduino-cli (20%)</strong> : DÃ©tection de l'outil de compilation</li>
        <li><strong>PrÃ©paration environnement (30%)</strong> : Configuration des chemins et bibliothÃ¨ques</li>
        <li><strong>VÃ©rification core ESP32 (40%)</strong> : VÃ©rification de l'installation du core</li>
        <li><strong>TÃ©lÃ©chargement core (45-50%)</strong> : Si nÃ©cessaire, tÃ©lÃ©chargement et installation du core ESP32 avec progression en temps rÃ©el</li>
        <li><strong>Compilation (60%)</strong> : Compilation du firmware avec logs dÃ©taillÃ©s</li>
        <li><strong>Recherche .bin (80%)</strong> : Localisation du fichier .bin gÃ©nÃ©rÃ©</li>
        <li><strong>Calcul checksums (95%)</strong> : Calcul des checksums MD5 et SHA256</li>
        <li><strong>Stockage (100%)</strong> : Stockage en base de donnÃ©es et mise Ã  jour du statut</li>
    </ol>
    
    <h5>ğŸ’¾ Stockage et Cache</h5>
    <ul>
        <li><strong>Stockage en base</strong> : Le fichier .bin est stockÃ© en base de donnÃ©es (BYTEA) pour Ã©viter les problÃ¨mes de disque persistant</li>
        <li><strong>Cache navigateur</strong> : Les fichiers .bin tÃ©lÃ©chargÃ©s sont mis en cache par le navigateur (ETag, Cache-Control) pour Ã©viter les re-tÃ©lÃ©chargements</li>
        <li><strong>Core ESP32</strong> : Le core est stockÃ© dans <code>hardware/arduino-data/</code> pour Ãªtre rÃ©utilisÃ© entre les compilations</li>
    </ul>
    
    <h5>ğŸ›¡ï¸ Gestion des Erreurs</h5>
    <ul>
        <li><strong>DÃ©tection automatique</strong> : Les erreurs de compilation sont dÃ©tectÃ©es et affichÃ©es en temps rÃ©el</li>
        <li><strong>Messages explicites</strong> : Messages d'erreur dÃ©taillÃ©s avec suggestions de correction</li>
        <li><strong>Gestion des timeouts HTTP</strong> : DÃ©tection spÃ©cifique des timeouts lors du tÃ©lÃ©chargement du core avec suggestion de retry</li>
        <li><strong>RÃ©cupÃ©ration automatique</strong> : En cas de dÃ©connexion SSE, vÃ©rification pÃ©riodique du statut final</li>
    </ul>
    
    <div class="alert alert-info">
        <strong>â„¹ï¸ Note Technique</strong><br>
        La progression est protÃ©gÃ©e Ã  deux niveaux :<br>
        - <strong>Backend</strong> : Fonction <code>$sendProgress()</code> qui ne permet que d'augmenter la progression<br>
        - <strong>Frontend</strong> : <code>Math.max(prev, newProgress)</code> pour garantir que la progression ne recule jamais<br>
        Cela Ã©vite les problÃ¨mes de messages SSE arrivant dans le dÃ©sordre.
    </div>
    
    <h4>3. TÃ©lÃ©chargement du Firmware CompilÃ©</h4>
    <p>Une fois compilÃ©, le firmware peut Ãªtre tÃ©lÃ©chargÃ© depuis le dashboard :</p>
    <ul>
        <li><strong>Cache navigateur</strong> : Les fichiers .bin sont mis en cache par le navigateur (ETag, Cache-Control: public, max-age=31536000)</li>
        <li><strong>Ã‰vite les re-tÃ©lÃ©chargements</strong> : Si le fichier n'a pas changÃ©, le navigateur utilise la version en cache (HTTP 304 Not Modified)</li>
        <li><strong>Stockage en base</strong> : Le fichier .bin est stockÃ© en base de donnÃ©es (BYTEA), pas sur disque</li>
        <li><strong>Performance</strong> : Les tÃ©lÃ©chargements suivants sont instantanÃ©s grÃ¢ce au cache navigateur</li>
    </ul>
    
    <h4>4. Flash du Firmware</h4>
    <p>Une fois compilÃ© et tÃ©lÃ©chargÃ©, le firmware peut Ãªtre flashÃ© de deux maniÃ¨res :</p>
    
    <h5>Via OTA (Over-The-Air)</h5>
    <ol>
        <li>Aller dans la page "Dispositifs"</li>
        <li>Ouvrir les dÃ©tails d'un dispositif en ligne</li>
        <li>Dans l'onglet "DÃ©tails", section "Flash Firmware"</li>
        <li>SÃ©lectionner le firmware compilÃ©</li>
        <li>Cliquer sur "Flash OTA"</li>
        <li>Le firmware est tÃ©lÃ©chargÃ© et flashÃ© via le rÃ©seau 4G</li>
    </ol>
    
    <h5>Via USB</h5>
    <ol>
        <li>Connecter le dispositif en USB</li>
        <li>Aller dans la page "Dispositifs"</li>
        <li>Ouvrir les dÃ©tails du dispositif connectÃ©</li>
        <li>Dans l'onglet "DÃ©tails", section "Flash Firmware"</li>
        <li>SÃ©lectionner le firmware compilÃ©</li>
        <li>Cliquer sur "Flash USB"</li>
        <li>Le firmware est flashÃ© directement via le port sÃ©rie USB</li>
    </ol>
    
    <h3>ğŸ”Œ Communication USB et device_info</h3>
    <p>Lors de la connexion USB, le firmware envoie automatiquement ses informations au format JSON :</p>
    <pre><code>{
  "type": "device_info",
  "sim_iccid": "89331508210512788370",
  "device_serial": "OTT-25-001",
  "firmware_version": "1.0",
  "device_name": "OTT-8370"
}</code></pre>
    
    <p>Ces informations sont automatiquement :</p>
    <ul>
        <li>ParsÃ©es par le dashboard</li>
        <li>UtilisÃ©es pour identifier le dispositif dans la base de donnÃ©es</li>
        <li>Mises Ã  jour dans la base si le dispositif existe dÃ©jÃ </li>
    </ul>
    
    <h3>ğŸ”„ Mise Ã  Jour Automatique du Firmware Version</h3>
    <p>Lorsqu'un dispositif envoie un message <code>device_info</code> avec une version de firmware :</p>
    <ol>
        <li>Le dashboard reÃ§oit le message via USB</li>
        <li>La version est extraite du JSON</li>
        <li>Un callback est dÃ©clenchÃ© pour mettre Ã  jour la base de donnÃ©es</li>
        <li>Le champ <code>firmware_version</code> du dispositif est mis Ã  jour automatiquement</li>
        <li>La configuration du dispositif (<code>device_configurations</code>) est Ã©galement mise Ã  jour</li>
    </ol>
    
    <div class="alert alert-success">
        <strong>âœ… Avantages</strong><br>
        - Pas besoin de mise Ã  jour manuelle de la version<br>
        - Synchronisation automatique entre firmware et base de donnÃ©es<br>
        - TraÃ§abilitÃ© complÃ¨te des versions installÃ©es
    </div>
</section>

<section id="compatibility" class="section">
    <h2>ğŸ”— CompatibilitÃ© Firmware â†” API â†” Dashboard</h2>
    
    <h3>âœ… CompatibilitÃ© Firmware â†” API</h3>
    <h4>Format ICCID</h4>
    <ul>
        <li><strong>Firmware</strong> : Envoie <code>device_sim_iccid</code> dans le payload JSON et <code>X-Device-ICCID</code> dans les headers HTTP</li>
        <li><strong>API</strong> : Accepte <code>device_sim_iccid</code> OU <code>sim_iccid</code> dans le payload</li>
        <li><strong>Validation</strong> : Max 20 caractÃ¨res (VARCHAR(20) en base)</li>
    </ul>
    
    <h4>Payload Mesures</h4>
    <p>Le firmware envoie :</p>
    <pre><code>{
  "sim_iccid": "89331508210512788370",
  "device_serial": "OTT-25-001",
  "firmware_version": "1.0",
  "flowrate": 2.34,
  "flow_lpm": 2.34,
  "battery": 85.5,
  "battery_percent": 85.5,
  "rssi": -75,
  "firmware_version": "v2.0",
  "timestamp": "2025-01-15T10:30:00Z",
  "status": "TIMER"
}</code></pre>
    
    <p>L'API accepte :</p>
    <ul>
        <li><code>sim_iccid</code> OU <code>device_sim_iccid</code> âœ…</li>
        <li><code>flowrate</code> OU <code>flow</code> OU <code>payload.flowrate</code> âœ…</li>
        <li><code>battery</code> OU <code>payload.battery</code> âœ…</li>
        <li><code>signal_strength</code> OU <code>rssi</code> âœ…</li>
        <li><code>firmware_version</code> (optionnel) âœ…</li>
    </ul>
    
    <h3>âœ… CompatibilitÃ© Firmware â†” Dashboard</h3>
    <h4>Endpoints API</h4>
    <table>
        <tr>
            <th>Endpoint Firmware</th>
            <th>Endpoint API</th>
            <th>MÃ©thode</th>
            <th>Statut</th>
        </tr>
        <tr>
            <td><code>/api.php/devices/measurements</code></td>
            <td><code>/api.php/devices/measurements</code></td>
            <td>POST</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>/api.php/devices/{ICCID}/commands/pending</code></td>
            <td><code>/api.php/devices/{iccid}/commands/pending</code></td>
            <td>GET</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>/api.php/devices/commands/ack</code></td>
            <td><code>/api.php/devices/commands/ack</code></td>
            <td>POST</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>/api.php/devices/logs</code></td>
            <td><code>/api.php/devices/logs</code></td>
            <td>POST</td>
            <td>âœ…</td>
        </tr>
    </table>
    
    <h4>Commandes SupportÃ©es</h4>
    <table>
        <tr>
            <th>Commande</th>
            <th>Firmware</th>
            <th>Dashboard</th>
            <th>Statut</th>
        </tr>
        <tr>
            <td><code>SET_SLEEP_SECONDS</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>PING</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>UPDATE_CONFIG</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>UPDATE_CALIBRATION</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td><code>OTA_REQUEST</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
    </table>
    
    <h4>Enregistrement Automatique des Dispositifs</h4>
    <p>Lorsqu'un dispositif envoie sa premiÃ¨re mesure ou log :</p>
    <ul>
        <li>âœ… Le dispositif est automatiquement dÃ©tectÃ© et enregistrÃ© dans la base de donnÃ©es</li>
        <li>âœ… Aucune configuration manuelle requise</li>
        <li>âœ… Les informations (ICCID, firmware_version, battery, etc.) sont capturÃ©es automatiquement</li>
        <li>âœ… Le statut est dÃ©fini Ã  <code>active</code> par dÃ©faut</li>
    </ul>
</section>

<section id="roles-permissions" class="section">
    <h2>ğŸ” RÃ´les et Permissions</h2>
    
    <h3>ğŸ‘‘ Administrateur (admin)</h3>
    <p><strong>AccÃ¨s complet Ã  toutes les fonctionnalitÃ©s</strong></p>
    <ul>
        <li>âœ… Gestion complÃ¨te des utilisateurs (crÃ©ation, modification, suppression)</li>
        <li>âœ… Gestion complÃ¨te des dispositifs (crÃ©ation, modification, suppression, OTA)</li>
        <li>âœ… Gestion complÃ¨te des patients (crÃ©ation, modification, suppression)</li>
        <li>âœ… Configuration systÃ¨me et paramÃ¨tres</li>
        <li>âœ… AccÃ¨s au journal d'audit complet</li>
        <li>âœ… Gestion des firmwares et dÃ©ploiements OTA</li>
        <li>âœ… RÃ©solution de toutes les alertes</li>
        <li>âœ… Export de toutes les donnÃ©es</li>
    </ul>
    <p><strong>Utilisateurs :</strong> Maxime, Yann (2 admins maximum)</p>
    
    <h3>ğŸ”§ Technicien (technicien)</h3>
    <p><strong>Maintenance et configuration des dispositifs</strong></p>
    <h4>âœ… Permissions</h4>
    <ul>
        <li><strong>Dispositifs</strong> : Voir, modifier, configurer, envoyer commandes, OTA</li>
        <li><strong>Alertes</strong> : Voir toutes les alertes, rÃ©soudre les alertes techniques</li>
        <li><strong>Rapports</strong> : Voir les rapports techniques</li>
    </ul>
    <h4>âŒ Restrictions</h4>
    <ul>
        <li>Ne peut pas gÃ©rer les patients</li>
        <li>Ne peut pas gÃ©rer les utilisateurs</li>
        <li>Ne peut pas accÃ©der au journal d'audit complet</li>
        <li>Ne peut pas modifier les paramÃ¨tres systÃ¨me</li>
    </ul>
    <p><strong>Utilisateurs :</strong> 3 techniciens maximum</p>
    
    <h3>ğŸ‘¨â€âš•ï¸ MÃ©decin (medecin)</h3>
    <p><strong>Consultation des patients et suivi mÃ©dical</strong></p>
    <h4>âœ… Permissions</h4>
    <ul>
        <li><strong>Patients</strong> : Voir tous les patients, modifier les donnÃ©es, exporter</li>
        <li><strong>Dispositifs</strong> : Voir la liste et les dÃ©tails (lecture seule)</li>
        <li><strong>Rapports</strong> : Voir les rapports mÃ©dicaux, exporter</li>
        <li><strong>Alertes</strong> : Voir les alertes (lecture seule)</li>
    </ul>
    <h4>âŒ Restrictions</h4>
    <ul>
        <li>Ne peut pas modifier les dispositifs</li>
        <li>Ne peut pas effectuer d'OTA ou envoyer des commandes</li>
        <li>Ne peut pas gÃ©rer les utilisateurs</li>
        <li>Ne peut pas accÃ©der au journal d'audit complet</li>
        <li>Ne peut pas rÃ©soudre les alertes techniques</li>
    </ul>
    <p><strong>Utilisateurs :</strong> 2 mÃ©decins maximum</p>
    
    <h3>ğŸ“Š Tableau des Permissions</h3>
    <table>
        <tr>
            <th>Permission</th>
            <th>Code</th>
            <th>Admin</th>
            <th>Technicien</th>
            <th>MÃ©decin</th>
        </tr>
        <tr>
            <td colspan="5"><strong>Dispositifs</strong></td>
        </tr>
        <tr>
            <td>Voir dispositifs</td>
            <td><code>devices.view</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td>Modifier dispositifs</td>
            <td><code>devices.edit</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
        </tr>
        <tr>
            <td>Mises Ã  jour OTA</td>
            <td><code>devices.ota</code></td>
            <td>âœ…</td>
            <td>âœ…</td>
            <td>âŒ</td>
        </tr>
        <tr>
            <td colspan="5"><strong>Patients</strong></td>
        </tr>
        <tr>
            <td>Voir patients</td>
            <td><code>patients.view</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td>Modifier patients</td>
            <td><code>patients.edit</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âœ…</td>
        </tr>
        <tr>
            <td colspan="5"><strong>Utilisateurs</strong></td>
        </tr>
        <tr>
            <td>GÃ©rer utilisateurs</td>
            <td><code>users.manage</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âŒ</td>
        </tr>
        <tr>
            <td colspan="5"><strong>Audit</strong></td>
        </tr>
        <tr>
            <td>Voir audit</td>
            <td><code>audit.view</code></td>
            <td>âœ…</td>
            <td>âŒ</td>
            <td>âŒ</td>
        </tr>
    </table>
</section>

<section id="measurements-queue" class="section">
    <h2>ğŸ“Š SystÃ¨me de Queue de Mesures</h2>
    
    <h3>MÃ©canisme de Retry</h3>
    <ul>
        <li>Queue locale IndexedDB (persistante)</li>
        <li>Retry avec exponential backoff (1s, 2s, 4s, 8s, 16s, 32s max)</li>
        <li>Maximum 5 tentatives</li>
        <li>Validation des donnÃ©es avant envoi</li>
    </ul>
    
    <h3>Statistiques Graphiques</h3>
    <ul>
        <li>Affichage : Min, Max, Moyenne, Dernier</li>
        <li>Limites dÃ©finies pour Ã©viter dÃ©bordement</li>
        <li>Tooltips avec unitÃ©s et formatage</li>
    </ul>
</section>

<section id="roadmap" class="section">
    <h2>ğŸš€ Roadmap</h2>
    
    <div class="alert alert-success">
        <strong>âœ… Version 1.0 Production (Actuelle)</strong><br>
        Version actuellement dÃ©ployÃ©e avec les fonctionnalitÃ©s suivantes :
        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
            <li>âœ… Pagination complÃ¨te sur tous les endpoints de liste</li>
            <li>âœ… Cache Redis optionnel avec fallback mÃ©moire</li>
            <li>âœ… Monitoring Sentry intÃ©grÃ©</li>
            <li>âœ… Documentation API OpenAPI/Swagger</li>
            <li>âœ… Partage USB multi-onglets</li>
            <li>âœ… PWA installable (manifest.json, service worker)</li>
            <li>âœ… Streaming USB en temps rÃ©el avec UsbContext</li>
            <li>âœ… DÃ©tection automatique des dispositifs USB (Web Serial API)</li>
            <li>âœ… Dashboard React/Next.js complet avec authentification JWT</li>
            <li>âœ… Gestion multi-utilisateurs avec permissions granulaires</li>
            <li>âœ… API REST complÃ¨te avec PostgreSQL 15</li>
            <li>âœ… Mise Ã  jour OTA (Over-The-Air) du firmware</li>
            <li>âœ… Carte interactive Leaflet avec gÃ©olocalisation</li>
            <li>âœ… SystÃ¨me d'alertes et notifications</li>
            <li>âœ… <strong>Uniformisation UI/UX</strong> - Badges et tables cohÃ©rents</li>
            <li>âœ… <strong>Gestion des timers avec cleanup automatique</strong> - Hooks <code>useTimer</code></li>
            <li>âœ… <strong>Utilitaires de refactoring</strong> - <code>apiHelpers</code> et <code>errorHandler</code></li>
            <li>âœ… <strong>Gestion des archives</strong> - Seule restauration disponible pour Ã©lÃ©ments archivÃ©s</li>
            <li>âœ… <strong>Configuration serveur 3000</strong> - Support Docker standalone + GitHub Pages</li>
        </ul>
    </div>
    
    <h3>ğŸ“… Version 1.1 (Q1 2026)</h3>
    
    <h4>ğŸ” SÃ©curitÃ© AvancÃ©e</h4>
    <ul>
        <li>âœ¨ Authentification 2FA (Google Authenticator, SMS)</li>
        <li>âœ¨ Rotation automatique JWT secrets (90 jours)</li>
        <li>âœ¨ Logs d'audit avancÃ©s avec alertes automatiques</li>
        <li>âœ¨ DÃ©tection d'activitÃ©s suspectes</li>
    </ul>
    
    <h4>ğŸ“± PWA AmÃ©liorÃ©e</h4>
    <ul>
        <li>âœ¨ Notifications Push natives</li>
        <li>âœ¨ Mode offline complet (sync automatique)</li>
        <li>âœ¨ IcÃ´nes PWA personnalisÃ©es</li>
        <li>âœ¨ Installable sur iOS sans restrictions</li>
    </ul>
    
    <h4>ğŸ“Š Analytics & BI</h4>
    <ul>
        <li>âœ¨ Dashboard analytics avancÃ©</li>
        <li>âœ¨ PrÃ©dictions ML (pannes, batteries)</li>
        <li>âœ¨ Export automatique vers Excel/PDF</li>
        <li>âœ¨ Rapports programmÃ©s (hebdo, mensuel)</li>
    </ul>
    
    <h3>ğŸ“… Version 1.2 (Q2 2026)</h3>
    
    <h4>ğŸŒ Internationalisation</h4>
    <ul>
        <li>âœ¨ Support multi-langues (EN, ES, DE)</li>
        <li>âœ¨ Timezone awareness complet</li>
        <li>âœ¨ Formats de date localisÃ©s</li>
    </ul>
    
    <h4>âš¡ Performance</h4>
    <ul>
        <li>âœ¨ Migration vers TypeScript</li>
        <li>âœ¨ Server-Side Rendering (SSR)</li>
        <li>âœ¨ Optimisation base de donnÃ©es (indices)</li>
        <li>âœ¨ CDN pour assets statiques</li>
    </ul>
    
    <h3>ğŸ“… Version 4.0 (Q4 2026)</h3>
    
    <h4>ğŸ¤– Intelligence Artificielle</h4>
    <ul>
        <li>âœ¨ DÃ©tection anomalies automatique (ML)</li>
        <li>âœ¨ Maintenance prÃ©dictive</li>
        <li>âœ¨ Chatbot support intÃ©grÃ©</li>
        <li>âœ¨ Recommandations personnalisÃ©es</li>
    </ul>
    
    <h4>ğŸ¥ ConformitÃ© MÃ©dicale</h4>
    <ul>
        <li>âœ¨ Certification CE MÃ©dical Classe IIa</li>
        <li>âœ¨ ConformitÃ© RGPD complÃ¨te (audit externe)</li>
        <li>âœ¨ HDS (HÃ©bergement DonnÃ©es de SantÃ©)</li>
        <li>âœ¨ ISO 13485 (QualitÃ© dispositifs mÃ©dicaux)</li>
    </ul>
</section>

</div>

<div class="footer">
    <p style="font-size: 1.3rem; margin-bottom: 0.5rem;"><strong>Â© 2025 HAPPLYZ MEDICAL SAS</strong></p>
    <p>OTT - Version 1.0 Production | Documentation DÃ©veloppeurs</p>
    <p style="margin-top: 1rem; font-size: 1rem; font-weight: bold;">
        ğŸ“š Documentation :
        <a href="DOCUMENTATION_PRESENTATION.html" style="color: white; text-decoration: underline; margin: 0 0.5rem;">ğŸ“¸ PrÃ©sentation</a> | 
        <a href="DOCUMENTATION_DEVELOPPEURS.html" style="color: white; text-decoration: underline; margin: 0 0.5rem;">ğŸ’» DÃ©veloppeurs</a> | 
        <a href="DOCUMENTATION_COMMERCIALE.html" style="color: white; text-decoration: underline; margin: 0 0.5rem;">ğŸ’¼ Commerciale</a>
    </p>
    <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        ğŸŒ <a href="https://ymora.github.io/OTT/" style="color: white; text-decoration: underline;">Dashboard Live</a>
    </p>
</div>

</body>
</html>

