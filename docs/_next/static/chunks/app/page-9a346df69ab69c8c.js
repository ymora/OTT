(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{234:function(e,t,r){Promise.resolve().then(r.bind(r,2761))},2761:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c},dynamic:function(){return u}});var n=r(7437),o=r(2265),a=r(9376),s=r(9999);function i(){let e=(0,a.useRouter)(),{login:t}=(0,s.a)(),[r,i]=(0,o.useState)(""),[u,c]=(0,o.useState)(""),[l,d]=(0,o.useState)(!1),[h,m]=(0,o.useState)(""),f=(0,o.useRef)(null);(0,o.useEffect)(()=>()=>{f.current&&clearTimeout(f.current)},[]);let p=async n=>{if(n.preventDefault(),n.stopPropagation(),!l){d(!0),m("");try{await t(r,u),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{e.push("/dashboard")},100)}catch(e){m(e.message||"Erreur de connexion"),d(!1)}}};return(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-primary-500 via-primary-600 to-secondary-500 flex items-center justify-center p-4",children:[(0,n.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-white/10 rounded-full blur-3xl animate-pulse"}),(0,n.jsx)("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),(0,n.jsxs)("div",{className:"relative w-full max-w-md",children:[(0,n.jsxs)("div",{className:"card animate-slide-up shadow-2xl border-0",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg",children:(0,n.jsx)("svg",{className:"w-12 h-12 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,n.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent mb-2",children:"OTT Dashboard"}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"HAPPLYZ MEDICAL SAS"})]}),(0,n.jsxs)("form",{onSubmit:p,className:"space-y-5",children:[(0,n.jsxs)("div",{className:"group",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"\uD83D\uDCE7 Email"}),(0,n.jsx)("input",{type:"email",value:r,onChange:e=>i(e.target.value),className:"input group-hover:border-primary-300 focus:border-primary-500",placeholder:"votre@email.com",required:!0,disabled:l})]}),(0,n.jsxs)("div",{className:"group",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"\uD83D\uDD10 Mot de passe"}),(0,n.jsx)("input",{type:"password",value:u,onChange:e=>c(e.target.value),className:"input group-hover:border-primary-300 focus:border-primary-500",placeholder:"••••••••",required:!0,disabled:l})]}),h&&(0,n.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg animate-slide-down",children:(0,n.jsxs)("p",{className:"text-sm",children:["❌ ",h]})}),(0,n.jsxs)("button",{type:"submit",disabled:l,className:"w-full btn-primary py-3 text-lg disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group",children:[(0,n.jsx)("span",{className:l?"opacity-0":"opacity-100",children:"Connexion"}),l&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("div",{className:"w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin"})}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-primary-600 to-secondary-600 opacity-0 group-hover:opacity-100 transition-opacity -z-10"})]})]}),(0,n.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-100 dark:border-gray-700 text-center",children:[(0,n.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Besoin d'un acc\xe8s de d\xe9monstration\xa0?"}),(0,n.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Contactez support@happlyz.com pour obtenir des identifiants temporaires."})]})]}),(0,n.jsx)("div",{className:"text-center mt-6 text-white/80 text-sm",children:"Version 3.0.0 Enterprise | \xa9 2025 HAPPLYZ MEDICAL"})]})]})}let u="force-dynamic";function c(){let{user:e,loading:t}=(0,s.a)(),r=(0,a.useRouter)(),u=(0,a.usePathname)();return((0,o.useEffect)(()=>{u&&"/"!==u&&!u.startsWith("/dashboard")&&r.replace("/")},[u,r]),(0,o.useEffect)(()=>{if(!t&&e){let e=setTimeout(()=>{r.push("/dashboard")},500);return()=>clearTimeout(e)}},[e,t,r]),t)?(0,n.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)("div",{children:"Chargement..."})}):(0,n.jsx)(i,{})}},9999:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return d},a:function(){return h}});var n=r(7437),o=r(2265),a=r(8828);let s=(0,o.createContext)(),i="https://ott-jbln.onrender.com".replace(/\/$/,""),u=e=>/^https?:\/\//i.test(e),c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?u(e)?e:e.startsWith("/")?"".concat(i).concat(e):"".concat(i,"/").concat(e):i},l=e=>c(e);function d(e){let{children:t}=e,[r,u]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[h,m]=(0,o.useState)(!0);(0,o.useEffect)(()=>{a.Z.debug("[AuthContext] Initialisation...");try{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");if(a.Z.debug("[AuthContext] localStorage:",{hasToken:!!e,hasUser:!!t,tokenLength:(null==e?void 0:e.length)||0}),e&&t)try{let r=JSON.parse(t);d(e),u(r),a.Z.debug("[AuthContext] Utilisateur restaur\xe9:",r.email||r.username)}catch(e){a.Z.error("[AuthContext] Erreur parsing user:",e),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")}else a.Z.debug("[AuthContext] Aucun utilisateur stock\xe9")}catch(e){a.Z.error("[AuthContext] Erreur lors de l'initialisation:",e)}finally{m(!1),a.Z.debug("[AuthContext] Initialisation termin\xe9e, loading=false")}},[]);let f=async(e,t)=>{try{let r=await fetch(l("/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=r.headers.get("content-type")||"",o=n.includes("application/json");if(!r.ok||!o){let e=await r.text();a.Z.error("[AuthContext] ❌ Erreur serveur"),a.Z.error("[AuthContext] Status:",r.status),a.Z.error("[AuthContext] Content-Type:",n),a.Z.error("[AuthContext] R\xe9ponse compl\xe8te:",e);let t="Erreur serveur (".concat(r.status,")");try{let r=JSON.parse(e);t=r.error||r.message||t}catch(n){if(e.includes("Parse error")||e.includes("Fatal error")||e.includes("Warning")){let n=e.match(/(?:Parse error|Fatal error|Warning):\s*(.+?)(?:\n|$)/i);t=n?"Erreur PHP: ".concat(n[1].substring(0,200)):"Erreur serveur (".concat(r.status,"). L'API distante ne r\xe9pond pas correctement.")}else e.includes("Database")||e.includes("Connection")?t="Erreur de connexion \xe0 la base de donn\xe9es":500===r.status&&(t="Erreur serveur interne. L'API distante rencontre un probl\xe8me.")}{let t="[".concat(new Date().toISOString(),"] ERREUR API\n")+"URL: ".concat(l("/api.php/auth/login"),"\n")+"Status: ".concat(r.status,"\n")+"Content-Type: ".concat(n,"\n")+"R\xe9ponse: ".concat(e.substring(0,1e3),"\n\n");try{localStorage.setItem("api_error_log",t),a.Z.debug("[AuthContext] \uD83D\uDCBE Log sauvegard\xe9 dans localStorage")}catch(e){a.Z.error("[AuthContext] Erreur sauvegarde log:",e)}}throw Error(t)}let s=await r.json();if(!s.success)throw Error(s.error||"Erreur de connexion");return d(s.token),u(s.user),localStorage.setItem("ott_token",s.token),localStorage.setItem("ott_user",JSON.stringify(s.user)),s}catch(e){if(e.message&&e.message.includes("Erreur serveur"))throw e;throw a.Z.error("[AuthContext] ❌ Erreur lors de la connexion:",e),Error("Erreur de connexion au serveur. V\xe9rifiez votre connexion internet.")}},p=()=>{d(null),u(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:n=!1}=r,o={...t},a={...t.headers||{}};if(o.body&&!a["Content-Type"]&&(a["Content-Type"]="application/json"),c)a.Authorization="Bearer ".concat(c);else throw Error("Non authentifi\xe9");o.headers=a;let s=l(e),i=await fetch(s,o);if(401===i.status&&c)throw p(),Error("Session expir\xe9e");return i};return(0,n.jsx)(s.Provider,{value:{user:r,token:c,loading:h,login:f,logout:p,fetchWithAuth:g,API_URL:i},children:t})}let h=()=>{let e=(0,o.useContext)(s);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},8828:function(e,t,r){"use strict";r.d(t,{k:function(){return n}}),r(257);let n={log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error("[ERROR]",...t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]}};t.Z=n},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},257:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var u=[],c=!1,l=-1;function d(){c&&n&&(c=!1,n.length?u=n.concat(u):l=-1,u.length&&h())}function h(){if(!c){var e=i(d);c=!0;for(var t=u.length;t;){for(n=u,u=[];++l<t;)n&&n[l].run();l=-1,t=u.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||c||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}},s=!0;try{t[e](a,a.exports,n),s=!1}finally{s&&delete r[e]}return a.exports}n.ab="//";var o=n(229);e.exports=o}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=234)}),_N_E=e.O()}]);