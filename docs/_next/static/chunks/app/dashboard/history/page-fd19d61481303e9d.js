(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{6279:function(e,t,a){Promise.resolve().then(a.bind(a,5724))},5724:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),s=a(2265),n=a(9999),i=a(2617),l=a(4526);function o(){let{fetchWithAuth:e,API_URL:t}=(0,n.a)(),[a,o]=(0,s.useState)([]),[c,u]=(0,s.useState)(null),[d,m]=(0,s.useState)([]),[h,f]=(0,s.useState)(!0),[g,p]=(0,s.useState)(!1),[x,b]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{try{b(null);let a=(await (0,i.r)(e,t,"/api.php/devices")).devices||[];o(a),a.length>0&&u(a[0].id)}catch(e){b(e.message)}finally{f(!1)}})()},[e,t]),(0,s.useEffect)(()=>{c&&(async()=>{try{p(!0);let a=await (0,i.r)(e,t,"/api.php/device/".concat(c));m(a.measurements||[])}catch(e){b(e.message)}finally{p(!1)}})()},[c,e,t]),(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDCCB Historique"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Analyse d\xe9taill\xe9e des mesures par dispositif"})]}),(0,r.jsxs)("div",{className:"w-full md:w-64",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dispositif"}),(0,r.jsx)("select",{value:c||"",onChange:e=>u(e.target.value),className:"input",disabled:h||0===a.length,children:a.map(e=>(0,r.jsx)("option",{value:e.id,children:e.device_name||e.sim_iccid},e.id))})]})]}),x&&(0,r.jsxs)("div",{className:"alert alert-warning",children:[(0,r.jsx)("strong",{children:"Erreur :"})," ",x]}),h||g?(0,r.jsx)("div",{className:"card animate-shimmer h-64"}):(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCC8 D\xe9bit (72h)"}),(0,r.jsx)(l.Z,{data:d,type:"flowrate"})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDD0B Batterie"}),(0,r.jsx)(l.Z,{data:d.map(e=>({...e,last_battery:e.battery})),type:"battery"})]})]})]})}},4526:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var r=a(7437),s=a(6705),n=a(4084);function i(e){let{data:t=[],type:a}=e;if(!t||0===t.length)return(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-gray-400",children:(0,r.jsx)("p",{children:"\uD83D\uDCCA Pas de donn\xe9es disponibles"})});let n=[...t].sort((e,t)=>new Date(e.timestamp||e.created_at||0)-new Date(t.timestamp||t.created_at||0)).slice(-20),i={labels:n.map(e=>e.timestamp||e.created_at?new Date(e.timestamp||e.created_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):e.device_name||""),datasets:[{label:"flowrate"===a?"D\xe9bit (L/min)":"Batterie (%)",data:n.map(e=>{var t,r,s,n;return"flowrate"===a?Number(null!==(r=null!==(t=e.flowrate)&&void 0!==t?t:e.value)&&void 0!==r?r:0):Number(null!==(n=null!==(s=e.battery)&&void 0!==s?s:e.last_battery)&&void 0!==n?n:0)}),borderColor:"flowrate"===a?"rgb(102, 126, 234)":"rgb(81, 207, 102)",backgroundColor:"flowrate"===a?"rgba(102, 126, 234, 0.1)":"rgba(81, 207, 102, 0.1)",fill:!0,tension:.4}]};return(0,r.jsx)("div",{className:"h-64",children:(0,r.jsx)(s.x1,{data:i,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:14},bodyFont:{size:13}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}},animation:{duration:1e3,easing:"easeInOutQuart"}}})})}n.kL.register(n.uw,n.f$,n.od,n.jn,n.Dx,n.u,n.De,n.Gu)},9999:function(e,t,a){"use strict";a.d(t,{H:function(){return l},a:function(){return o}});var r=a(7437),s=a(2265);let n=(0,s.createContext)(),i="https://ott-jbln.onrender.com";function l(e){let{children:t}=e,[a,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),l(JSON.parse(t))),d(!1)},[]);let m=async(e,t)=>{let a=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await a.json();if(!r.success)throw Error(r.error||"Erreur de connexion");return c(r.token),l(r.user),localStorage.setItem("ott_token",r.token),localStorage.setItem("ott_user",JSON.stringify(r.user)),r},h=()=>{c(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:r=!1}=a,s={...t},n={...t.headers||{}};if(s.body&&!n["Content-Type"]&&(n["Content-Type"]="application/json"),o)n.Authorization="Bearer ".concat(o);else throw Error("Non authentifi\xe9");s.headers=n;let i=await fetch(e,s);if(401===i.status&&o)throw h(),Error("Session expir\xe9e");return i};return(0,r.jsx)(n.Provider,{value:{user:a,token:o,loading:u,login:m,logout:h,fetchWithAuth:f,API_URL:i},children:t})}let o=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,a){"use strict";async function r(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=await e("".concat(t).concat(a),r,s),i=await n.json();if(!i.success)throw Error(i.error||"Erreur API");return i}a.d(t,{r:function(){return r}})}},function(e){e.O(0,[674,840,971,117,744],function(){return e(e.s=6279)}),_N_E=e.O()}]);