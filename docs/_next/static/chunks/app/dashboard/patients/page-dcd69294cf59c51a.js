(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[668],{9200:function(e,t,s){Promise.resolve().then(s.bind(s,8434))},8434:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(7437),n=s(2265),r=s(9999),l=s(2617);function i(){let{fetchWithAuth:e,API_URL:t}=(0,r.a)(),[s,i]=(0,n.useState)([]),[c,o]=(0,n.useState)(!0),[u,d]=(0,n.useState)(null),h=(0,n.useCallback)(async()=>{try{d(null);let s=await (0,l.r)(e,t,"/api.php/patients");i(s.patients||[])}catch(e){console.error(e),d(e.message)}finally{o(!1)}},[t,e]);return(0,n.useEffect)(()=>{h()},[h]),(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDC65 Patients"}),(0,a.jsx)("button",{className:"btn-primary",children:"➕ Nouveau Patient"})]}),u&&(0,a.jsxs)("div",{className:"alert alert-warning",children:[(0,a.jsx)("strong",{children:"Erreur API :"})," ",u]}),(0,a.jsx)("div",{className:"card",children:c?(0,a.jsx)("div",{className:"animate-shimmer h-96"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Nom"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Date Naissance"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"T\xe9l\xe9phone"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Dispositifs"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:s.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50 animate-slide-up",style:{animationDelay:"".concat(.05*t,"s")},children:[(0,a.jsxs)("td",{className:"py-3 px-4 font-medium",children:[e.first_name," ",e.last_name]}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.birth_date?new Date(e.birth_date).toLocaleDateString("fr-FR"):"-"}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.phone||"-"}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("span",{className:"badge badge-success",children:e.device_count||0})}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("button",{className:"btn-secondary text-sm",children:"\uD83D\uDC41️ D\xe9tails"})})]},e.id))})]})})})]})}},9999:function(e,t,s){"use strict";s.d(t,{H:function(){return i},a:function(){return c}});var a=s(7437),n=s(2265);let r=(0,n.createContext)(),l="https://ott-jbln.onrender.com";function i(e){let{children:t}=e,[s,i]=(0,n.useState)(null),[c,o]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(o(e),i(JSON.parse(t))),d(!1)},[]);let h=async(e,t)=>{let s=await fetch("".concat(l,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await s.json();if(!a.success)throw Error(a.error||"Erreur de connexion");return o(a.token),i(a.user),localStorage.setItem("ott_token",a.token),localStorage.setItem("ott_user",JSON.stringify(a.user)),a},x=()=>{o(null),i(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:a=!1}=s,n={...t},r={...t.headers||{}};if(n.body&&!r["Content-Type"]&&(r["Content-Type"]="application/json"),c)r.Authorization="Bearer ".concat(c);else throw Error("Non authentifi\xe9");n.headers=r;let l=await fetch(e,n);if(401===l.status&&c)throw x(),Error("Session expir\xe9e");return l};return(0,a.jsx)(r.Provider,{value:{user:s,token:c,loading:u,login:h,logout:x,fetchWithAuth:m,API_URL:l},children:t})}let c=()=>{let e=(0,n.useContext)(r);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,s){"use strict";async function a(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=await e("".concat(t).concat(s),a,n),l=await r.json();if(!l.success)throw Error(l.error||"Erreur API");return l}s.d(t,{r:function(){return a}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=9200)}),_N_E=e.O()}]);