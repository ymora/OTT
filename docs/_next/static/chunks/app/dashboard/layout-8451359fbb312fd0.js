(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7663],{2747:function(e,r,t){Promise.resolve().then(t.bind(t,6424))},6424:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return g}});var a=t(7437),n=t(2265),o=t(9376),s=t(7648),i=t(9999);let l=[{name:"Vue d'Ensemble",icon:"\uD83C\uDFE0",path:"/dashboard",permission:null},{name:"Dispositifs OTT",icon:"\uD83D\uDD0C",path:"/dashboard/outils",permission:null,description:"Upload firmware, flash USB et streaming"},{name:"Patients",icon:"\uD83C\uDFE5",path:"/dashboard/patients",permission:"patients.view",description:"Gestion des patients"},{name:"Utilisateurs",icon:"\uD83D\uDC68‍\uD83D\uDCBC",path:"/dashboard/users",permission:"users.view",description:"Gestion des utilisateurs"},{name:"Base de Donn\xe9es",icon:"\uD83D\uDDC4️",path:"/dashboard/admin/database-view",permission:null,description:"Vue compl\xe8te de la base de donn\xe9es"}];function d(){let e=(0,o.usePathname)();(0,o.useRouter)();let r=(0,o.useSearchParams)(),{user:t}=(0,i.a)(),d="/dashboard/documentation"===e,[c,u]=(0,n.useState)(d),[h,m]=(0,n.useState)(!1),g=(0,n.useMemo)(()=>r.get("doc")||"presentation",[r]),f=e=>{var r;return!e||(null==t?void 0:t.role_name)==="admin"||(null==t?void 0:null===(r=t.permissions)||void 0===r?void 0:r.includes(e))},p=(0,n.useMemo)(()=>e||"",[e]);return(0,n.useEffect)(()=>{d?h||u(!0):m(!1)},[d,h]),(0,a.jsxs)("aside",{className:"fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-gradient-to-b from-white via-white to-primary-50/20 dark:from-[rgb(var(--night-bg-start))] dark:via-[rgb(var(--night-bg-mid))] dark:to-[rgb(var(--night-blue-start))] border-r border-gray-200/80 dark:border-[rgb(var(--night-border))] overflow-y-auto backdrop-blur-sm",children:[(0,a.jsx)("nav",{className:"p-4 space-y-1",children:l.map(e=>{if(!f(e.permission)||"/dashboard/outils"===e.path&&(null==t?void 0:t.role_name)!=="admin"&&(null==t?void 0:t.role_name)!=="technicien"||"/dashboard/admin/database-view"===e.path&&(null==t?void 0:t.role_name)!=="admin")return null;let r="/dashboard"===e.path?"/dashboard"===p:p===e.path||p.startsWith(e.path+"/");return(0,a.jsxs)(s.default,{href:e.path,className:"\n                flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-all duration-300 group\n                ".concat(r?"bg-gradient-to-r from-primary-500 to-secondary-500 text-white shadow-lg scale-[1.02] animate-glow":"text-gray-700 dark:text-[rgb(var(--night-text-secondary))] hover:bg-gradient-to-r hover:from-gray-100/80 hover:to-gray-50/50 dark:hover:from-[rgb(var(--night-surface-hover))] dark:hover:to-[rgb(var(--night-blue-start))]/20 hover:scale-[1.01]","\n              "),title:e.description||void 0,children:[(0,a.jsx)("span",{className:"text-xl transition-transform duration-300 group-hover:scale-110",children:e.icon}),(0,a.jsx)("span",{children:e.name}),r&&(0,a.jsx)("div",{className:"ml-auto w-2 h-2 bg-white/90 dark:bg-slate-800 rounded-full animate-pulse"})]},e.path)})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-white/90 via-primary-50/30 to-transparent dark:from-[rgb(var(--night-bg-start))] dark:via-[rgb(var(--night-bg-mid))] dark:to-transparent backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"relative flex flex-col-reverse",children:[c&&(0,a.jsx)("div",{className:"mt-2 space-y-1 animate-fade-in",children:[{name:"Pr\xe9sentation",icon:"\uD83D\uDCF8",doc:"presentation"},{name:"D\xe9veloppeurs",icon:"\uD83D\uDCBB",doc:"developpeurs"},{name:"Commerciale",icon:"\uD83D\uDCBC",doc:"commerciale"},{name:"Suivi Temps",icon:"⏱️",doc:"suivi-temps"}].map(e=>{let r=d&&g===e.doc;return(0,a.jsxs)(s.default,{href:"/dashboard/documentation?doc=".concat(e.doc),className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-300 hover:scale-[1.02] shadow-sm text-sm ".concat(r?"bg-gradient-to-r from-primary-500 to-secondary-500 text-white font-semibold":"bg-gradient-to-r from-primary-50 to-primary-100/50 dark:from-primary-900/30 dark:to-primary-800/20 text-primary-700 dark:text-primary-300 hover:from-primary-100 hover:to-primary-100 dark:hover:from-primary-900/50 dark:hover:to-primary-800/30"),children:[(0,a.jsx)("span",{children:e.icon}),(0,a.jsx)("span",{className:"font-medium",children:e.name}),r&&(0,a.jsx)("div",{className:"ml-auto w-2 h-2 bg-white/90 dark:bg-slate-800 rounded-full animate-pulse"})]},e.doc)})}),(0,a.jsxs)("div",{className:"w-full flex items-center justify-between gap-2 px-4 py-2 rounded-lg transition-all duration-300 shadow-sm text-sm font-medium bg-gradient-to-r from-primary-50 to-primary-100/50 dark:from-primary-900/30 dark:to-primary-800/20 text-primary-700 dark:text-primary-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,a.jsx)("span",{children:"\uD83D\uDCDA"}),(0,a.jsx)("span",{children:"Documentation"})]}),(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation();let r=!c;u(r),!r&&d?m(!0):r&&m(!1)},className:"p-1 rounded transition-all duration-300 hover:scale-110 hover:bg-primary-200/50 dark:hover:bg-primary-800/50","aria-label":c?"Masquer les docs":"Afficher les docs",children:(0,a.jsx)("span",{className:"transition-transform duration-300 block ".concat(c?"rotate-180":""),children:"▼"})})]})]})})]})}var c=t(8828);function u(){var e,r;let{user:t,logout:s}=(0,i.a)(),l=(0,o.useRouter)(),[d,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches,t="dark"===e||!e&&r;m(t),g(t)},[]);let g=e=>{e?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},f=t||{first_name:"D\xe9mo",last_name:"User",role_name:"admin"},p=()=>{s(),l.push("/")},v=async()=>{if(confirm("Vider le cache et recharger la page ?"))try{for(let e of(await navigator.serviceWorker.getRegistrations()))await e.unregister(),c.Z.debug("✅ Service worker d\xe9sinscrit");for(let e of(await caches.keys()))await caches.delete(e),c.Z.debug("✅ Cache supprim\xe9:",e);setTimeout(()=>window.location.reload(!0),500)}catch(e){c.Z.error("❌ Erreur lors du nettoyage:",e),alert("Erreur lors du nettoyage du cache")}};return(0,a.jsx)("header",{className:"fixed top-0 left-0 right-0 h-16 bg-gradient-to-r from-white via-white to-primary-50/30 dark:from-[rgb(var(--night-bg-start))] dark:via-[rgb(var(--night-bg-mid))] dark:to-[rgb(var(--night-blue-start))] border-b border-gray-200/80 dark:border-[rgb(var(--night-border))] z-50 backdrop-blur-md shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-full px-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-lg flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 animate-float",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent",children:"OTT Dashboard Pro"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-[rgb(var(--night-text-muted))]",children:"HAPPLYZ MEDICAL SAS"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{className:"btn-secondary hover:scale-110 transition-transform duration-200",onClick:()=>{let e=!h;m(e),g(e)},title:h?"Passer en mode clair":"Passer en mode sombre",children:h?"☀️":"\uD83C\uDF19"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>u(!d),className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-[rgb(var(--night-surface-hover))] transition-all",children:[(0,a.jsxs)("div",{className:"w-8 h-8 bg-gradient-to-br from-primary-400 to-secondary-400 rounded-full flex items-center justify-center text-white font-bold",children:[null==f?void 0:null===(e=f.first_name)||void 0===e?void 0:e[0],null==f?void 0:null===(r=f.last_name)||void 0===r?void 0:r[0]]}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsxs)("p",{className:"text-sm font-medium dark:text-[rgb(var(--night-text-primary))]",children:[null==f?void 0:f.first_name," ",null==f?void 0:f.last_name]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-[rgb(var(--night-text-muted))]",children:null==f?void 0:f.role_name})]}),(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&(0,a.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-48 bg-gradient-to-br from-white to-gray-50/80 dark:from-[rgb(var(--night-surface))] dark:via-[rgb(var(--night-bg-mid))] dark:to-[rgb(var(--night-blue-start))]/20 rounded-lg shadow-xl border border-gray-100/80 dark:border-[rgb(var(--night-border))] animate-slide-down backdrop-blur-md",children:[(0,a.jsx)("button",{onClick:()=>{v(),u(!1)},className:"w-full px-4 py-2 text-left text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-50/50 dark:hover:from-gray-800/20 dark:hover:to-gray-800/10 rounded-lg transition-all duration-200",children:"\uD83E\uDDF9 Vider le cache"}),(0,a.jsx)("button",{onClick:()=>{p(),u(!1)},className:"w-full px-4 py-2 text-left text-red-600 dark:text-red-400 hover:bg-gradient-to-r hover:from-red-50 hover:to-red-50/50 dark:hover:from-red-900/20 dark:hover:to-red-900/10 rounded-lg transition-all duration-200",children:"\uD83D\uDEAA D\xe9connexion"})]})]})]})]})})}var h=t(4767);function m(e){let{children:r}=e,t=(0,o.useRouter)(),s=(0,o.usePathname)(),{user:l,loading:m}=(0,i.a)(),g=(0,n.useRef)(!1);return((0,n.useEffect)(()=>{c.Z.debug("[DashboardLayout] \xc9tat:",{loading:m,hasUser:!!l,pathname:s})},[m,l,s]),(0,n.useEffect)(()=>{!g.current&&(null==s?void 0:s.startsWith("/dashboard"))&&(m||l?!m&&l&&(g.current=!1):(c.Z.debug("[DashboardLayout] Redirection vers / (pas d'utilisateur)"),g.current=!0,t.replace("/")))},[l,m,t,s]),m)?(c.Z.debug("[DashboardLayout] Affichage du loader (loading=true)"),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-[rgb(var(--night-bg-start))]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-[rgb(var(--night-text-primary))]",children:"Chargement..."})]})})):l?(0,a.jsx)(h.d,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-[rgb(var(--night-bg-start))]",children:[(0,a.jsx)(u,{}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(d,{}),(0,a.jsx)("main",{className:"flex-1 p-6 ml-64 mt-16",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:r})})]})]})}):(c.Z.warn("[DashboardLayout] Pas d'utilisateur authentifi\xe9, redirection en cours..."),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Redirection vers la page de connexion..."})]})}))}function g(e){let{children:r}=e;return(0,a.jsx)(m,{children:r})}},9999:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return u},a:function(){return h}});var a=t(7437),n=t(2265),o=t(8828);let s=(0,n.createContext)(),i="https://ott-jbln.onrender.com".replace(/\/$/,""),l=e=>/^https?:\/\//i.test(e),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?l(e)?e:e.startsWith("/")?"".concat(i).concat(e):"".concat(i,"/").concat(e):i},c=e=>d(e);function u(e){let{children:r}=e,[t,l]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0);(0,n.useEffect)(()=>{o.Z.debug("[AuthContext] Initialisation...");try{let e=localStorage.getItem("ott_token"),r=localStorage.getItem("ott_user");if(o.Z.debug("[AuthContext] localStorage:",{hasToken:!!e,hasUser:!!r,tokenLength:(null==e?void 0:e.length)||0}),e&&r)try{let t=JSON.parse(r);u(e),l(t),o.Z.debug("[AuthContext] Utilisateur restaur\xe9:",t.email||t.username)}catch(e){o.Z.error("[AuthContext] Erreur parsing user:",e),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")}else o.Z.debug("[AuthContext] Aucun utilisateur stock\xe9")}catch(e){o.Z.error("[AuthContext] Erreur lors de l'initialisation:",e)}finally{m(!1),o.Z.debug("[AuthContext] Initialisation termin\xe9e, loading=false")}},[]);let g=async(e,r)=>{try{let t=await fetch(c("/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})}),a=t.headers.get("content-type")||"",n=a.includes("application/json");if(!t.ok||!n){let e=await t.text();o.Z.error("[AuthContext] ❌ Erreur serveur"),o.Z.error("[AuthContext] Status:",t.status),o.Z.error("[AuthContext] Content-Type:",a),o.Z.error("[AuthContext] R\xe9ponse compl\xe8te:",e);let r="Erreur serveur (".concat(t.status,")");try{let t=JSON.parse(e);r=t.error||t.message||r}catch(a){if(e.includes("Parse error")||e.includes("Fatal error")||e.includes("Warning")){let a=e.match(/(?:Parse error|Fatal error|Warning):\s*(.+?)(?:\n|$)/i);r=a?"Erreur PHP: ".concat(a[1].substring(0,200)):"Erreur serveur (".concat(t.status,"). L'API distante ne r\xe9pond pas correctement.")}else e.includes("Database")||e.includes("Connection")?r="Erreur de connexion \xe0 la base de donn\xe9es":500===t.status&&(r="Erreur serveur interne. L'API distante rencontre un probl\xe8me.")}{let r="[".concat(new Date().toISOString(),"] ERREUR API\n")+"URL: ".concat(c("/api.php/auth/login"),"\n")+"Status: ".concat(t.status,"\n")+"Content-Type: ".concat(a,"\n")+"R\xe9ponse: ".concat(e.substring(0,1e3),"\n\n");try{localStorage.setItem("api_error_log",r),o.Z.debug("[AuthContext] \uD83D\uDCBE Log sauvegard\xe9 dans localStorage")}catch(e){o.Z.error("[AuthContext] Erreur sauvegarde log:",e)}}throw Error(r)}let s=await t.json();if(!s.success)throw Error(s.error||"Erreur de connexion");return u(s.token),l(s.user),localStorage.setItem("ott_token",s.token),localStorage.setItem("ott_user",JSON.stringify(s.user)),s}catch(e){if(e.message&&e.message.includes("Erreur serveur"))throw e;throw o.Z.error("[AuthContext] ❌ Erreur lors de la connexion:",e),Error("Erreur de connexion au serveur. V\xe9rifiez votre connexion internet.")}},f=()=>{u(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},p=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:a=!1}=t,n={...r},o={...r.headers||{}};if(n.body&&!o["Content-Type"]&&(o["Content-Type"]="application/json"),d)o.Authorization="Bearer ".concat(d);else throw Error("Non authentifi\xe9");n.headers=o;let s=c(e),i=await fetch(s,n);if(401===i.status&&d)throw f(),Error("Session expir\xe9e");return i};return(0,a.jsx)(s.Provider,{value:{user:t,token:d,loading:h,login:g,logout:f,fetchWithAuth:p,API_URL:i},children:r})}let h=()=>{let e=(0,n.useContext)(s);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},8828:function(e,r,t){"use strict";t.d(r,{k:function(){return a}}),t(257);let a={log:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t]},error:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];console.error("[ERROR]",...r)},warn:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t]},debug:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t]}};r.Z=a},9376:function(e,r,t){"use strict";var a=t(5475);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},257:function(e,r,t){"use strict";var a,n;e.exports=(null==(a=t.g.process)?void 0:a.env)&&"object"==typeof(null==(n=t.g.process)?void 0:n.env)?t.g.process:t(4227)},4227:function(e){!function(){var r={229:function(e){var r,t,a,n=e.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{t="function"==typeof clearTimeout?clearTimeout:s}catch(e){t=s}}();var l=[],d=!1,c=-1;function u(){d&&a&&(d=!1,a.length?l=a.concat(l):c=-1,l.length&&h())}function h(){if(!d){var e=i(u);d=!0;for(var r=l.length;r;){for(a=l,l=[];++c<r;)a&&a[c].run();c=-1,r=l.length}a=null,d=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===s||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function m(e,r){this.fun=e,this.array=r}function g(){}n.nextTick=function(e){var r=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];l.push(new m(e,r)),1!==l.length||d||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},t={};function a(e){var n=t[e];if(void 0!==n)return n.exports;var o=t[e]={exports:{}},s=!0;try{r[e](o,o.exports,a),s=!1}finally{s&&delete t[e]}return o.exports}a.ab="//";var n=a(229);e.exports=n}()}},function(e){e.O(0,[7648,4767,2971,2117,1744],function(){return e(e.s=2747)}),_N_E=e.O()}]);