(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{8224:function(e,t,s){Promise.resolve().then(s.bind(s,7989))},7989:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var r=s(7437),n=s(2265),a=s(9999);function i(){let{user:e,fetchWithAuth:t,API_URL:s}=(0,a.a)(),[i,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),d=(null==e||e.role_name,async()=>{});return(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsxs)("div",{className:"animate-slide-up",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Administration"}),(0,r.jsx)("p",{className:"text-gray-600",children:"R\xe9initialiser la base Render avec le jeu de donn\xe9es de d\xe9monstration."})]}),(0,r.jsxs)("div",{className:"card space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"R\xe9initialisation base de d\xe9mo"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Cette action ex\xe9cute ",(0,r.jsx)("code",{children:"base_seed.sql"})," puis ",(0,r.jsx)("code",{children:"demo_seed.sql"})," sur la base configur\xe9e par l'API. Toutes les mesures, alertes, utilisateurs personnalis\xe9s et commandes seront supprim\xe9es."]}),(0,r.jsxs)("div",{className:"alert alert-warning",children:[(0,r.jsx)("strong",{children:"Option d\xe9sactiv\xe9e."})," D\xe9finissez ",(0,r.jsx)("code",{children:"ENABLE_DEMO_RESET=true"})," (backend) et",(0,r.jsx)("code",{children:"NEXT_PUBLIC_ENABLE_DEMO_RESET=true"})," (frontend) pour autoriser cette op\xe9ration."]}),!1,(null==i?void 0:i.type)==="success"&&(0,r.jsxs)("div",{className:"alert alert-success",children:[(0,r.jsx)("p",{className:"font-semibold",children:i.payload.message}),i.payload.meta&&(0,r.jsxs)("ul",{className:"text-sm text-gray-700 mt-2 space-y-1",children:[(0,r.jsxs)("li",{children:["Temps d'ex\xe9cution : ",i.payload.meta.duration_ms," ms"]}),(0,r.jsxs)("li",{children:["Tables r\xe9initialis\xe9es : ",i.payload.meta.tables_reset]})]})]}),(null==i?void 0:i.type)==="error"&&(0,r.jsxs)("div",{className:"alert alert-error",children:[(0,r.jsx)("strong",{children:"Erreur :"})," ",i.message]}),(0,r.jsx)("button",{className:"btn-danger w-full md:w-auto",disabled:o||!0,onClick:d,children:o?"R\xe9initialisation en cours...":"R\xe9initialiser la base de d\xe9mo"})]})]})}},9999:function(e,t,s){"use strict";s.d(t,{H:function(){return l},a:function(){return o}});var r=s(7437),n=s(2265);let a=(0,n.createContext)(),i="https://ott-jbln.onrender.com";function l(e){let{children:t}=e,[s,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),l(JSON.parse(t))),u(!1)},[]);let m=async(e,t)=>{let s=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await s.json();if(!r.success)throw Error(r.error||"Erreur de connexion");return c(r.token),l(r.user),localStorage.setItem("ott_token",r.token),localStorage.setItem("ott_user",JSON.stringify(r.user)),r},h=()=>{c(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:r=!1}=s,n={...t},a={...t.headers||{}};if(n.body&&!a["Content-Type"]&&(a["Content-Type"]="application/json"),o)a.Authorization="Bearer ".concat(o);else throw Error("Non authentifi\xe9");n.headers=a;let i=await fetch(e,n);if(401===i.status&&o)throw h(),Error("Session expir\xe9e");return i};return(0,r.jsx)(a.Provider,{value:{user:s,token:o,loading:d,login:m,logout:h,fetchWithAuth:p,API_URL:i},children:t})}let o=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=8224)}),_N_E=e.O()}]);