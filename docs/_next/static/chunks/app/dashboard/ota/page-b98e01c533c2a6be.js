(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[401],{4906:function(e,t,s){Promise.resolve().then(s.bind(s,8714))},8714:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),r=s(2265),n=s(9999),i=s(2617);function l(){let{fetchWithAuth:e,API_URL:t}=(0,n.a)(),[s,l]=(0,r.useState)([]),[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[x,p]=(0,r.useState)(null),f=(0,r.useCallback)(async()=>{try{p(null);let[s,a]=await Promise.all([(0,i.r)(e,t,"/api.php/firmwares"),(0,i.r)(e,t,"/api.php/devices")]);l(s.firmwares||[]),c(a.devices||[])}catch(e){console.error(e),p(e.message)}finally{u(!1)}},[t,e]);(0,r.useEffect)(()=>{f()},[f]);let b=async(s,a)=>{try{h(null),await (0,i.r)(e,t,"/api.php/devices/".concat(s,"/ota"),{method:"POST",body:JSON.stringify({firmware_version:a})},{requiresAuth:!1}),h("OTA v".concat(a," programm\xe9 pour le dispositif #").concat(s))}catch(e){p(e.message)}};return(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDD04 Gestion OTA"}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"\uD83D\uDCE6 Firmwares Disponibles"}),(0,a.jsx)("button",{className:"btn-primary",children:"\uD83D\uDCE4 Upload Firmware"})]}),(x||m)&&(0,a.jsx)("div",{className:"alert ".concat(x?"alert-warning":"alert-success"," mb-4"),children:x?"Erreur API : ".concat(x):m}),d?(0,a.jsx)("div",{className:"animate-shimmer h-48"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Version"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Taille"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Stable"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Date"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:s.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50 animate-slide-up",style:{animationDelay:"".concat(.05*t,"s")},children:[(0,a.jsxs)("td",{className:"py-3 px-4 font-mono font-bold",children:["v",e.version]}),(0,a.jsxs)("td",{className:"py-3 px-4",children:[(e.file_size/1024).toFixed(0)," Ko"]}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.is_stable?(0,a.jsx)("span",{className:"badge badge-success",children:"✅ Stable"}):(0,a.jsx)("span",{className:"badge",children:"Beta"})}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString("fr-FR")}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("button",{onClick:()=>{let t=prompt("ID du dispositif:");t&&b(t,e.version)},className:"btn-primary text-sm",children:"D\xe9ployer"})})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"⚙️ Configuration Dispositifs"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all animate-scale-in",style:{animationDelay:"".concat(.03*t,"s")},children:[(0,a.jsx)("p",{className:"font-semibold mb-2",children:e.device_name||(null===(s=e.sim_iccid)||void 0===s?void 0:s.substr(-8))}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Firmware: v",e.firmware_version||"3.0.0"]}),(0,a.jsx)("button",{className:"btn-secondary w-full text-sm",children:"⚙️ Configurer"})]},e.id)})})]})]})}},9999:function(e,t,s){"use strict";s.d(t,{H:function(){return l},a:function(){return o}});var a=s(7437),r=s(2265);let n=(0,r.createContext)(),i="https://ott-jbln.onrender.com";function l(e){let{children:t}=e,[s,l]=(0,r.useState)(null),[o,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),l(JSON.parse(t))),u(!1)},[]);let m=async(e,t)=>{let s=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await s.json();if(!a.success)throw Error(a.error||"Erreur de connexion");return c(a.token),l(a.user),localStorage.setItem("ott_token",a.token),localStorage.setItem("ott_user",JSON.stringify(a.user)),a},h=()=>{c(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},x=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:a=!1}=s,r={...t},n={...t.headers||{}};if(r.body&&!n["Content-Type"]&&(n["Content-Type"]="application/json"),o)n.Authorization="Bearer ".concat(o);else throw Error("Non authentifi\xe9");r.headers=n;let i=await fetch(e,r);if(401===i.status&&o)throw h(),Error("Session expir\xe9e");return i};return(0,a.jsx)(n.Provider,{value:{user:s,token:o,loading:d,login:m,logout:h,fetchWithAuth:x,API_URL:i},children:t})}let o=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,s){"use strict";async function a(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=await e("".concat(t).concat(s),a,r),i=await n.json();if(!i.success)throw Error(i.error||"Erreur API");return i}s.d(t,{r:function(){return a}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4906)}),_N_E=e.O()}]);