(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{9123:function(e,t,n){Promise.resolve().then(n.bind(n,1307))},1307:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(7437),s=n(5775),a=n.n(s),l=n(2265),o=n(9999),i=n(2617),u=n(9376);let c=a()(()=>Promise.all([n.e(641),n.e(212),n.e(345)]).then(n.bind(n,4345)),{loadableGenerated:{webpack:()=>[4345]},ssr:!1});function d(e){let{devices:t}=e,n=(0,u.useSearchParams)();return(0,r.jsx)(c,{devices:t.filter(e=>e.latitude&&e.longitude),focusDeviceId:n.get("deviceId")})}function f(){let{fetchWithAuth:e,API_URL:t}=(0,o.a)(),[n,s]=(0,l.useState)([]),[a,u]=(0,l.useState)(!0),[c,f]=(0,l.useState)(null);return((0,l.useEffect)(()=>{(async()=>{try{f(null);let n=await (0,i.r)(e,t,"/api.php/devices");s(n.devices||[])}catch(e){f(e.message)}finally{u(!1)}})()},[e,t]),a)?(0,r.jsx)("div",{className:"card animate-shimmer h-[600px]"}):(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDDFAï¸ Carte des Dispositifs"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Visualisation en direct des dispositifs (positions, batterie, statut transmission)"})]}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[n.length," dispositif(s)"]})]}),c&&(0,r.jsxs)("div",{className:"alert alert-warning",children:[(0,r.jsx)("strong",{children:"Erreur API :"})," ",c]}),(0,r.jsx)("div",{className:"card p-0 overflow-hidden",children:(0,r.jsx)(l.Suspense,{fallback:(0,r.jsx)("div",{className:"card animate-shimmer h-[600px]"}),children:(0,r.jsx)(d,{devices:n})})})]})}},9999:function(e,t,n){"use strict";n.d(t,{H:function(){return o},a:function(){return i}});var r=n(7437),s=n(2265);let a=(0,s.createContext)(),l="https://ott-jbln.onrender.com";function o(e){let{children:t}=e,[n,o]=(0,s.useState)(null),[i,u]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(u(e),o(JSON.parse(t))),d(!1)},[]);let f=async(e,t)=>{let n=await fetch("".concat(l,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await n.json();if(!r.success)throw Error(r.error||"Erreur de connexion");return u(r.token),o(r.user),localStorage.setItem("ott_token",r.token),localStorage.setItem("ott_user",JSON.stringify(r.user)),r},h=()=>{u(null),o(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:r=!1}=n,s={...t},a={...t.headers||{}};if(s.body&&!a["Content-Type"]&&(a["Content-Type"]="application/json"),i)a.Authorization="Bearer ".concat(i);else throw Error("Non authentifi\xe9");s.headers=a;let l=await fetch(e,s);if(401===l.status&&i)throw h(),Error("Session expir\xe9e");return l};return(0,r.jsx)(a.Provider,{value:{user:n,token:i,loading:c,login:f,logout:h,fetchWithAuth:m,API_URL:l},children:t})}let i=()=>{let e=(0,s.useContext)(a);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,n){"use strict";async function r(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=await e("".concat(t).concat(n),r,s),l=await a.json();if(!l.success)throw Error(l.error||"Erreur API");return l}n.d(t,{r:function(){return r}})},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},5775:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let r=n(7043);n(7437),n(2265);let s=r._(n(5602));function a(e,t){var n;let r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e);let a={...r,...t};return(0,s.default)({...a,modules:null==(n=a.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1523:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let r=n(8993);function s(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return n}},5602:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}});let r=n(7437),s=n(2265),a=n(1523),l=n(49);function o(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},u=function(e){let t={...i,...e},n=(0,s.lazy)(()=>t.loader().then(o)),u=t.loading;function c(e){let o=u?(0,r.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,i=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(l.PreloadCss,{moduleIds:t.modules}):null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(s.Suspense,{fallback:o,children:i})}return c.displayName="LoadableComponent",c}},49:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return a}});let r=n(7437),s=n(544);function a(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,s.getExpectedRequestStore)("next/dynamic css"),a=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));a.push(...t)}}return 0===a.length?null:(0,r.jsx)(r.Fragment,{children:a.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=9123)}),_N_E=e.O()}]);