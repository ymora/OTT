(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[480],{1330:function(e,t,r){Promise.resolve().then(r.bind(r,902))},902:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var o=r(7437),a=r(2265),n=r(7293),l=r(9999),s=r(2617);function i(){let{fetchWithAuth:e,API_URL:t}=(0,l.a)(),[r,i]=(0,a.useState)([]),[c,u]=(0,a.useState)(!0),[d,h]=(0,a.useState)("all"),[m,f]=(0,a.useState)(null),x=(0,a.useCallback)(async()=>{try{f(null);let r=await (0,s.r)(e,t,"/api.php/alerts");i(r.alerts||[])}catch(e){console.error(e),f(e.message)}finally{u(!1)}},[e,t]);(0,a.useEffect)(()=>{x()},[x]);let g="all"===d?r:r.filter(e=>e.status===d);return(0,o.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDD14 Alertes"}),(0,o.jsx)("div",{className:"flex gap-3",children:["all","unresolved","resolved"].map(e=>(0,o.jsx)("button",{onClick:()=>h(e),className:"px-4 py-2 rounded-lg font-medium transition-all ".concat(d===e?"bg-primary-500 text-white shadow-lg scale-105":"bg-white text-gray-700 hover:bg-gray-100"),children:"all"===e?"Toutes":"unresolved"===e?"Non r\xe9solues":"R\xe9solues"},e))}),m&&(0,o.jsxs)("div",{className:"alert alert-warning",children:[(0,o.jsx)("strong",{children:"Erreur API :"})," ",m]}),c?(0,o.jsx)("div",{className:"space-y-3",children:[1,2,3,4,5].map(e=>(0,o.jsx)("div",{className:"card animate-shimmer h-24"},e))}):(0,o.jsx)("div",{className:"space-y-3",children:g.map((e,t)=>(0,o.jsx)(n.Z,{alert:e,delay:.03*t},e.id))})]})}},7293:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var o=r(7437);function a(e){let{alert:t,delay:r=0}=e,a={critical:{color:"border-red-500 bg-red-50",icon:"\uD83D\uDEA8",textColor:"text-red-700"},high:{color:"border-orange-500 bg-orange-50",icon:"⚠️",textColor:"text-orange-700"},medium:{color:"border-yellow-500 bg-yellow-50",icon:"⚡",textColor:"text-yellow-700"},low:{color:"border-blue-500 bg-blue-50",icon:"ℹ️",textColor:"text-blue-700"}},n=a[t.severity]||a.low;return(0,o.jsx)("div",{className:"border-l-4 ".concat(n.color," p-4 rounded-r-lg animate-slide-up hover:shadow-md transition-all"),style:{animationDelay:"".concat(r,"s")},children:(0,o.jsxs)("div",{className:"flex items-start gap-3",children:[(0,o.jsx)("span",{className:"text-2xl",children:n.icon}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("p",{className:"font-semibold ".concat(n.textColor),children:t.message}),(0,o.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:new Date(t.created_at).toLocaleString("fr-FR")})]}),(0,o.jsx)("span",{className:"badge ".concat(n.textColor," bg-white"),children:t.severity})]})})}},9999:function(e,t,r){"use strict";r.d(t,{H:function(){return s},a:function(){return i}});var o=r(7437),a=r(2265);let n=(0,a.createContext)(),l="https://ott-jbln.onrender.com";function s(e){let{children:t}=e,[r,s]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),s(JSON.parse(t))),d(!1)},[]);let h=async(e,t)=>{let r=await fetch("".concat(l,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await r.json();if(!o.success)throw Error(o.error||"Erreur de connexion");return c(o.token),s(o.user),localStorage.setItem("ott_token",o.token),localStorage.setItem("ott_user",JSON.stringify(o.user)),o},m=()=>{c(null),s(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:o=!1}=r,a={...t},n={...t.headers||{}};if(a.body&&!n["Content-Type"]&&(n["Content-Type"]="application/json"),i)n.Authorization="Bearer ".concat(i);else throw Error("Non authentifi\xe9");a.headers=n;let l=await fetch(e,a);if(401===l.status&&i)throw m(),Error("Session expir\xe9e");return l};return(0,o.jsx)(n.Provider,{value:{user:r,token:i,loading:u,login:h,logout:m,fetchWithAuth:f,API_URL:l},children:t})}let i=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,r){"use strict";async function o(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=await e("".concat(t).concat(r),o,a),l=await n.json();if(!l.success)throw Error(l.error||"Erreur API");return l}r.d(t,{r:function(){return o}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1330)}),_N_E=e.O()}]);