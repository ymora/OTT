(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{4990:function(e,t,r){Promise.resolve().then(r.bind(r,4608))},4608:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(7437),a=r(2265),n=r(9999),i=r(2617),l=r(7062);let o={SUCCESS:"bg-emerald-50 text-emerald-700 border-emerald-200",INFO:"bg-blue-50 text-blue-700 border-blue-200",WARN:"bg-orange-50 text-orange-700 border-orange-200",ERROR:"bg-red-50 text-red-700 border-red-200"};function c(){let{fetchWithAuth:e,API_URL:t}=(0,n.a)(),[r,c]=(0,a.useState)([]),[d,u]=(0,a.useState)([]),[m,h]=(0,a.useState)("ALL"),[x,p]=(0,a.useState)("ALL"),[g,f]=(0,a.useState)(""),[v,N]=(0,a.useState)(!0),[j,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{y(null);let[r,s]=await Promise.all([(0,i.r)(e,t,"/api.php/logs?limit=200"),(0,i.r)(e,t,"/api.php/devices")]);c(r.logs||[]),u(s.devices||[])}catch(e){console.error(e),y(e.message)}finally{N(!1)}})()},[e,t]);let b=(0,a.useMemo)(()=>r.filter(e=>{let t=(e.level||"INFO").toUpperCase();return("ALL"===m||t===m)&&("ALL"===x||String(e.device_id)===x)&&(!g||!!e.message.toLowerCase().includes(g.toLowerCase()))}),[r,m,x,g]);return(0,s.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDCDD Journal Syst\xe8me"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:"Suivi temps r\xe9el des \xe9v\xe9nements terrain."})]}),(0,s.jsx)("div",{className:"space-x-2",children:["ALL","INFO","WARN","ERROR","SUCCESS"].map(e=>(0,s.jsx)("button",{onClick:()=>h(e),className:"px-3 py-1 rounded-full text-sm font-medium transition-all ".concat(m===e?"bg-primary-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ALL"===e?"Tous":e},e))})]}),(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dispositif"}),(0,s.jsxs)("select",{value:x,onChange:e=>p(e.target.value),className:"input",children:[(0,s.jsx)("option",{value:"ALL",children:"Tous"}),d.map(e=>(0,s.jsx)("option",{value:e.id,children:e.device_name||e.sim_iccid},e.id))]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rechercher"}),(0,s.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),className:"input",placeholder:"Ex: batterie, transmission, OTA..."})]})]}),j&&(0,s.jsxs)("div",{className:"alert alert-warning",children:[(0,s.jsx)("strong",{children:"Erreur API :"})," ",j]}),v?(0,s.jsx)("div",{className:"space-y-3",children:[1,2,3,4].map(e=>(0,s.jsx)("div",{className:"card animate-shimmer h-24"},e))}):(0,s.jsx)("div",{className:"space-y-3 max-h-[520px] overflow-y-auto pr-2",children:0===b.length?(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:"Aucun log ne correspond aux filtres."}):b.map((e,t)=>{let r=(e.level||"INFO").toUpperCase();return(0,s.jsxs)("div",{className:"border rounded-xl p-4 flex items-start gap-4 animate-slide-up ".concat(o[r]||o.INFO),children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-white flex items-center justify-center text-lg font-bold",children:e.device_name?e.device_name.split("-").pop():"OTT"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-2",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:e.device_name||"Dispositif inconnu"}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 bg-white rounded-full font-semibold",children:r}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:(0,l.o0)(e.timestamp||e.created_at)})]}),(0,s.jsx)("p",{className:"text-gray-800",children:e.message})]})]},e.id||t)})})]})]})}},9999:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return o}});var s=r(7437),a=r(2265);let n=(0,a.createContext)(),i="https://ott-jbln.onrender.com";function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),l(JSON.parse(t))),u(!1)},[]);let m=async(e,t)=>{let r=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),s=await r.json();if(!s.success)throw Error(s.error||"Erreur de connexion");return c(s.token),l(s.user),localStorage.setItem("ott_token",s.token),localStorage.setItem("ott_user",JSON.stringify(s.user)),s},h=()=>{c(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},x=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:s=!1}=r,a={...t},n={...t.headers||{}};if(a.body&&!n["Content-Type"]&&(n["Content-Type"]="application/json"),o)n.Authorization="Bearer ".concat(o);else throw Error("Non authentifi\xe9");a.headers=n;let i=await fetch(e,a);if(401===i.status&&o)throw h(),Error("Session expir\xe9e");return i};return(0,s.jsx)(n.Provider,{value:{user:r,token:o,loading:d,login:m,logout:h,fetchWithAuth:x,API_URL:i},children:t})}let o=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,r){"use strict";async function s(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=await e("".concat(t).concat(r),s,a),i=await n.json();if(!i.success)throw Error(i.error||"Erreur API");return i}r.d(t,{r:function(){return s}})},7062:function(e,t,r){"use strict";function s(e){return e?new Date(e).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}r.d(t,{o0:function(){return s}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4990)}),_N_E=e.O()}]);