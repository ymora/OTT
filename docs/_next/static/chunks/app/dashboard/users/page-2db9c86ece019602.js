(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3618],{3868:function(e,t,s){Promise.resolve().then(s.bind(s,532))},532:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h},dynamic:function(){return x}});var a=s(7437),l=s(2265),r=s(9999),i=s(3072),n=s(832),c=s(9723),d=s(6601),o=s(2919),u=s(899);s(9131),s(8828);let x="force-dynamic";function h(){var e,t;let{fetchWithAuth:s,API_URL:x,user:h}=(0,r.a)(),m=e=>{var t;return!e||(null==h?void 0:h.role_name)==="admin"||(null==h?void 0:null===(t=h.permissions)||void 0===t?void 0:t.includes(e))||!1},[g,p]=(0,l.useState)(null),[b,j]=(0,l.useState)(null),{isOpen:y,editingItem:v,openCreate:N,openEdit:f,close:D}=(0,i.f7)(),[k,_]=(0,l.useState)(!1),{data:C,loading:w,error:S,refetch:A,invalidateCache:E}=(0,i.m_)((0,l.useMemo)(()=>[k?"/api.php/users?include_deleted=true":"/api.php/users","/api.php/roles"],[k]),{requiresAuth:!0}),{restore:U,restoring:M}=(0,i.O5)("users",{onSuccess:()=>{j("✅ Utilisateur restaur\xe9 avec succ\xe8s")},onError:e=>{p(e)},invalidateCache:E,refetch:A}),{archive:R,archiving:Z}=(0,i.EJ)({fetchWithAuth:s,API_URL:x,entityType:"users",refetch:A,onSuccess:()=>{j("✅ Utilisateur archiv\xe9 avec succ\xe8s")},onError:e=>{p(e)},invalidateCache:E,currentUser:h,onCloseModal:D,editingItem:v}),{permanentDelete:F,deleting:L}=(0,i.MY)({fetchWithAuth:s,API_URL:x,entityType:"users",refetch:A,onSuccess:()=>{j("✅ Utilisateur supprim\xe9 d\xe9finitivement")},onError:e=>{p(e)},invalidateCache:E,onCloseModal:D,editingItem:v}),O=(null==C?void 0:null===(e=C.users)||void 0===e?void 0:e.users)||[],I=(null==C?void 0:null===(t=C.roles)||void 0===t?void 0:t.roles)||[],T=(0,l.useMemo)(()=>O.filter(e=>!e.deleted_at),[O]);(0,l.useMemo)(()=>O.filter(e=>e.deleted_at),[O]);let P=k?O:T,{searchTerm:z,setSearchTerm:J,filteredItems:q}=(0,i.L0)(P,{searchFn:(e,t)=>{let s=t.toLowerCase();return e.filter(e=>"".concat(e.first_name||""," ").concat(e.last_name||""," ").concat(e.email||""," ").concat(e.phone||""," ").concat(e.role_name||"").toLowerCase().includes(s))}}),V={admin:"bg-purple-100 text-purple-700",medecin:"bg-green-100 text-green-700",technicien:"bg-blue-100 text-blue-700"},W=async()=>{j(v?"Utilisateur modifi\xe9 avec succ\xe8s":"Utilisateur cr\xe9\xe9 avec succ\xe8s"),await new Promise(e=>setTimeout(e,100)),await A()};return(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDC65 Utilisateurs"})}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(o.Z,{value:z,onChange:J,placeholder:"Rechercher un utilisateur..."})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:k,onChange:e=>_(e.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"\uD83D\uDDC4️ Afficher les archives"})]})}),(0,a.jsx)("button",{className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",onClick:N,disabled:(null==h?void 0:h.role_name)!=="admin",title:(null==h?void 0:h.role_name)==="admin"?"Cr\xe9er un nouvel utilisateur":"R\xe9serv\xe9 aux administrateurs",children:"➕ Nouvel Utilisateur"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)(c.Z,{error:S,onRetry:A}),(0,a.jsx)(c.Z,{error:g,onClose:()=>p(null)}),(0,a.jsx)(d.Z,{message:b,onClose:()=>j(null)}),w?(0,a.jsx)(n.Z,{size:"lg",text:"Chargement des utilisateurs..."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Nom"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"R\xf4le"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Email"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"T\xe9l\xe9phone"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Statut"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Derni\xe8re connexion"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 text-gray-700 dark:text-gray-300",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===q.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"7",className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"Aucun utilisateur trouv\xe9"})}):q.map((e,t)=>{let s=null!==e.deleted_at&&void 0!==e.deleted_at&&""!==e.deleted_at;return(0,a.jsxs)("tr",{className:"table-row animate-slide-up hover:bg-gray-50 dark:hover:bg-gray-800 ".concat(s?"opacity-60":""),style:{animationDelay:"".concat(.05*t,"s")},children:[(0,a.jsx)("td",{className:"table-cell py-3 px-4 font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{children:[e.first_name," ",e.last_name]}),s&&(0,a.jsx)("span",{className:"badge bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400 text-xs",children:"\uD83D\uDDC4️ Archiv\xe9"})]})}),(0,a.jsx)("td",{className:"table-cell py-3 px-4",children:(0,a.jsx)("span",{className:"badge ".concat(V[e.role_name]||"bg-gray-100 text-gray-700"),children:e.role_name})}),(0,a.jsx)("td",{className:"table-cell",children:e.email}),(0,a.jsx)("td",{className:"table-cell text-sm",children:e.phone||"-"}),(0,a.jsx)("td",{className:"table-cell py-3 px-4",children:e.is_active?(0,a.jsx)("span",{className:"badge badge-success",children:"✅ Actif"}):(0,a.jsx)("span",{className:"badge text-gray-600 bg-gray-100",children:"❌ Inactif"})}),(0,a.jsx)("td",{className:"table-cell text-sm",children:e.last_login?new Date(e.last_login).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"Jamais"}),(0,a.jsx)("td",{className:"table-cell py-3 px-4",children:(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:s?(0,a.jsx)("button",{onClick:()=>U(e),disabled:M===e.id,className:"p-2 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors disabled:opacity-50",title:"Restaurer l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:M===e.id?"⏳":"♻️"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"p-2 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors",onClick:()=>f(e),title:"Modifier l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:"✏️"})}),e.id!==(null==h?void 0:h.id)&&m("users.manage")&&(0,a.jsx)(a.Fragment,{children:(null==h?void 0:h.role_name)==="admin"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"p-2 hover:bg-orange-100 dark:hover:bg-orange-900/30 rounded-lg transition-colors",onClick:()=>R(e),disabled:Z===e.id,title:"Archiver l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:Z===e.id?"⏳":"\uD83D\uDDC4️"})}),(0,a.jsx)("button",{className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors",onClick:()=>F(e),disabled:L===e.id,title:"Supprimer d\xe9finitivement l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:L===e.id?"⏳":"\uD83D\uDDD1️"})})]}):(0,a.jsx)("button",{className:"p-2 hover:bg-orange-100 dark:hover:bg-orange-900/30 rounded-lg transition-colors",onClick:()=>R(e),disabled:Z===e.id,title:"Archiver l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:Z===e.id?"⏳":"\uD83D\uDDC4️"})})}),e.id===(null==h?void 0:h.id)&&(0,a.jsx)("button",{className:"p-2 opacity-50 cursor-not-allowed rounded-lg",disabled:!0,title:"Vous ne pouvez pas supprimer votre propre compte",children:(0,a.jsxs)("span",{className:"text-lg relative inline-block",children:[(0,a.jsx)("span",{className:"text-red-500",children:"\uD83D\uDDD1️"}),(0,a.jsx)("span",{className:"absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center text-red-600 text-lg font-bold leading-none",style:{textShadow:"0 0 2px white, 0 0 2px white"},children:"✖"})]})})]})})})]},e.id)})})]})})]}),(0,a.jsx)(u.Z,{isOpen:y,onClose:D,editingItem:v,type:"user",onSave:W,fetchWithAuth:s,API_URL:x,roles:I,currentUser:h})]})}}},function(e){e.O(0,[3449,376,2971,2117,1744],function(){return e(e.s=3868)}),_N_E=e.O()}]);