(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{3868:function(e,t,s){Promise.resolve().then(s.bind(s,532))},532:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var r=s(7437),a=s(2265),n=s(9999),l=s(2617);function i(){let{fetchWithAuth:e,API_URL:t}=(0,n.a)(),[s,i]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),h=(0,a.useCallback)(async()=>{try{u(null);let s=await (0,l.r)(e,t,"/api.php/users");i(s.users||[])}catch(e){console.error(e),u(e.message)}finally{o(!1)}},[t,e]);(0,a.useEffect)(()=>{h()},[h]);let x={admin:"bg-purple-100 text-purple-700",medecin:"bg-green-100 text-green-700",technicien:"bg-blue-100 text-blue-700",viewer:"bg-gray-100 text-gray-700"};return(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDC65 Utilisateurs"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestion des acc\xe8s et permissions"})]}),(0,r.jsx)("button",{className:"btn-primary",children:"➕ Nouvel Utilisateur"})]}),(0,r.jsxs)("div",{className:"card",children:[d&&(0,r.jsxs)("div",{className:"alert alert-warning mb-4",children:[(0,r.jsx)("strong",{children:"Erreur API :"})," ",d]}),c?(0,r.jsx)("div",{className:"animate-shimmer h-64"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"Nom"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"Email"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"R\xf4le"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"Statut"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"Derni\xe8re connexion"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:s.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors animate-slide-up",style:{animationDelay:"".concat(.05*t,"s")},children:[(0,r.jsxs)("td",{className:"py-3 px-4 font-medium",children:[e.first_name," ",e.last_name]}),(0,r.jsx)("td",{className:"py-3 px-4 text-gray-600",children:e.email}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"badge ".concat(x[e.role_name]||"bg-gray-100 text-gray-700"),children:e.role_name})}),(0,r.jsx)("td",{className:"py-3 px-4",children:e.is_active?(0,r.jsx)("span",{className:"badge badge-success",children:"✅ Actif"}):(0,r.jsx)("span",{className:"badge text-gray-600 bg-gray-100",children:"❌ Inactif"})}),(0,r.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600",children:e.last_login?new Date(e.last_login).toLocaleString("fr-FR"):"Jamais"}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("button",{className:"btn-secondary text-sm",children:"✏️ Modifier"})})]},e.id))})]})})]})]})}},9999:function(e,t,s){"use strict";s.d(t,{H:function(){return i},a:function(){return c}});var r=s(7437),a=s(2265);let n=(0,a.createContext)(),l="https://ott-jbln.onrender.com";function i(e){let{children:t}=e,[s,i]=(0,a.useState)(null),[c,o]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(o(e),i(JSON.parse(t))),u(!1)},[]);let h=async(e,t)=>{let s=await fetch("".concat(l,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await s.json();if(!r.success)throw Error(r.error||"Erreur de connexion");return o(r.token),i(r.user),localStorage.setItem("ott_token",r.token),localStorage.setItem("ott_user",JSON.stringify(r.user)),r},x=()=>{o(null),i(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:r=!1}=s,a={...t},n={...t.headers||{}};if(a.body&&!n["Content-Type"]&&(n["Content-Type"]="application/json"),c)n.Authorization="Bearer ".concat(c);else throw Error("Non authentifi\xe9");a.headers=n;let l=await fetch(e,a);if(401===l.status&&c)throw x(),Error("Session expir\xe9e");return l};return(0,r.jsx)(n.Provider,{value:{user:s,token:c,loading:d,login:h,logout:x,fetchWithAuth:m,API_URL:l},children:t})}let c=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,s){"use strict";async function r(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=await e("".concat(t).concat(s),r,a),l=await n.json();if(!l.success)throw Error(l.error||"Erreur API");return l}s.d(t,{r:function(){return r}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3868)}),_N_E=e.O()}]);