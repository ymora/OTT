(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3618],{3868:function(e,t,l){Promise.resolve().then(l.bind(l,532))},532:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return x},dynamic:function(){return m}});var s=l(7437),a=l(2265),i=l(9999),n=l(5506),r=l(832),c=l(9723),d=l(6601),o=l(2919),u=l(899);l(8828);let m="force-dynamic";function x(){var e,t;let{fetchWithAuth:l,API_URL:m,user:x}=(0,i.a)(),[h,p]=(0,a.useState)(null),[g,j]=(0,a.useState)(null),{isOpen:f,editingItem:v,openCreate:b,openEdit:N,close:y}=(0,n.f7)(),{data:_,loading:w,error:C,refetch:D}=(0,n.m_)(["/api.php/users","/api.php/roles"],{requiresAuth:!0}),k=(null==_?void 0:null===(e=_.users)||void 0===e?void 0:e.users)||[],S=(null==_?void 0:null===(t=_.roles)||void 0===t?void 0:t.roles)||[],{searchTerm:R,setSearchTerm:A,filteredItems:E}=(0,n.L0)(k,{searchFn:(e,t)=>{let l=t.toLowerCase();return e.filter(e=>"".concat(e.first_name||""," ").concat(e.last_name||""," ").concat(e.email||""," ").concat(e.phone||""," ").concat(e.role_name||"").toLowerCase().includes(l))}}),U={admin:"bg-purple-100 text-purple-700",medecin:"bg-green-100 text-green-700",technicien:"bg-blue-100 text-blue-700"},{deleteLoading:Z,deleteError:L,handleDelete:I}=(0,n.nq)({fetchWithAuth:l,API_URL:m,refetch:D,entityName:"utilisateur",getEntityName:e=>"".concat(e.first_name||""," ").concat(e.last_name||"").trim()||e.email||"cet utilisateur",onCloseModal:e=>{f&&v&&v.id===e&&y()}});L&&!h&&p(L);let O=async()=>{j(v?"Utilisateur modifi\xe9 avec succ\xe8s":"Utilisateur cr\xe9\xe9 avec succ\xe8s"),await new Promise(e=>setTimeout(e,100)),await D()};return(0,s.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDC65 Utilisateurs"})}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(o.Z,{value:R,onChange:A,placeholder:"Rechercher un utilisateur..."})}),(0,s.jsx)("button",{className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",onClick:b,disabled:(null==x?void 0:x.role_name)!=="admin",title:(null==x?void 0:x.role_name)==="admin"?"Cr\xe9er un nouvel utilisateur":"R\xe9serv\xe9 aux administrateurs",children:"➕ Nouvel Utilisateur"})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)(c.Z,{error:C,onRetry:D}),(0,s.jsx)(c.Z,{error:h,onClose:()=>p(null)}),(0,s.jsx)(d.Z,{message:g,onClose:()=>j(null)}),w?(0,s.jsx)(r.Z,{size:"lg",text:"Chargement des utilisateurs..."}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"Nom"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"R\xf4le"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"Email"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"T\xe9l\xe9phone"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"Statut"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"Derni\xe8re connexion"}),(0,s.jsx)("th",{className:"text-right py-3 px-4",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:0===E.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"7",className:"py-8 text-center text-muted",children:"Aucun utilisateur trouv\xe9"})}):E.map((e,t)=>(0,s.jsxs)("tr",{className:"table-row animate-slide-up hover:bg-gray-50 dark:hover:bg-gray-800",style:{animationDelay:"".concat(.05*t,"s")},children:[(0,s.jsxs)("td",{className:"py-3 px-4 font-medium",children:[e.first_name," ",e.last_name]}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:"badge ".concat(U[e.role_name]||"bg-gray-100 text-gray-700"),children:e.role_name})}),(0,s.jsx)("td",{className:"table-cell",children:e.email}),(0,s.jsx)("td",{className:"table-cell text-sm",children:e.phone||"-"}),(0,s.jsx)("td",{className:"py-3 px-4",children:e.is_active?(0,s.jsx)("span",{className:"badge badge-success",children:"✅ Actif"}):(0,s.jsx)("span",{className:"badge text-gray-600 bg-gray-100",children:"❌ Inactif"})}),(0,s.jsx)("td",{className:"table-cell text-sm",children:e.last_login?new Date(e.last_login).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"Jamais"}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)("button",{className:"p-2 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors",onClick:()=>N(e),title:"Modifier l'utilisateur",children:(0,s.jsx)("span",{className:"text-lg",children:"✏️"})}),(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(e.id===(null==x?void 0:x.id)?"opacity-50 cursor-not-allowed":"hover:bg-red-100"),onClick:()=>I(e),disabled:Z||(null==x?void 0:x.role_name)!=="admin"||e.id===(null==x?void 0:x.id),title:(null==x?void 0:x.role_name)==="admin"&&e.id!==(null==x?void 0:x.id)?"Supprimer l'utilisateur":e.id===(null==x?void 0:x.id)?"Vous ne pouvez pas supprimer votre propre compte":"R\xe9serv\xe9 aux administrateurs",children:e.id===(null==x?void 0:x.id)?(0,s.jsxs)("span",{className:"text-lg relative inline-block",children:[(0,s.jsx)("span",{className:"text-red-500",children:"\uD83D\uDDD1️"}),(0,s.jsx)("span",{className:"absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center text-red-600 text-lg font-bold leading-none",style:{textShadow:"0 0 2px white, 0 0 2px white"},children:"✖"})]}):(0,s.jsx)("span",{className:"text-lg",children:Z?"⏳":"\uD83D\uDDD1️"})})]})})]},e.id))})]})})]}),(0,s.jsx)(u.Z,{isOpen:f,onClose:y,editingItem:v,type:"user",onSave:O,fetchWithAuth:l,API_URL:m,roles:S,currentUser:x})]})}}},function(e){e.O(0,[2200,5223,2971,2117,1744],function(){return e(e.s=3868)}),_N_E=e.O()}]);