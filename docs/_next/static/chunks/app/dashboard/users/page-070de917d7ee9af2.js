(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3618],{3868:function(e,t,r){Promise.resolve().then(r.bind(r,532))},532:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p},dynamic:function(){return m}});var a=r(7437),s=r(2265),l=r(9999),i=r(5993),n=r(832),c=r(9723),d=r(6601),o=r(2919),u=r(899);r(9131);var h=r(2617),x=r(8828);let m="force-dynamic";function p(){var e,t;let{fetchWithAuth:r,API_URL:m,user:p}=(0,l.a)(),g=e=>{var t;return!e||(null==p?void 0:p.role_name)==="admin"||(null==p?void 0:null===(t=p.permissions)||void 0===t?void 0:t.includes(e))||!1},[y,b]=(0,s.useState)(null),[v,f]=(0,s.useState)(null),{isOpen:j,editingItem:N,openCreate:D,openEdit:k,close:_}=(0,i.f7)(),[C,w]=(0,s.useState)(null),[E,A]=(0,s.useState)(!1),[S,U]=(0,s.useState)(!1),[Z,R]=(0,s.useState)(null),{data:L,loading:T,error:F,refetch:O,invalidateCache:q}=(0,i.m_)((0,s.useMemo)(()=>[S?"/api.php/users?include_deleted=true":"/api.php/users","/api.php/roles"],[S]),{requiresAuth:!0}),I=(null==L?void 0:null===(e=L.users)||void 0===e?void 0:e.users)||[],J=(null==L?void 0:null===(t=L.roles)||void 0===t?void 0:t.roles)||[],M=(0,s.useMemo)(()=>I.filter(e=>!e.deleted_at),[I]);(0,s.useMemo)(()=>I.filter(e=>e.deleted_at),[I]);let P=S?I:M,{searchTerm:z,setSearchTerm:H,filteredItems:V}=(0,i.L0)(P,{searchFn:(e,t)=>{let r=t.toLowerCase();return e.filter(e=>"".concat(e.first_name||""," ").concat(e.last_name||""," ").concat(e.email||""," ").concat(e.phone||""," ").concat(e.role_name||"").toLowerCase().includes(r))}}),W={admin:"bg-purple-100 text-purple-700",medecin:"bg-green-100 text-green-700",technicien:"bg-blue-100 text-blue-700"},B=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||C;if(t){w(t);try{A(!0),b(null);let e=t.id,a=(null==p?void 0:p.role_name)==="admin"?"/api.php/users/".concat(e,"?archive=true"):"/api.php/users/".concat(e),s=await (0,h.fetchJson)(r,m,a,{method:"DELETE"},{requiresAuth:!0});s.success?(f("✅ Utilisateur archiv\xe9 avec succ\xe8s"),O(),w(null),j&&N&&N.id===t.id&&_()):b(s.error||"Erreur lors de l'archivage")}catch(e){b(e.message||"Erreur lors de l'archivage"),x.Z.error("Erreur archivage user:",e)}finally{A(!1)}}},G=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||C;if(t){w(t);try{A(!0),b(null);let e=await (0,h.fetchJson)(r,m,"/api.php/users/".concat(t.id,"?permanent=true"),{method:"DELETE"},{requiresAuth:!0});e.success?(f("✅ Utilisateur supprim\xe9 d\xe9finitivement"),O(),w(null),j&&N&&N.id===t.id&&_()):b(e.error||"Erreur lors de la suppression")}catch(e){b(e.message||"Erreur lors de la suppression"),x.Z.error("Erreur suppression user:",e)}finally{A(!1)}}},K=async e=>{try{R(e.id),b(null);let t=await r("".concat(m,"/api.php/users/").concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({deleted_at:null})},{requiresAuth:!0});if(t.ok)f("✅ Utilisateur restaur\xe9 avec succ\xe8s"),q(),await O();else{let e=await t.json().catch(()=>({}));b(e.error||"Erreur lors de la restauration")}}catch(e){b(e.message||"Erreur lors de la restauration"),x.Z.error("Erreur restauration user:",e)}finally{R(null)}},Q=(0,s.useRef)([]);(0,s.useEffect)(()=>()=>{Q.current.forEach(e=>clearTimeout(e)),Q.current=[]},[]);let X=async()=>{f(N?"Utilisateur modifi\xe9 avec succ\xe8s":"Utilisateur cr\xe9\xe9 avec succ\xe8s"),await new Promise(e=>setTimeout(e,100)),await O()};return(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDC65 Utilisateurs"})}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(o.Z,{value:z,onChange:H,placeholder:"Rechercher un utilisateur..."})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:e=>U(e.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"\uD83D\uDDC4️ Afficher les archives"})]})}),(0,a.jsx)("button",{className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",onClick:D,disabled:(null==p?void 0:p.role_name)!=="admin",title:(null==p?void 0:p.role_name)==="admin"?"Cr\xe9er un nouvel utilisateur":"R\xe9serv\xe9 aux administrateurs",children:"➕ Nouvel Utilisateur"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)(c.Z,{error:F,onRetry:O}),(0,a.jsx)(c.Z,{error:y,onClose:()=>b(null)}),(0,a.jsx)(d.Z,{message:v,onClose:()=>f(null)}),T?(0,a.jsx)(n.Z,{size:"lg",text:"Chargement des utilisateurs..."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Nom"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"R\xf4le"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Email"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"T\xe9l\xe9phone"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Statut"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-gray-700 dark:text-gray-300",children:"Derni\xe8re connexion"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 text-gray-700 dark:text-gray-300",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===V.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"7",className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"Aucun utilisateur trouv\xe9"})}):V.map((e,t)=>{let r=!!e.deleted_at;return(0,a.jsxs)("tr",{className:"table-row animate-slide-up hover:bg-gray-50 dark:hover:bg-gray-800 ".concat(r?"opacity-60":""),style:{animationDelay:"".concat(.05*t,"s")},children:[(0,a.jsx)("td",{className:"table-cell py-3 px-4 font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{children:[e.first_name," ",e.last_name]}),r&&(0,a.jsx)("span",{className:"badge bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400 text-xs",children:"\uD83D\uDDC4️ Archiv\xe9"})]})}),(0,a.jsx)("td",{className:"table-cell py-3 px-4",children:(0,a.jsx)("span",{className:"badge ".concat(W[e.role_name]||"bg-gray-100 text-gray-700"),children:e.role_name})}),(0,a.jsx)("td",{className:"table-cell",children:e.email}),(0,a.jsx)("td",{className:"table-cell text-sm",children:e.phone||"-"}),(0,a.jsx)("td",{className:"table-cell py-3 px-4",children:e.is_active?(0,a.jsx)("span",{className:"badge badge-success",children:"✅ Actif"}):(0,a.jsx)("span",{className:"badge text-gray-600 bg-gray-100",children:"❌ Inactif"})}),(0,a.jsx)("td",{className:"table-cell text-sm",children:e.last_login?new Date(e.last_login).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"Jamais"}),(0,a.jsx)("td",{className:"table-cell py-3 px-4",children:(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:r?(0,a.jsx)("button",{onClick:()=>K(e),disabled:Z===e.id,className:"p-2 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors disabled:opacity-50",title:"Restaurer l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:Z===e.id?"⏳":"♻️"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"p-2 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors",onClick:()=>k(e),title:"Modifier l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:"✏️"})}),e.id!==(null==p?void 0:p.id)&&g("users.manage")&&(0,a.jsx)(a.Fragment,{children:(null==p?void 0:p.role_name)==="admin"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"p-2 hover:bg-orange-100 dark:hover:bg-orange-900/30 rounded-lg transition-colors",onClick:()=>B(e),disabled:E,title:"Archiver l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:E?"⏳":"\uD83D\uDDC4️"})}),(0,a.jsx)("button",{className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors",onClick:()=>G(e),disabled:E,title:"Supprimer d\xe9finitivement l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:E?"⏳":"\uD83D\uDDD1️"})})]}):(0,a.jsx)("button",{className:"p-2 hover:bg-orange-100 dark:hover:bg-orange-900/30 rounded-lg transition-colors",onClick:()=>B(e),disabled:E,title:"Archiver l'utilisateur",children:(0,a.jsx)("span",{className:"text-lg",children:E?"⏳":"\uD83D\uDDC4️"})})}),e.id===(null==p?void 0:p.id)&&(0,a.jsx)("button",{className:"p-2 opacity-50 cursor-not-allowed rounded-lg",disabled:!0,title:"Vous ne pouvez pas supprimer votre propre compte",children:(0,a.jsxs)("span",{className:"text-lg relative inline-block",children:[(0,a.jsx)("span",{className:"text-red-500",children:"\uD83D\uDDD1️"}),(0,a.jsx)("span",{className:"absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center text-red-600 text-lg font-bold leading-none",style:{textShadow:"0 0 2px white, 0 0 2px white"},children:"✖"})]})})]})})})]},e.id)})})]})})]}),(0,a.jsx)(u.Z,{isOpen:j,onClose:_,editingItem:N,type:"user",onSave:X,fetchWithAuth:r,API_URL:m,roles:J,currentUser:p})]})}}},function(e){e.O(0,[7410,376,2971,2117,1744],function(){return e(e.s=3868)}),_N_E=e.O()}]);