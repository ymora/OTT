(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{2747:function(e,t,r){Promise.resolve().then(r.bind(r,6424))},6424:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(7437),n=r(2265),s=r(9376),i=r(7648),o=r(9999);let l=e=>"".concat("/OTT").concat(e),d=[{name:"Vue d'Ensemble",icon:"\uD83C\uDFE0",path:"/dashboard",permission:null},{name:"Dispositifs",icon:"\uD83D\uDD0C",path:"/dashboard/devices",permission:"devices.view"},{name:"Commandes",icon:"\uD83D\uDCE1",path:"/dashboard/commands",permission:"devices.commands"},{name:"Patients",icon:"\uD83D\uDC65",path:"/dashboard/patients",permission:"patients.view"},{name:"Alertes",icon:"\uD83D\uDD14",path:"/dashboard/alerts",permission:"alerts.view"},{name:"Carte",icon:"\uD83D\uDDFA️",path:"/dashboard/map",permission:null},{name:"Historique",icon:"\uD83D\uDCCB",path:"/dashboard/history",permission:null},{name:"Journal",icon:"\uD83D\uDCDD",path:"/dashboard/logs",permission:null},{name:"Rapports",icon:"\uD83D\uDCCA",path:"/dashboard/reports",permission:"reports.view"},{name:"Utilisateurs",icon:"\uD83D\uDC64",path:"/dashboard/users",permission:"users.view"},{name:"Notifications",icon:"\uD83D\uDCE7",path:"/dashboard/notifications",permission:null},{name:"OTA",icon:"\uD83D\uDD04",path:"/dashboard/ota",permission:"devices.ota"},{name:"Audit",icon:"\uD83D\uDCDC",path:"/dashboard/audit",permission:"audit.view"},{name:"Administration",icon:"\uD83D\uDEE0️",path:"/dashboard/admin",permission:"settings.edit"}];function c(){let e=(0,s.usePathname)(),{user:t}=(0,o.a)(),r=e=>{var r;return!e||(null==t?void 0:t.role_name)==="admin"||(null==t?void 0:null===(r=t.permissions)||void 0===r?void 0:r.includes(e))};return(0,a.jsxs)("aside",{className:"fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white border-r border-gray-200 overflow-y-auto",children:[(0,a.jsx)("nav",{className:"p-4 space-y-1",children:d.map(t=>{if(!r(t.permission))return null;let n=e===t.path;return(0,a.jsxs)(i.default,{href:t.path,className:"\n                flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-all\n                ".concat(n?"bg-gradient-to-r from-primary-500 to-secondary-500 text-white shadow-lg scale-105":"text-gray-700 hover:bg-gray-100 hover:scale-102","\n              "),children:[(0,a.jsx)("span",{className:"text-xl",children:t.icon}),(0,a.jsx)("span",{children:t.name}),n&&(0,a.jsx)("div",{className:"ml-auto w-2 h-2 bg-white rounded-full animate-pulse"})]},t.path)})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-gray-50 to-transparent",children:(0,a.jsxs)("a",{href:l("/DOCUMENTATION_COMPLETE_OTT.html"),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-primary-50 text-primary-700 rounded-lg hover:bg-primary-100 transition-all",children:[(0,a.jsx)("span",{children:"\uD83D\uDCD6"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Documentation"})]})})]})}function u(){var e,t;let{user:r,logout:i}=(0,o.a)(),l=(0,s.useRouter)(),[d,c]=(0,n.useState)(!1),u=r||{first_name:"D\xe9mo",last_name:"User",role_name:"admin"};return(0,a.jsx)("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-full px-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-lg flex items-center justify-center shadow-md",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent",children:"OTT Dashboard Pro"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"HAPPLYZ MEDICAL SAS"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{className:"btn-secondary hover:rotate-180 transition-transform duration-500",children:"\uD83D\uDD04"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>c(!d),className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100 transition-all",children:[(0,a.jsxs)("div",{className:"w-8 h-8 bg-gradient-to-br from-primary-400 to-secondary-400 rounded-full flex items-center justify-center text-white font-bold",children:[null==u?void 0:null===(e=u.first_name)||void 0===e?void 0:e[0],null==u?void 0:null===(t=u.last_name)||void 0===t?void 0:t[0]]}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:[null==u?void 0:u.first_name," ",null==u?void 0:u.last_name]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null==u?void 0:u.role_name})]}),(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&(0,a.jsx)("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-100 animate-slide-down",children:(0,a.jsx)("button",{onClick:()=>{i(),l.push("/")},className:"w-full px-4 py-2 text-left text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"\uD83D\uDEAA D\xe9connexion"})})]})]})]})})}function m(e){let{children:t}=e,r=(0,s.useRouter)(),{user:i,loading:l}=(0,o.a)();return((0,n.useEffect)(()=>{l||i||r.push("/")},[i,l,r]),l)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]})}):i?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(u,{}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(c,{}),(0,a.jsx)("main",{className:"flex-1 p-6 ml-64 mt-16",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:t})})]})]}):null}function h(e){let{children:t}=e;return(0,a.jsx)(o.H,{children:(0,a.jsx)(m,{children:t})})}},9999:function(e,t,r){"use strict";r.d(t,{H:function(){return o},a:function(){return l}});var a=r(7437),n=r(2265);let s=(0,n.createContext)(),i="https://ott-jbln.onrender.com";function o(e){let{children:t}=e,[r,o]=(0,n.useState)(null),[l,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(d(e),o(JSON.parse(t))),u(!1)},[]);let m=async(e,t)=>{let r=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await r.json();if(!a.success)throw Error(a.error||"Erreur de connexion");return d(a.token),o(a.user),localStorage.setItem("ott_token",a.token),localStorage.setItem("ott_user",JSON.stringify(a.user)),a},h=()=>{d(null),o(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:a=!1}=r,n={...t},s={...t.headers||{}};if(n.body&&!s["Content-Type"]&&(s["Content-Type"]="application/json"),l)s.Authorization="Bearer ".concat(l);else throw Error("Non authentifi\xe9");n.headers=s;let i=await fetch(e,n);if(401===i.status&&l)throw h(),Error("Session expir\xe9e");return i};return(0,a.jsx)(s.Provider,{value:{user:r,token:l,loading:c,login:m,logout:h,fetchWithAuth:p,API_URL:i},children:t})}let l=()=>{let e=(0,n.useContext)(s);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=2747)}),_N_E=e.O()}]);