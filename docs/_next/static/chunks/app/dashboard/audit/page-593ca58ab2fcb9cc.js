(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{9345:function(e,t,r){Promise.resolve().then(r.bind(r,7046))},7046:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(7437),a=r(2265),s=r(9999),i=r(2617),o=r(7062);let l={"user.login":"border-green-500 bg-green-50 text-green-700","user.created":"border-blue-500 bg-blue-50 text-blue-700","device.config_updated":"border-orange-500 bg-orange-50 text-orange-700","firmware.uploaded":"border-purple-500 bg-purple-50 text-purple-700"};function c(){let{fetchWithAuth:e,API_URL:t}=(0,s.a)(),[r,c]=(0,a.useState)([]),[u,d]=(0,a.useState)(!0),[h,m]=(0,a.useState)(null),f=(0,a.useCallback)(async()=>{try{m(null);let r=await (0,i.r)(e,t,"/api.php/audit?limit=200");c(r.logs||[])}catch(e){console.error(e),m(e.message)}finally{d(!1)}},[e,t]);return(0,a.useEffect)(()=>{f()},[f]),(0,n.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDCDC Journal d'Audit"}),(0,n.jsx)("p",{className:"text-gray-600 mt-1",children:"Tra\xe7abilit\xe9 compl\xe8te des actions"})]}),(0,n.jsx)("button",{onClick:f,className:"btn-secondary",children:"\uD83D\uDD04 Actualiser"})]}),h&&(0,n.jsxs)("div",{className:"alert alert-warning",children:[(0,n.jsx)("strong",{children:"Erreur API :"})," ",h]}),(0,n.jsx)("div",{className:"space-y-3",children:u?[1,2,3,4,5].map(e=>(0,n.jsx)("div",{className:"card animate-shimmer h-24"},e)):r.map((e,t)=>{let r=l[e.action]||"border-gray-300 bg-gray-50 text-gray-700";return(0,n.jsx)("div",{className:"border-l-4 ".concat(r," p-4 rounded-r-lg animate-slide-up hover:shadow-md transition-all"),style:{animationDelay:"".concat(.03*t,"s")},children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold mb-1",children:e.action}),(0,n.jsxs)("p",{className:"text-sm opacity-80",children:["\uD83D\uDC64 ",e.email||"Syst\xe8me"," • \uD83C\uDF10 ",e.ip_address||"n/a"," • \uD83D\uDD52 ",(0,o.o0)(e.created_at)]}),e.entity_type&&(0,n.jsxs)("p",{className:"text-sm mt-1",children:["\uD83D\uDCE6 ",e.entity_type," #",e.entity_id]})]}),(0,n.jsx)("span",{className:"badge bg-white",children:(e.action||"").split(".")[0]})]})},e.id||t)})})]})}},9999:function(e,t,r){"use strict";r.d(t,{H:function(){return o},a:function(){return l}});var n=r(7437),a=r(2265);let s=(0,a.createContext)(),i="https://ott-jbln.onrender.com";function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[l,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),o(JSON.parse(t))),d(!1)},[]);let h=async(e,t)=>{let r=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=await r.json();if(!n.success)throw Error(n.error||"Erreur de connexion");return c(n.token),o(n.user),localStorage.setItem("ott_token",n.token),localStorage.setItem("ott_user",JSON.stringify(n.user)),n},m=()=>{c(null),o(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:n=!1}=r,a={...t},s={...t.headers||{}};if(a.body&&!s["Content-Type"]&&(s["Content-Type"]="application/json"),l)s.Authorization="Bearer ".concat(l);else throw Error("Non authentifi\xe9");a.headers=s;let i=await fetch(e,a);if(401===i.status&&l)throw m(),Error("Session expir\xe9e");return i};return(0,n.jsx)(s.Provider,{value:{user:r,token:l,loading:u,login:h,logout:m,fetchWithAuth:f,API_URL:i},children:t})}let l=()=>{let e=(0,a.useContext)(s);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,r){"use strict";async function n(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=await e("".concat(t).concat(r),n,a),i=await s.json();if(!i.success)throw Error(i.error||"Erreur API");return i}r.d(t,{r:function(){return n}})},7062:function(e,t,r){"use strict";function n(e){return e?new Date(e).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}r.d(t,{o0:function(){return n}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=9345)}),_N_E=e.O()}]);