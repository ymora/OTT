(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{4178:function(e,t,s){Promise.resolve().then(s.bind(s,2422))},2422:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),n=s(2265),r=s(9999),i=s(2617);function l(){let{fetchWithAuth:e,API_URL:t}=(0,r.a)(),[s,l]=(0,n.useState)(null),[c,o]=(0,n.useState)([]),[u,d]=(0,n.useState)(!0),[m,h]=(0,n.useState)(!1),[p,x]=(0,n.useState)(null),[f,g]=(0,n.useState)(null),b=(0,n.useCallback)(async()=>{try{g(null);let[s,a]=await Promise.all([(0,i.r)(e,t,"/api.php/notifications/preferences"),(0,i.r)(e,t,"/api.php/notifications/queue?limit=50")]);l(s.preferences||{}),o(a.queue||[])}catch(e){g(e.message)}finally{d(!1)}},[t,e]);(0,n.useEffect)(()=>{b()},[b]);let y=e=>{l(t=>({...t,[e]:!(null==t?void 0:t[e])}))},j=(e,t)=>{l(s=>({...s,[e]:t}))},N=async()=>{try{h(!0),x(null),await (0,i.r)(e,t,"/api.php/notifications/preferences",{method:"PUT",body:JSON.stringify(s)},{requiresAuth:!1}),x("Pr\xe9f\xe9rences enregistr\xe9es")}catch(e){g(e.message)}finally{h(!1)}},v=async s=>{try{await (0,i.r)(e,t,"/api.php/notifications/test",{method:"POST",body:JSON.stringify({type:s})},{requiresAuth:!1}),x("Notification ".concat(s.toUpperCase()," envoy\xe9e (voir logs serveur)"))}catch(e){g(e.message)}};return u||!s?(0,a.jsx)("div",{className:"card animate-shimmer h-64"}):(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDCE7 Notifications"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Configurer les canaux d'alertes et pr\xe9f\xe9rences."})]}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)("button",{className:"btn-secondary",onClick:()=>v("email"),children:"✉️ Test Email"}),(0,a.jsx)("button",{className:"btn-secondary",onClick:()=>v("sms"),children:"\uD83D\uDCF1 Test SMS"})]})]}),(f||p)&&(0,a.jsx)("div",{className:"alert ".concat(f?"alert-warning":"alert-success"),children:f||p}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Pr\xe9f\xe9rences personnelles"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["email_enabled","sms_enabled","push_enabled"].map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!s[e],onChange:()=>y(e)}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["email_enabled"===e&&"Email","sms_enabled"===e&&"SMS","push_enabled"===e&&"Push (PWA)"]})]},e))}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Num\xe9ro SMS"}),(0,a.jsx)("input",{type:"tel",value:s.phone_number||"",onChange:e=>j("phone_number",e.target.value),className:"input",placeholder:"+336..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure d\xe9but silence"}),(0,a.jsx)("input",{type:"time",value:s.quiet_hours_start||"",onChange:e=>j("quiet_hours_start",e.target.value),className:"input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure fin silence"}),(0,a.jsx)("input",{type:"time",value:s.quiet_hours_end||"",onChange:e=>j("quiet_hours_end",e.target.value),className:"input"})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:[{field:"notify_battery_low",label:"Batterie faible"},{field:"notify_device_offline",label:"Dispositif hors ligne"},{field:"notify_abnormal_flow",label:"D\xe9bit anormal"},{field:"notify_new_patient",label:"Nouveau patient"}].map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm bg-gray-50 px-3 py-2 rounded-lg",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!s[e.field],onChange:()=>y(e.field)}),e.label]},e.field))}),(0,a.jsx)("button",{className:"btn-primary",onClick:N,disabled:m,children:m?"Enregistrement...":"\uD83D\uDCBE Enregistrer"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Queue des notifications"}),(0,a.jsx)("div",{className:"space-y-3 max-h-[420px] overflow-y-auto",children:0===c.length?(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Aucune notification en attente."}):c.map(e=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"badge bg-primary-50 text-primary-700",children:e.type.toUpperCase()}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.status})]}),(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.subject||"Notification"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.message}),(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["→ ",e.email," (",e.priority,")"]})]},e.id))})]})]})]})}},9999:function(e,t,s){"use strict";s.d(t,{H:function(){return l},a:function(){return c}});var a=s(7437),n=s(2265);let r=(0,n.createContext)(),i="https://ott-jbln.onrender.com";function l(e){let{children:t}=e,[s,l]=(0,n.useState)(null),[c,o]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(o(e),l(JSON.parse(t))),d(!1)},[]);let m=async(e,t)=>{let s=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await s.json();if(!a.success)throw Error(a.error||"Erreur de connexion");return o(a.token),l(a.user),localStorage.setItem("ott_token",a.token),localStorage.setItem("ott_user",JSON.stringify(a.user)),a},h=()=>{o(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:a=!1}=s,n={...t},r={...t.headers||{}};if(n.body&&!r["Content-Type"]&&(r["Content-Type"]="application/json"),c)r.Authorization="Bearer ".concat(c);else throw Error("Non authentifi\xe9");n.headers=r;let i=await fetch(e,n);if(401===i.status&&c)throw h(),Error("Session expir\xe9e");return i};return(0,a.jsx)(r.Provider,{value:{user:s,token:c,loading:u,login:m,logout:h,fetchWithAuth:p,API_URL:i},children:t})}let c=()=>{let e=(0,n.useContext)(r);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,s){"use strict";async function a(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=await e("".concat(t).concat(s),a,n),i=await r.json();if(!i.success)throw Error(i.error||"Erreur API");return i}s.d(t,{r:function(){return a}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4178)}),_N_E=e.O()}]);