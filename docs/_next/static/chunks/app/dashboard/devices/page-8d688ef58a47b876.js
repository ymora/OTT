(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[146],{5071:function(e,t,s){Promise.resolve().then(s.bind(s,9602))},9602:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var n=s(7437),r=s(2265),a=s(9004),i=s(9999),l=s(2617);function o(){let{fetchWithAuth:e,API_URL:t}=(0,i.a)(),[s,o]=(0,r.useState)([]),[c,u]=(0,r.useState)(!0),[d,m]=(0,r.useState)(""),[h,x]=(0,r.useState)(null),f=(0,r.useCallback)(async()=>{try{x(null);let s=await (0,l.r)(e,t,"/api.php/devices");o(s.devices||[])}catch(e){console.error(e),x(e.message)}finally{u(!1)}},[e,t]);(0,r.useEffect)(()=>{f()},[f]);let g=s.filter(e=>{var t,s;return(null===(t=e.device_name)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null===(s=e.sim_iccid)||void 0===s?void 0:s.includes(d))||"".concat(e.first_name||""," ").concat(e.last_name||"").toLowerCase().includes(d.toLowerCase())});return(0,n.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Dispositifs OTT"}),(0,n.jsxs)("p",{className:"text-gray-600 mt-1",children:[s.length," dispositif(s) total"]})]}),h&&(0,n.jsxs)("div",{className:"alert alert-warning",children:[(0,n.jsx)("strong",{children:"Erreur API :"})," ",h]}),(0,n.jsx)("button",{className:"btn-primary",children:"➕ Nouveau Dispositif"})]}),(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("input",{type:"text",placeholder:"\uD83D\uDD0D Rechercher par nom, patient, ou ICCID...",value:d,onChange:e=>m(e.target.value),className:"input"})}),c?(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,n.jsx)("div",{className:"card animate-shimmer h-40"},e))}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map((e,t)=>(0,n.jsx)(a.Z,{device:e,delay:.03*t},e.id))}),0===g.length&&!c&&(0,n.jsx)("div",{className:"card text-center py-12",children:(0,n.jsx)("p",{className:"text-gray-500",children:"Aucun dispositif trouv\xe9"})})]})}},9004:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var n=s(7437);function r(e){var t;let{device:s,delay:r=0,onSelect:a}=e,i=()=>{if(!s.last_seen)return!1;let e=new Date(s.last_seen);return(Date.now()-e.getTime())/36e5<2},l="number"==typeof s.last_battery?s.last_battery:null;return(0,n.jsxs)("div",{className:"card group hover:scale-102 cursor-pointer animate-scale-in",style:{animationDelay:"".concat(r,"s")},onClick:()=>null==a?void 0:a(s),role:a?"button":void 0,tabIndex:a?0:void 0,children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 ".concat(i()?"text-green-600":"text-gray-400"),children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(i()?"bg-green-500 animate-pulse":"bg-gray-400")}),(0,n.jsx)("span",{className:"text-xs font-medium",children:i()?"En ligne":"Hors ligne"})]}),(0,n.jsxs)("span",{className:"text-2xl ".concat(null===l?"text-gray-400":l>60?"text-green-600":l>20?"text-orange-600":"text-red-600"),children:["\uD83D\uDD0B ",null!==l?"".concat(l.toFixed(0),"%"):"N/A"]})]}),(0,n.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 group-hover:text-primary-600 transition-colors",children:s.device_name||"OTT-".concat(null===(t=s.sim_iccid)||void 0===t?void 0:t.substr(-8))}),s.first_name&&(0,n.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["\uD83D\uDC64 ",s.first_name," ",s.last_name]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["\uD83D\uDCCD ",s.city||"Non localis\xe9"," | \uD83D\uDC41️ ",s.last_seen?new Date(s.last_seen).toLocaleString("fr-FR"):"n/a"]})]})}},9999:function(e,t,s){"use strict";s.d(t,{H:function(){return l},a:function(){return o}});var n=s(7437),r=s(2265);let a=(0,r.createContext)(),i="https://ott-jbln.onrender.com";function l(e){let{children:t}=e,[s,l]=(0,r.useState)(null),[o,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");e&&t&&(c(e),l(JSON.parse(t))),d(!1)},[]);let m=async(e,t)=>{let s=await fetch("".concat(i,"/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=await s.json();if(!n.success)throw Error(n.error||"Erreur de connexion");return c(n.token),l(n.user),localStorage.setItem("ott_token",n.token),localStorage.setItem("ott_user",JSON.stringify(n.user)),n},h=()=>{c(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},x=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:n=!1}=s,r={...t},a={...t.headers||{}};if(r.body&&!a["Content-Type"]&&(a["Content-Type"]="application/json"),o)a.Authorization="Bearer ".concat(o);else throw Error("Non authentifi\xe9");r.headers=a;let i=await fetch(e,r);if(401===i.status&&o)throw h(),Error("Session expir\xe9e");return i};return(0,n.jsx)(a.Provider,{value:{user:s,token:o,loading:u,login:m,logout:h,fetchWithAuth:x,API_URL:i},children:t})}let o=()=>{let e=(0,r.useContext)(a);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},2617:function(e,t,s){"use strict";async function n(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=await e("".concat(t).concat(s),n,r),i=await a.json();if(!i.success)throw Error(i.error||"Erreur API");return i}s.d(t,{r:function(){return n}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5071)}),_N_E=e.O()}]);