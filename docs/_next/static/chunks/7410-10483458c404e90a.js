"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7410,2617],{9723:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),o=r(2265);function a(e){let{error:t,onRetry:r=null,onClose:a=null,autoClose:s=null,className:u=""}=e;return((0,o.useEffect)(()=>{if(s&&a&&t){let e=setTimeout(()=>{a()},s);return()=>clearTimeout(e)}},[s,a,t]),t)?(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg animate-slide-down ".concat(u),children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:"❌ Erreur"}),(0,n.jsx)("p",{className:"text-sm mt-1",children:t})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,n.jsx)("button",{onClick:r,className:"ml-4 text-red-700 hover:text-red-900 underline text-sm",children:"R\xe9essayer"}),a&&(0,n.jsx)("button",{onClick:a,className:"ml-4 text-red-700 hover:text-red-900 text-sm","aria-label":"Fermer",children:"✕"})]})]})}):null}},832:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(7437);function o(e){let{size:t="md",text:r="Chargement...",fullScreen:o=!1}=e,a=(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,n.jsx)("div",{className:"".concat({sm:"w-4 h-4 border-2",md:"w-8 h-8 border-3",lg:"w-16 h-16 border-4",xl:"w-24 h-24 border-4"}[t]," border-primary-500 border-t-transparent rounded-full animate-spin")}),r&&(0,n.jsx)("p",{className:"text-gray-600 dark:text-[rgb(var(--night-text-secondary))]",children:r})]});return o?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-[rgb(var(--night-bg-start))]",children:a}):a}},9999:function(e,t,r){r.d(t,{AuthProvider:function(){return d},a:function(){return f}});var n=r(7437),o=r(2265),a=r(8828);let s=(0,o.createContext)(),u="https://ott-jbln.onrender.com".replace(/\/$/,""),l=e=>/^https?:\/\//i.test(e),i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?l(e)?e:e.startsWith("/")?"".concat(u).concat(e):"".concat(u,"/").concat(e):u},c=e=>i(e);function d(e){let{children:t}=e,[r,l]=(0,o.useState)(null),[i,d]=(0,o.useState)(null),[f,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{a.Z.debug("[AuthContext] Initialisation...");try{let e=localStorage.getItem("ott_token"),t=localStorage.getItem("ott_user");if(a.Z.debug("[AuthContext] localStorage:",{hasToken:!!e,hasUser:!!t,tokenLength:(null==e?void 0:e.length)||0}),e&&t)try{let r=JSON.parse(t);d(e),l(r),a.Z.debug("[AuthContext] Utilisateur restaur\xe9:",r.email||r.username)}catch(e){a.Z.error("[AuthContext] Erreur parsing user:",e),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")}else a.Z.debug("[AuthContext] Aucun utilisateur stock\xe9")}catch(e){a.Z.error("[AuthContext] Erreur lors de l'initialisation:",e)}finally{h(!1),a.Z.debug("[AuthContext] Initialisation termin\xe9e, loading=false")}},[]);let g=async(e,t)=>{try{let r=await fetch(c("/api.php/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=r.headers.get("content-type")||"",o=n.includes("application/json");if(!r.ok||!o){let e=await r.text();a.Z.error("[AuthContext] ❌ Erreur serveur"),a.Z.error("[AuthContext] Status:",r.status),a.Z.error("[AuthContext] Content-Type:",n),a.Z.error("[AuthContext] R\xe9ponse compl\xe8te:",e);let t="Erreur serveur (".concat(r.status,")");try{let r=JSON.parse(e);t=r.error||r.message||t}catch(n){if(e.includes("Parse error")||e.includes("Fatal error")||e.includes("Warning")){let n=e.match(/(?:Parse error|Fatal error|Warning):\s*(.+?)(?:\n|$)/i);t=n?"Erreur PHP: ".concat(n[1].substring(0,200)):"Erreur serveur (".concat(r.status,"). L'API distante ne r\xe9pond pas correctement.")}else e.includes("Database")||e.includes("Connection")?t="Erreur de connexion \xe0 la base de donn\xe9es":500===r.status&&(t="Erreur serveur interne. L'API distante rencontre un probl\xe8me.")}{let t="[".concat(new Date().toISOString(),"] ERREUR API\n")+"URL: ".concat(c("/api.php/auth/login"),"\n")+"Status: ".concat(r.status,"\n")+"Content-Type: ".concat(n,"\n")+"R\xe9ponse: ".concat(e.substring(0,1e3),"\n\n");try{localStorage.setItem("api_error_log",t),a.Z.debug("[AuthContext] \uD83D\uDCBE Log sauvegard\xe9 dans localStorage")}catch(e){a.Z.error("[AuthContext] Erreur sauvegarde log:",e)}}throw Error(t)}let s=await r.json();if(!s.success)throw Error(s.error||"Erreur de connexion");return d(s.token),l(s.user),localStorage.setItem("ott_token",s.token),localStorage.setItem("ott_user",JSON.stringify(s.user)),s}catch(e){if(e.message&&e.message.includes("Erreur serveur"))throw e;throw a.Z.error("[AuthContext] ❌ Erreur lors de la connexion:",e),Error("Erreur de connexion au serveur. V\xe9rifiez votre connexion internet.")}},m=()=>{d(null),l(null),localStorage.removeItem("ott_token"),localStorage.removeItem("ott_user")},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{requiresAuth:n=!1}=r,o={...t},a={...t.headers||{}};if(o.body&&!a["Content-Type"]&&(a["Content-Type"]="application/json"),i)a.Authorization="Bearer ".concat(i);else throw Error("Non authentifi\xe9");o.headers=a;let s=c(e),u=await fetch(s,o);if(401===u.status&&i)throw m(),Error("Session expir\xe9e");return u};return(0,n.jsx)(s.Provider,{value:{user:r,token:i,loading:f,login:g,logout:m,fetchWithAuth:p,API_URL:u},children:t})}let f=()=>{let e=(0,o.useContext)(s);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans AuthProvider");return e}},5993:function(e,t,r){r.d(t,{m_:function(){return l},w3:function(){return h},Nr:function(){return i},iq:function(){return g},f7:function(){return f},L0:function(){return c},H2:function(){return m},Eg:function(){return d}});var n=r(2265),o=r(9999),a=r(2617),s=r(8828);let u=new Map;function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{fetchWithAuth:r,API_URL:l}=(0,o.a)(),{autoLoad:i=!0,requiresAuth:c=!1,fetchOptions:d={},cacheTTL:f=3e4}=t,h=(0,n.useRef)(null),g=Array.isArray(e),[m,p]=(0,n.useState)(g?{}:null),[v,E]=(0,n.useState)(i),[x,y]=(0,n.useState)(null),w=(0,n.useMemo)(()=>g?JSON.stringify(e):e,[e,g]),b=(0,n.useMemo)(()=>d,[]),S=(0,n.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{y(null);let n=g?JSON.stringify(e):e;if(h.current=n,f>0&&!t){let e=u.get(n);if(e&&Date.now()-e.timestamp<f){p(e.data),E(!1);return}}E(!0);let o=g?e:[e];if(g){let e=o.map(e=>(0,a.fetchJson)(r,l,e,b,{requiresAuth:c}).catch(t=>(s.Z.error("Erreur chargement ".concat(e,":"),t),{success:!1,error:t.message||"Erreur lors du chargement",data:null}))),t=await Promise.all(e),i={};o.forEach((e,r)=>{i[e.split("?")[0].split("/").pop()||"data"]=t[r]}),f>0&&u.set(n,{data:i,timestamp:Date.now()}),p(i)}else{let e=await (0,a.fetchJson)(r,l,o[0],b,{requiresAuth:c});f>0&&u.set(n,{data:e,timestamp:Date.now()}),p(e)}}catch(e){s.Z.error("Erreur chargement donn\xe9es:",e),y(e.message||"Erreur lors du chargement des donn\xe9es"),p(g?{}:null)}finally{E(!1)}},[e,r,l,c,g,b,f]);(0,n.useEffect)(()=>{i&&S()},[i,w]);let C=(0,n.useCallback)(()=>{h.current&&u.delete(h.current)},[]);return{data:m,loading:v,error:x,refetch:(0,n.useCallback)(()=>S(!0),[S]),setData:p,invalidateCache:C}}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,[r,o]=(0,n.useState)(e);return(0,n.useEffect)(()=>{let r=setTimeout(()=>{o(e)},t);return()=>{clearTimeout(r)}},[e,t]),r}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{searchFn:r,filterFn:o,debounceDelay:a=300}=t,[s,u]=(0,n.useState)(""),[l,c]=(0,n.useState)({}),d=i(s,a),f=(0,n.useMemo)(()=>{let t=e;if(d){if(r)t=r(t,d);else{let e=d.toLowerCase();t=t.filter(t=>Object.values(t).some(t=>"string"==typeof t&&t.toLowerCase().includes(e)))}}return o?t=o(t,l):Object.entries(l).forEach(e=>{let[r,n]=e;n&&"ALL"!==n&&(t=t.filter(e=>String(e[r])===String(n)))}),t},[e,d,l,r,o]);return{searchTerm:s,setSearchTerm:u,filters:l,setFilter:(e,t)=>{c(r=>({...r,[e]:t}))},filteredItems:f,debouncedSearchTerm:d,resetFilters:()=>{u(""),c({})}}}function d(e,t,r,o,a){(0,n.useEffect)(()=>{if(!e){r(!1);return}o||a||t||(r(!0),s.Z.log("\uD83D\uDD04 Activation de la d\xe9tection automatique USB"))},[e,t,r,o,a])}function f(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],[t,r]=(0,n.useState)(e),[o,a]=(0,n.useState)(null);return{isOpen:t,editingItem:o,openCreate:(0,n.useCallback)(()=>{a(null),r(!0)},[]),openEdit:(0,n.useCallback)(e=>{a(e),r(!0)},[]),close:(0,n.useCallback)(()=>{r(!1),a(null)},[]),setEditingItem:a,setIsOpen:r}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4,r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=(0,n.useRef)(e);(0,n.useEffect)(()=>{o.current=e},[e]),(0,n.useEffect)(()=>{if(!r||!o.current)return;let e=setInterval(()=>{o.current()},t);return()=>clearInterval(e)},[t,r])}function g(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=(0,n.useRef)(e);(0,n.useEffect)(()=>{r.current=e},[e]),(0,n.useEffect)(()=>{if(!t||!r.current)return;let e=()=>{r.current()},n=e=>{"ott-devices-last-update"===e.key&&r.current()};return window.addEventListener("ott-devices-updated",e),window.addEventListener("storage",n),()=>{window.removeEventListener("ott-devices-updated",e),window.removeEventListener("storage",n)}},[t])}function m(){let e=(0,n.useRef)([]);return(0,n.useEffect)(()=>()=>{e.current.forEach(e=>{"timeout"===e.type?clearTimeout(e.id):"interval"===e.type&&clearInterval(e.id)}),e.current=[]},[]),{createTimeout:(0,n.useCallback)((t,r)=>{let n=setTimeout(()=>{t(),e.current=e.current.filter(e=>e.id!==n)},r);return e.current.push({id:n,type:"timeout"}),n},[]),createInterval:(0,n.useCallback)((t,r)=>{let n=setInterval(t,r);return e.current.push({id:n,type:"interval"}),n},[]),clearAll:(0,n.useCallback)(()=>{e.current.forEach(e=>{"timeout"===e.type?clearTimeout(e.id):"interval"===e.type&&clearInterval(e.id)}),e.current=[]},[])}}},2617:function(e,t,r){r.d(t,{fetchJson:function(){return n}});async function n(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{let a;let s=await e("".concat(t).concat(r),n,o);if(!s.ok){let e={},t=s.headers.get("content-type");if(t&&t.includes("application/json"))try{let t=await s.text();t&&t.trim()&&(e=JSON.parse(t))}catch(e){}throw Error(e.error||"Erreur HTTP ".concat(s.status))}let u=s.headers.get("content-type");if(!u||!u.includes("application/json")){let e=await s.text();if(!e||!e.trim())throw Error("R\xe9ponse vide de l'endpoint ".concat(r));throw Error("R\xe9ponse non-JSON de l'endpoint ".concat(r,": ").concat(e.substring(0,100)))}let l=await s.text();if(!l||!l.trim())throw Error("R\xe9ponse JSON vide de l'endpoint ".concat(r));try{a=JSON.parse(l)}catch(e){throw Error("R\xe9ponse JSON invalide de l'endpoint ".concat(r,": ").concat(e.message))}if(!a.success)throw Error(a.error||"Erreur API");return a}catch(e){if(e instanceof Error)throw e;throw Error(e.message||"Erreur lors de l'appel API")}}},8828:function(e,t,r){r.d(t,{k:function(){return n}}),r(257);let n={log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error("[ERROR]",...t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]}};t.Z=n}}]);