(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5223],{2919:function(e,t,a){"use strict";var r=a(7437),s=a(2265),n=a(5506);t.Z=(0,s.memo)(function(e){let{value:t,onChange:a,placeholder:i="Rechercher...",className:l="",debounceMs:o=300,debounced:d=!1}=e,[c,m]=(0,s.useState)(t),u=(0,n.Nr)(c,o);return(0,s.useEffect)(()=>{m(t)},[t]),(0,s.useEffect)(()=>{d&&a(u)},[u,d,a]),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>{let t=e.target.value;m(t),d||a(t)},className:"input ".concat(l),placeholder:i})})},6601:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(7437),s=a(2265);function n(e){let{message:t,onClose:a=null,autoClose:n=5e3,className:i=""}=e;return((0,s.useEffect)(()=>{if(n&&a){let e=setTimeout(()=>{a()},n);return()=>clearTimeout(e)}},[n,a]),t)?(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg animate-slide-down ".concat(i),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"✅ Succ\xe8s"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:t})]}),a&&(0,r.jsx)("button",{onClick:a,className:"ml-4 text-green-700 hover:text-green-900 text-sm","aria-label":"Fermer",children:"✕"})]})}):null}},899:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var r=a(7437),s=a(2265),n=a(2617),i=a(9723),l=a(7062),o=a(8828);function d(e){let{title:t,children:a,defaultOpen:n=!1}=e,[i,l]=(0,s.useState)(n);return(0,r.jsxs)("div",{className:"border border-gray-200 dark:border-slate-700 rounded-lg",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>l(!i),className:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors",children:[(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:t}),(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:i?"▼":"▶"})]}),i&&(0,r.jsx)("div",{className:"px-4 pb-4 pt-2",children:a})]})}function c(e){var t;let{isOpen:a,onClose:c,editingItem:m,type:u,onSave:p,fetchWithAuth:_,API_URL:f,roles:h=[],currentUser:x=null}=e,[b,y]=(0,s.useState)({}),[g,v]=(0,s.useState)({}),[j,w]=(0,s.useState)(null),[N,k]=(0,s.useState)(!1),[C,D]=(0,s.useState)(!1),[S,T]=(0,s.useState)(!1),[E,q]=(0,s.useState)(!1),[A,L]=(0,s.useState)(""),[z,V]=(0,s.useState)({email_enabled:!0,sms_enabled:!0,push_enabled:"user"===u,notify_battery_low:!0,notify_device_offline:!0,notify_abnormal_flow:!0,notify_new_patient:"user"!==u&&!1,notify_alert_critical:"patient"===u}),[O,P]=(0,s.useState)({});(0,s.useEffect)(()=>{if(a){if(m){if("user"===u){var e;y({first_name:m.first_name||"",last_name:m.last_name||"",email:m.email||"",phone:m.phone||"",password:void 0,role_id:(null===(e=h.find(e=>e.name===m.role_name))||void 0===e?void 0:e.id)||"",is_active:!!m.is_active}),L("")}else y({first_name:m.first_name||"",last_name:m.last_name||"",birth_date:m.birth_date?m.birth_date.split("T")[0]:"",phone:m.phone||"",email:m.email||"",city:m.city||"",postal_code:m.postal_code||""});void 0!==m.email_enabled||void 0!==m.sms_enabled?V({email_enabled:!!m.email_enabled,sms_enabled:!!m.sms_enabled,push_enabled:!!m.push_enabled,notify_battery_low:!!m.notify_battery_low,notify_device_offline:!!m.notify_device_offline,notify_abnormal_flow:!!m.notify_abnormal_flow,notify_new_patient:!!m.notify_new_patient,notify_alert_critical:!!m.notify_alert_critical,phone_number:m.phone_number||"",quiet_hours_start:m.quiet_hours_start||"",quiet_hours_end:m.quiet_hours_end||""}):M()}else"user"===u?(y({first_name:"",last_name:"",email:"",phone:"",password:void 0,role_id:"",is_active:!0}),L("")):y({first_name:"",last_name:"",birth_date:"",phone:"",email:"",city:"",postal_code:""}),V({email_enabled:!1,sms_enabled:!1,push_enabled:!1,notify_battery_low:!1,notify_device_offline:!1,notify_abnormal_flow:!1,notify_new_patient:!1,notify_alert_critical:!1});v({}),w(null),P({}),T(!1),q(!1),L("")}},[a,m,u,h]);let M=async()=>{if(null==m?void 0:m.id)try{D(!0);let e="user"===u?"/api.php/users/".concat(m.id,"/notifications"):"/api.php/patients/".concat(m.id,"/notifications"),t=await (0,n.r)(_,f,e,{},{requiresAuth:!0});if(t.preferences){let e=Object.fromEntries(Object.entries(t.preferences).map(e=>{let[t,a]=e;return["email_enabled","sms_enabled","push_enabled","notify_battery_low","notify_device_offline","notify_abnormal_flow","notify_new_patient","notify_alert_critical"].includes(t)?[t,!!a]:[t,a]}));V(e)}}catch(e){o.Z.warn("Erreur chargement pr\xe9f\xe9rences:",e)}finally{D(!1)}},F=e=>{let{name:t,value:a,type:r,checked:s}=e.target;y({...b,[t]:"checkbox"===r?s:a}),g[t]&&v(e=>{let a={...e};return delete a[t],a}),"password"===t&&"user"===r&&(a&&a.length>0&&a.length<6?v(e=>({...e,password:"Le mot de passe doit contenir au moins 6 caract\xe8res"})):a&&a.length>=6?v(e=>{let t={...e};return delete t.password,A&&A!==a?t.passwordConfirm="Les mots de passe ne correspondent pas":delete t.passwordConfirm,t}):a||m?!a&&m&&v(e=>{let t={...e};return delete t.password,delete t.passwordConfirm,t}):v(e=>({...e,password:"Le mot de passe est obligatoire"}))),("email"===t||"phone"===t)&&(P(e=>{let r={...e};return"email"===t&&(0,l.vV)(a)&&r.email&&delete r.email,"phone"===t&&a&&(0,l.kj)(a)&&r.sms&&delete r.sms,r}),V(e=>{let s={...e};return"email"===t?(0,l.vV)(a)||!e.email_enabled||(s.email_enabled=!1,s.sms_enabled||s.push_enabled||(s.notify_battery_low=!1,s.notify_device_offline=!1,s.notify_abnormal_flow=!1,"user"===r?s.notify_new_patient=!1:s.notify_alert_critical=!1)):"phone"!==t||a&&(0,l.kj)(a)||!e.sms_enabled||(s.sms_enabled=!1,s.email_enabled||s.push_enabled||(s.notify_battery_low=!1,s.notify_device_offline=!1,s.notify_abnormal_flow=!1,"user"===r?s.notify_new_patient=!1:s.notify_alert_critical=!1)),s}))},Z=()=>{let e={};return(!b.first_name||b.first_name.trim().length<2)&&(e.first_name="Le pr\xe9nom doit contenir au moins 2 caract\xe8res"),(!b.last_name||b.last_name.trim().length<2)&&(e.last_name="Le nom doit contenir au moins 2 caract\xe8res"),"user"!==u||(b.email&&/\S+@\S+\.\S+/.test(b.email)||(e.email="Format d'email invalide"),m||b.password&&!(b.password.length<6)||(e.password="Le mot de passe doit contenir au moins 6 caract\xe8res"),"user"===u&&m&&x&&m.id===x.id&&!1===b.is_active&&(e.is_active="Vous ne pouvez pas d\xe9sactiver votre propre compte"),b.password&&b.password.length>=6&&(m||A&&A===b.password||(e.passwordConfirm="Les mots de passe ne correspondent pas"),m&&A&&A!==b.password&&(e.passwordConfirm="Les mots de passe ne correspondent pas"),m&&b.password&&b.password.length>0&&!A&&(e.passwordConfirm="Veuillez confirmer le mot de passe")),b.role_id||(e.role_id="Le r\xf4le est obligatoire")),"patient"===u&&b.postal_code&&!/^\d{5}$/.test(b.postal_code.trim())&&(e.postal_code="Le code postal doit contenir 5 chiffres"),v(e),0===Object.keys(e).length},J=async e=>{if(e.preventDefault(),!Z()){w("Veuillez corriger les erreurs dans le formulaire");return}k(!0),w(null);try{var t,a,r,s,i,l,d,h,y,g,v,j,N,C,D,S;if(m){let e="user"===u?"/api.php/users/".concat(m.id):"/api.php/patients/".concat(m.id),o="user"===u?{first_name:b.first_name.trim(),last_name:b.last_name.trim(),email:b.email.trim(),role_id:b.role_id?parseInt(b.role_id,10):void 0,is_active:!!m&&!!x&&m.id===x.id||void 0===b.is_active||null===b.is_active||!!b.is_active,phone:b.phone&&b.phone.trim().length>0?b.phone.trim():null}:{first_name:b.first_name.trim(),last_name:b.last_name.trim(),birth_date:b.birth_date||null,phone:b.phone&&b.phone.trim().length>0?b.phone.trim():null,email:b.email&&b.email.trim().length>0?b.email.trim():null,city:b.city&&b.city.trim().length>0?b.city.trim():null,postal_code:b.postal_code&&b.postal_code.trim().length>0?b.postal_code.trim():null};"user"===u&&b.password&&b.password.trim().length>=6&&(o.password=b.password.trim()),await (0,n.r)(_,f,e,{method:"PUT",body:JSON.stringify(o)},{requiresAuth:!0});let c="user"===u?"/api.php/users/".concat(m.id,"/notifications"):"/api.php/patients/".concat(m.id,"/notifications"),p={email_enabled:!!(null!==(t=z.email_enabled)&&void 0!==t&&t),sms_enabled:!!(null!==(a=z.sms_enabled)&&void 0!==a&&a),push_enabled:!!(null!==(r=z.push_enabled)&&void 0!==r&&r),notify_battery_low:!!(null!==(s=z.notify_battery_low)&&void 0!==s&&s),notify_device_offline:!!(null!==(i=z.notify_device_offline)&&void 0!==i&&i),notify_abnormal_flow:!!(null!==(l=z.notify_abnormal_flow)&&void 0!==l&&l)},y=b.phone&&"string"==typeof b.phone?b.phone.trim():null,g=z.phone_number&&"string"==typeof z.phone_number?z.phone_number.trim():null,v=y||g;v&&v.length>0&&(p.phone_number=v),"user"===u?p.notify_new_patient=!!(null!==(d=z.notify_new_patient)&&void 0!==d&&d):p.notify_alert_critical=!!(null!==(h=z.notify_alert_critical)&&void 0!==h&&h),await (0,n.r)(_,f,c,{method:"PUT",body:JSON.stringify(p)},{requiresAuth:!0})}else{let e="user"===u?{first_name:b.first_name.trim(),last_name:b.last_name.trim(),email:b.email.trim(),password:b.password.trim(),role_id:parseInt(b.role_id,10),is_active:void 0===b.is_active||null===b.is_active||!!b.is_active,phone:b.phone&&b.phone.trim().length>0?b.phone.trim():null}:{first_name:b.first_name.trim(),last_name:b.last_name.trim(),birth_date:b.birth_date||null,phone:b.phone&&b.phone.trim().length>0?b.phone.trim():null,email:b.email&&b.email.trim().length>0?b.email.trim():null,city:b.city&&b.city.trim().length>0?b.city.trim():null,postal_code:b.postal_code&&b.postal_code.trim().length>0?b.postal_code.trim():null},t=await (0,n.r)(_,f,"user"===u?"/api.php/users":"/api.php/patients",{method:"POST",body:JSON.stringify(e)},{requiresAuth:!0});if(t.user_id||t.patient_id){let e=t.user_id||t.patient_id,a={email_enabled:!!(null!==(y=z.email_enabled)&&void 0!==y&&y),sms_enabled:!!(null!==(g=z.sms_enabled)&&void 0!==g&&g),push_enabled:!!(null!==(v=z.push_enabled)&&void 0!==v&&v),notify_battery_low:!!(null!==(j=z.notify_battery_low)&&void 0!==j&&j),notify_device_offline:!!(null!==(N=z.notify_device_offline)&&void 0!==N&&N),notify_abnormal_flow:!!(null!==(C=z.notify_abnormal_flow)&&void 0!==C&&C)},r=b.phone&&"string"==typeof b.phone?b.phone.trim():null,s=z.phone_number&&"string"==typeof z.phone_number?z.phone_number.trim():null,i=r||s;i&&i.length>0&&(a.phone_number=i),"user"===u?a.notify_new_patient=!!(null!==(D=z.notify_new_patient)&&void 0!==D&&D):a.notify_alert_critical=!!(null!==(S=z.notify_alert_critical)&&void 0!==S&&S),await (0,n.r)(_,f,"user"===u?"/api.php/users/".concat(e,"/notifications"):"/api.php/patients/".concat(e,"/notifications"),{method:"PUT",body:JSON.stringify(a)},{requiresAuth:!0})}}p(),c()}catch(t){let e=t.message||"Erreur lors de l'enregistrement";t.error&&(e=t.error),w(e),o.Z.error("Erreur enregistrement:",t)}finally{k(!1)}};return a?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/60 z-[100] flex items-center justify-center p-4 overflow-y-auto backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-2xl p-6 space-y-4 my-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:m?"Modifier le ".concat("user"===u?"utilisateur":"patient"):"Nouveau ".concat("user"===u?"utilisateur":"patient")}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:m?m.email||"".concat(m.first_name," ").concat(m.last_name):"Cr\xe9er un ".concat("user"===u?"acc\xe8s avec un r\xf4le d\xe9fini":"nouveau patient")})]}),(0,r.jsx)("button",{onClick:c,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:"Fermer","aria-label":"Fermer",disabled:N,children:(0,r.jsx)("span",{className:"text-2xl font-bold leading-none",children:"\xd7"})})]}),(0,r.jsxs)("form",{className:"space-y-4",onSubmit:J,children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Pr\xe9nom *",(0,r.jsx)("input",{type:"text",name:"first_name",value:b.first_name||"",onChange:F,className:"input mt-1 ".concat(g.first_name?"border-red-500 focus:border-red-500 focus:ring-red-500/50":""),required:!0})]}),g.first_name&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.first_name})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Nom *",(0,r.jsx)("input",{type:"text",name:"last_name",value:b.last_name||"",onChange:F,className:"input mt-1 ".concat(g.last_name?"border-red-500 focus:border-red-500 focus:ring-red-500/50":""),required:!0})]}),g.last_name&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.last_name})]})]}),"user"===u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-full",children:["Email *",(0,r.jsx)("input",{type:"email",name:"email",value:b.email||"",onChange:F,className:"input mt-1 ".concat(g.email?"border-red-500 focus:border-red-500 focus:ring-red-500/50":""),required:!0})]}),g.email&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-full",children:["R\xf4le *",(0,r.jsxs)("select",{name:"role_id",value:b.role_id||"",onChange:F,className:"input mt-1 ".concat(g.role_id?"border-red-500 focus:border-red-500 focus:ring-red-500/50":""),required:!0,children:[(0,r.jsx)("option",{value:"",children:"Choisir un r\xf4le…"}),h.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),g.role_id&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.role_id})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-full",children:[m?"Nouveau mot de passe":"Mot de passe *",(0,r.jsxs)("div",{className:"relative mt-1",children:[(0,r.jsx)("input",{type:S?"text":"password",name:"password",value:null!==(t=b.password)&&void 0!==t?t:"",onChange:F,placeholder:m?"Optionnel, 6+ caract\xe8res":"6+ caract\xe8res",className:"input pr-10 ".concat(g.password?"border-red-500 focus:border-red-500 focus:ring-red-500/50":""),required:!m,minLength:6,autoComplete:"new-password","data-form-type":"other","data-lpignore":"true","data-1p-ignore":"true"}),(0,r.jsx)("button",{type:"button",onClick:()=>T(!S),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:S?"Masquer le mot de passe":"Afficher le mot de passe",children:S?"\uD83D\uDC41️":"\uD83D\uDC41️‍\uD83D\uDDE8️"})]})]}),g.password&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.password})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-full",children:[m?"Confirmer le nouveau mot de passe":"Confirmer le mot de passe *",(0,r.jsxs)("div",{className:"relative mt-1",children:[(0,r.jsx)("input",{type:E?"text":"password",value:A,onChange:e=>{let t=e.target.value;L(t),b.password&&t!==b.password?v(e=>({...e,passwordConfirm:"Les mots de passe ne correspondent pas"})):v(e=>{let t={...e};return delete t.passwordConfirm,t})},placeholder:m?"Optionnel, 6+ caract\xe8res":"6+ caract\xe8res",className:"input pr-10 ".concat(g.passwordConfirm?"border-red-500 focus:border-red-500 focus:ring-red-500/50":""),required:!m||m&&b.password&&b.password.length>0,minLength:6,autoComplete:"new-password","data-form-type":"other","data-lpignore":"true","data-1p-ignore":"true"}),(0,r.jsx)("button",{type:"button",onClick:()=>q(!E),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:E?"Masquer le mot de passe":"Afficher le mot de passe",children:E?"\uD83D\uDC41️":"\uD83D\uDC41️‍\uD83D\uDDE8️"})]})]}),g.passwordConfirm&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.passwordConfirm})]})]})]}),"patient"===u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Email",(0,r.jsx)("input",{type:"email",name:"email",value:b.email||"",onChange:F,className:"input mt-1"})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["T\xe9l\xe9phone",(0,r.jsx)("input",{type:"tel",name:"phone",value:b.phone||"",onChange:F,className:"input mt-1",placeholder:"+33..."})]})})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Date de naissance",(0,r.jsx)("input",{type:"date",name:"birth_date",value:b.birth_date||"",onChange:F,className:"input mt-1"})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Code postal",(0,r.jsx)("input",{type:"text",name:"postal_code",value:b.postal_code||"",onChange:F,className:"input mt-1 ".concat(g.postal_code?"border-red-500 focus:border-red-500 focus:ring-red-500/50":"")})]}),g.postal_code&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:g.postal_code})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Ville",(0,r.jsx)("input",{type:"text",name:"city",value:b.city||"",onChange:F,className:"input mt-1"})]})})]})]}),"user"===u&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-full",children:["T\xe9l\xe9phone (optionnel, pour SMS)",(0,r.jsx)("input",{type:"tel",name:"phone",value:b.phone||"",onChange:F,className:"input mt-1",placeholder:"+33612345678"})]})}),(0,r.jsxs)("div",{className:"flex items-end",children:[(0,r.jsxs)("label",{className:"flex items-center gap-3 text-sm font-medium text-gray-700 dark:text-gray-300 w-full",children:[(0,r.jsx)("input",{type:"checkbox",name:"is_active",checked:void 0===b.is_active||b.is_active,onChange:F,disabled:m&&x&&m.id===x.id,className:"form-checkbox h-4 w-4 text-primary-600 dark:text-primary-400 disabled:opacity-50 disabled:cursor-not-allowed"}),(0,r.jsxs)("span",{className:m&&x&&m.id===x.id?"opacity-50":"",children:["Compte actif",m&&x&&m.id===x.id&&(0,r.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(Vous ne pouvez pas d\xe9sactiver votre propre compte)"})]})]}),g.is_active&&(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1 ml-4",children:g.is_active})]})]}),(0,r.jsx)(i.Z,{error:j,onClose:()=>w(null)}),(0,r.jsx)(d,{title:"\uD83D\uDCE7 Notifications",defaultOpen:!!m,children:m&&C?(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Chargement des pr\xe9f\xe9rences..."}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Canaux activ\xe9s"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 p-2 rounded transition-colors ".concat(z.email_enabled&&(0,l.vV)(b.email)?"bg-blue-100 border-2 border-blue-500 text-blue-900 font-semibold":(0,l.vV)(b.email)?"bg-gray-50 border border-gray-200":"bg-gray-100 opacity-50 border border-gray-200"),children:[(0,r.jsx)("input",{type:"checkbox",checked:z.email_enabled,onChange:e=>{let t=e.target.checked;if(t&&!(0,l.vV)(b.email)){P(e=>({...e,email:"Email valide requis pour activer les notifications email"}));return}P(e=>{let t={...e};return delete t.email,delete t.alerts,t});let a={...z,email_enabled:t};t||a.sms_enabled||a.push_enabled||(a.notify_battery_low=!1,a.notify_device_offline=!1,a.notify_abnormal_flow=!1,"user"===u?a.notify_new_patient=!1:a.notify_alert_critical=!1),V(a)},disabled:!(0,l.vV)(b.email),className:"form-checkbox"}),(0,r.jsx)("span",{className:"text-sm",children:"✉️ Email"})]}),!(0,l.vV)(b.email)&&(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-8",children:"Saisissez un email valide pour activer les notifications email"}),O.email&&(0,r.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 ml-8",children:O.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 p-2 rounded transition-colors ".concat(z.sms_enabled&&b.phone&&(0,l.kj)(b.phone)?"bg-blue-100 border-2 border-blue-500 text-blue-900 font-semibold":b.phone&&(0,l.kj)(b.phone)?"bg-gray-50 border border-gray-200":"bg-gray-100 opacity-50 border border-gray-200"),children:[(0,r.jsx)("input",{type:"checkbox",checked:!!z.sms_enabled,onChange:e=>{let t=e.target.checked;if(t&&(!b.phone||!(0,l.kj)(b.phone))){P(e=>({...e,sms:"T\xe9l\xe9phone valide requis pour activer les notifications SMS"}));return}P(e=>{let t={...e};return delete t.sms,delete t.alerts,t});let a={...z,sms_enabled:t};t||a.email_enabled||a.push_enabled||(a.notify_battery_low=!1,a.notify_device_offline=!1,a.notify_abnormal_flow=!1,"user"===u?a.notify_new_patient=!1:a.notify_alert_critical=!1),V(a)},disabled:!b.phone||!(0,l.kj)(b.phone),className:"form-checkbox"}),(0,r.jsx)("span",{className:"text-sm",children:"\uD83D\uDCF1 SMS"})]}),(!b.phone||!(0,l.kj)(b.phone))&&(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-8",children:"Saisissez un num\xe9ro de t\xe9l\xe9phone valide pour activer les notifications SMS"}),O.sms&&(0,r.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 ml-8",children:O.sms})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 p-2 rounded transition-colors ".concat(z.push_enabled?"bg-blue-100 border-2 border-blue-500 text-blue-900 font-semibold":"bg-gray-50 border border-gray-200"),children:[(0,r.jsx)("input",{type:"checkbox",checked:z.push_enabled,onChange:async e=>{let t=e.target.checked;if(t){if(!("Notification"in window)){P(e=>({...e,push:"Votre navigateur ne supporte pas les notifications push"}));return}if(!("serviceWorker"in navigator)){P(e=>({...e,push:"Service Worker non disponible (n\xe9cessite HTTPS)"}));return}if("denied"===Notification.permission){P(e=>({...e,push:"Notifications push refus\xe9es. Autorisez-les dans les param\xe8tres du navigateur."}));return}if("default"===Notification.permission)try{let e=await Notification.requestPermission();if("granted"!==e){P(e=>({...e,push:"Permission de notification refus\xe9e"}));return}}catch(e){P(e=>({...e,push:"Erreur lors de la demande de permission"}));return}}P(e=>{let t={...e};return delete t.push,delete t.alerts,t});let a={...z,push_enabled:t};t||a.email_enabled||a.sms_enabled||(a.notify_battery_low=!1,a.notify_device_offline=!1,a.notify_abnormal_flow=!1,"user"===u?a.notify_new_patient=!1:a.notify_alert_critical=!1),V(a)},className:"form-checkbox"}),(0,r.jsx)("span",{className:"text-sm",children:"\uD83D\uDD14 Push"}),(!("Notification"in window)||!("serviceWorker"in navigator))&&(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"(non support\xe9)"})]}),O.push&&(0,r.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 ml-8",children:O.push})]})]}),(z.email_enabled||z.sms_enabled||z.push_enabled)&&!z.notify_battery_low&&!z.notify_device_offline&&!z.notify_abnormal_flow&&!("user"===u?z.notify_new_patient:z.notify_alert_critical)&&(0,r.jsx)("div",{className:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,r.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["⚠️ ",(0,r.jsx)("strong",{children:"Important :"})," Vous avez activ\xe9 un canal de notification (Email/SMS/Push), mais aucun type d'alerte n'est activ\xe9. Activez au moins un type d'alerte ci-dessous pour recevoir des notifications, sinon cela ne servira \xe0 rien."]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Types d'alertes",!z.email_enabled&&!z.sms_enabled&&!z.push_enabled&&(0,r.jsx)("span",{className:"text-xs text-red-600 dark:text-red-400 ml-2",children:"⚠️ Activez au moins un service (Email/SMS/Push) pour activer les alertes"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm ".concat(z.email_enabled||z.sms_enabled||z.push_enabled?"":"opacity-50"),children:[(0,r.jsx)("input",{type:"checkbox",checked:!!z.notify_battery_low,disabled:!z.email_enabled&&!z.sms_enabled&&!z.push_enabled,onChange:e=>{if(!z.email_enabled&&!z.sms_enabled&&!z.push_enabled){P(e=>({...e,alerts:"Activez au moins un service de notification pour activer les alertes"}));return}P(e=>{let t={...e};return delete t.alerts,t}),V(t=>({...t,notify_battery_low:e.target.checked}))},className:"form-checkbox"}),"\uD83D\uDD0B Batterie faible"]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm ".concat(z.email_enabled||z.sms_enabled||z.push_enabled?"":"opacity-50"),children:[(0,r.jsx)("input",{type:"checkbox",checked:!!z.notify_device_offline,disabled:!z.email_enabled&&!z.sms_enabled&&!z.push_enabled,onChange:e=>{if(!z.email_enabled&&!z.sms_enabled&&!z.push_enabled){P(e=>({...e,alerts:"Activez au moins un service de notification pour activer les alertes"}));return}P(e=>{let t={...e};return delete t.alerts,t}),V(t=>({...t,notify_device_offline:e.target.checked}))},className:"form-checkbox"}),"\uD83D\uDCF4 Dispositif hors ligne"]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm ".concat(z.email_enabled||z.sms_enabled||z.push_enabled?"":"opacity-50"),children:[(0,r.jsx)("input",{type:"checkbox",checked:!!z.notify_abnormal_flow,disabled:!z.email_enabled&&!z.sms_enabled&&!z.push_enabled,onChange:e=>{if(!z.email_enabled&&!z.sms_enabled&&!z.push_enabled){P(e=>({...e,alerts:"Activez au moins un service de notification pour activer les alertes"}));return}P(e=>{let t={...e};return delete t.alerts,t}),V(t=>({...t,notify_abnormal_flow:e.target.checked}))},className:"form-checkbox"}),"⚠️ D\xe9bit anormal"]}),"user"===u?(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm ".concat(z.email_enabled||z.sms_enabled||z.push_enabled?"":"opacity-50"),children:[(0,r.jsx)("input",{type:"checkbox",checked:!!z.notify_new_patient,disabled:!z.email_enabled&&!z.sms_enabled&&!z.push_enabled,onChange:e=>{if(!z.email_enabled&&!z.sms_enabled&&!z.push_enabled){P(e=>({...e,alerts:"Activez au moins un service de notification pour activer les alertes"}));return}P(e=>{let t={...e};return delete t.alerts,t}),V(t=>({...t,notify_new_patient:e.target.checked}))},className:"form-checkbox"}),"\uD83D\uDC64 Nouveau patient"]}):(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm ".concat(z.email_enabled||z.sms_enabled||z.push_enabled?"":"opacity-50"),children:[(0,r.jsx)("input",{type:"checkbox",checked:!!z.notify_alert_critical,disabled:!z.email_enabled&&!z.sms_enabled&&!z.push_enabled,onChange:e=>{if(!z.email_enabled&&!z.sms_enabled&&!z.push_enabled){P(e=>({...e,alerts:"Activez au moins un service de notification pour activer les alertes"}));return}P(e=>{let t={...e};return delete t.alerts,t}),V(t=>({...t,notify_alert_critical:e.target.checked}))},className:"form-checkbox"}),"\uD83D\uDEA8 Alerte critique"]})]}),O.alerts&&(0,r.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mt-2",children:O.alerts})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-2",children:[(0,r.jsx)("button",{type:"button",className:"btn-secondary",onClick:c,disabled:N,children:"Annuler"}),(0,r.jsx)("button",{type:"submit",className:"btn-primary",disabled:N,children:N?m?"Enregistrement…":"Cr\xe9ation…":m?"Enregistrer":"Cr\xe9er"})]})]})]})}):null}},7062:function(e,t,a){"use strict";a.d(t,{kj:function(){return n},vV:function(){return s},wE:function(){return r}});let r=e=>(e.startsWith("/")||(e="/".concat(e)),"".concat("/OTT").concat(e)),s=e=>/\S+@\S+\.\S+/.test(e||""),n=e=>{if(!e)return!0;let t=e.replace(/\s/g,"");return/^(\+33|0)[1-9](\d{2}){4}$/.test(t)}},257:function(e,t,a){"use strict";var r,s;e.exports=(null==(r=a.g.process)?void 0:r.env)&&"object"==typeof(null==(s=a.g.process)?void 0:s.env)?a.g.process:a(4227)},4227:function(e){!function(){var t={229:function(e){var t,a,r,s=e.exports={};function n(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var o=[],d=!1,c=-1;function m(){d&&r&&(d=!1,r.length?o=r.concat(o):c=-1,o.length&&u())}function u(){if(!d){var e=l(m);d=!0;for(var t=o.length;t;){for(r=o,o=[];++c<t;)r&&r[c].run();c=-1,t=o.length}r=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function _(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];o.push(new p(e,t)),1!==o.length||d||l(u)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=_,s.addListener=_,s.once=_,s.off=_,s.removeListener=_,s.removeAllListeners=_,s.emit=_,s.prependListener=_,s.prependOnceListener=_,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},a={};function r(e){var s=a[e];if(void 0!==s)return s.exports;var n=a[e]={exports:{}},i=!0;try{t[e](n,n.exports,r),i=!1}finally{i&&delete a[e]}return n.exports}r.ab="//";var s=r(229);e.exports=s}()}}]);