# SchÃ©ma Textuel de la Logique APN - Firmware OTT

## Vue d'ensemble simplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DÃ‰MARRAGE FIRMWARE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   loadConfig()       â”‚
              â”‚ Charge APN depuis NVSâ”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                         â”‚
            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ APN en NVS ?  â”‚        â”‚ APN en NVS ?  â”‚
    â”‚     OUI       â”‚        â”‚     NON       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â–¼                        â–¼
    apnLoadedFromNVS        apnLoadedFromNVS
    = true                  = false
    NETWORK_APN             NETWORK_APN
    = APN_NVS               = OTT_DEFAULT_APN
            â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   startModem()       â”‚
              â”‚  Initialisation      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   apnManual = true ?   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OUI         â”‚        â”‚   NON         â”‚
â”‚               â”‚        â”‚               â”‚
â”‚ ğŸ”’ NIVEAU 1   â”‚        â”‚   apnLoaded   â”‚
â”‚ APN MANUEL    â”‚        â”‚   FromNVS ?   â”‚
â”‚               â”‚        â”‚               â”‚
â”‚ CONSERVER     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ NETWORK_APN   â”‚                â”‚
â”‚ JAMAIS        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ modifier      â”‚    â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â–¼                       â–¼
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚     OUI       â”‚      â”‚     NON       â”‚
        â”‚    â”‚               â”‚      â”‚               â”‚
        â”‚    â”‚ ğŸ”’ NIVEAU 2   â”‚      â”‚ ğŸ” NIVEAU 3   â”‚
        â”‚    â”‚ APN SAUVEGARDÃ‰â”‚      â”‚ DÃ‰TECTION AUTOâ”‚
        â”‚    â”‚               â”‚      â”‚               â”‚
        â”‚    â”‚ CONSERVER     â”‚      â”‚ DÃ©tecter      â”‚
        â”‚    â”‚ SAUF si       â”‚      â”‚ opÃ©rateur/SIM â”‚
        â”‚    â”‚ changement    â”‚      â”‚               â”‚
        â”‚    â”‚ opÃ©rateur     â”‚      â”‚ Utiliser APN  â”‚
        â”‚    â”‚               â”‚      â”‚ recommandÃ©    â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Utiliser APN       â”‚
                    â”‚   (apnToUse)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ attachNetworkWith    â”‚
                    â”‚ Retry()              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   REG_DENIED ?       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
                â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     OUI       â”‚        â”‚     NON       â”‚
        â”‚               â”‚        â”‚               â”‚
        â”‚ apnManual ?   â”‚        â”‚  Continuer    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  normalement  â”‚
                â”‚                â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚                â”‚
        â–¼               â–¼                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   OUI     â”‚   â”‚     NON      â”‚       â”‚
â”‚           â”‚   â”‚              â”‚       â”‚
â”‚ ğŸ”’ NE PAS â”‚   â”‚ ğŸ”§ Corriger  â”‚       â”‚
â”‚ corriger  â”‚   â”‚ APN si       â”‚       â”‚
â”‚           â”‚   â”‚ nÃ©cessaire   â”‚       â”‚
â”‚ Logger    â”‚   â”‚              â”‚       â”‚
â”‚ erreur    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚                â”‚
      â”‚                â–¼                â”‚
      â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
      â”‚       â”‚ Nouvelle     â”‚         â”‚
      â”‚       â”‚ tentative    â”‚         â”‚
      â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
      â”‚              â”‚                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   connectData()      â”‚
          â”‚   Connexion GPRS     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ saveNetworkParams()  â”‚
          â”‚ Sauvegarder en NVS   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Fonctionnement      â”‚
          â”‚  normal              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Les 3 niveaux de prioritÃ© (vue dÃ©taillÃ©e)

### ğŸ”’ NIVEAU 1 : APN MANUEL (prioritÃ© absolue)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚                    apnManual = true                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  CONSERVER NETWORK_APN tel quel                       â”‚ â”‚
â”‚  â”‚  JAMAIS modifier                                      â”‚ â”‚
â”‚  â”‚  JAMAIS dÃ©tection automatique                         â”‚ â”‚
â”‚  â”‚  JAMAIS correction REG_DENIED                         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Cas d'usage :                                        â”‚ â”‚
â”‚  â”‚  - Configuration via USB/OTA                          â”‚ â”‚
â”‚  â”‚  - APN personnalisÃ© requis                            â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Exemple :**
- Utilisateur configure "free" via USB
- apnManual = true
- OpÃ©rateur dÃ©tectÃ© = Orange â†’ **Conserver "free"**
- REG_DENIED avec "free" â†’ **NE PAS corriger automatiquement**

---

### ğŸ”’ NIVEAU 2 : APN SAUVEGARDÃ‰ EN NVS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚        apnManual = false                                    â”‚
â”‚        apnLoadedFromNVS = true                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  CONSERVER NETWORK_APN sauvegardÃ©                    â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  SAUF si changement d'opÃ©rateur dÃ©tectÃ©              â”‚ â”‚
â”‚  â”‚  (indique changement de carte SIM)                   â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Si changement d'opÃ©rateur :                         â”‚ â”‚
â”‚  â”‚    â†’ DÃ©tecter nouveau opÃ©rateur                      â”‚ â”‚
â”‚  â”‚    â†’ Utiliser son APN recommandÃ©                     â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Exemple 1 :** (Conservation)
- APN "free" sauvegardÃ© en NVS
- OpÃ©rateur sauvegardÃ© = Orange
- OpÃ©rateur actuel = Orange â†’ **Conserver "free"**

**Exemple 2 :** (Changement)
- APN "orange" sauvegardÃ© en NVS
- OpÃ©rateur sauvegardÃ© = Orange
- OpÃ©rateur actuel = Free (diffÃ©rent) â†’ **Utiliser "free"**

---

### ğŸ” NIVEAU 3 : DÃ‰TECTION AUTOMATIQUE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚        apnManual = false                                    â”‚
â”‚        apnLoadedFromNVS = false                             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  DÃ‰TECTION AUTOMATIQUE                                â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Ordre de prioritÃ© :                                  â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  1. Carte SIM dÃ©tectÃ©e                                â”‚ â”‚
â”‚  â”‚     â†’ Utiliser APN de la carte SIM                   â”‚ â”‚
â”‚  â”‚     (mÃªme en roaming)                                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  2. OpÃ©rateur rÃ©seau dÃ©tectÃ©                          â”‚ â”‚
â”‚  â”‚     â†’ Utiliser APN recommandÃ© pour cet opÃ©rateur     â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  3. Aucune dÃ©tection                                  â”‚ â”‚
â”‚  â”‚     â†’ Utiliser APN par dÃ©faut (OTT_DEFAULT_APN)     â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Exemple :**
- Boot premier flash (NVS vide)
- Carte SIM = Free, RÃ©seau = Orange (roaming)
- â†’ Utiliser "free" (APN de la carte SIM, pas du rÃ©seau)

---

## Matrice de dÃ©cision

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MATRICE DE DÃ‰CISION                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Situation              â”‚ apn  â”‚ apn  â”‚ OpÃ©rateur â”‚ Action              â”‚
â”‚                         â”‚Manualâ”‚Loadedâ”‚ dÃ©tectÃ©   â”‚                     â”‚
â”‚                         â”‚      â”‚NVS   â”‚           â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Boot premier flash      â”‚false â”‚false â”‚ Orange    â”‚ â†’ "orange"         â”‚
â”‚ Boot premier flash      â”‚false â”‚false â”‚ Free      â”‚ â†’ "free"           â”‚
â”‚ APN manuel "free"       â”‚TRUE  â”‚true  â”‚ Orange    â”‚ â†’ "free" ğŸ”’        â”‚
â”‚ APN auto "orange"       â”‚false â”‚TRUE  â”‚ Orange    â”‚ â†’ "orange"         â”‚
â”‚ APN auto "free"         â”‚false â”‚TRUE  â”‚ Orange    â”‚ â†’ "free" ğŸ”’        â”‚
â”‚ Changement SIM          â”‚false â”‚true  â”‚ Free      â”‚ â†’ "free"           â”‚
â”‚ Changement SIM          â”‚TRUE  â”‚true  â”‚ Free      â”‚ â†’ APN manuel ğŸ”’    â”‚
â”‚ REG_DENIED manuel       â”‚TRUE  â”‚true  â”‚ -         â”‚ â†’ NE PAS corriger  â”‚
â”‚ REG_DENIED auto         â”‚false â”‚true  â”‚ Orange    â”‚ â†’ Corriger si nÃ©c. â”‚
â”‚ Roaming (Free/Orange)   â”‚false â”‚false â”‚ Orange    â”‚ â†’ "free" (SIM)     â”‚
â”‚                         â”‚      â”‚      â”‚           â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Points d'entrÃ©e de modification APN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              POINTS D'ENTRÃ‰E DE MODIFICATION APN               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. loadConfig()                                                â”‚
â”‚     â””â”€ Charge depuis NVS ou valeur par dÃ©faut                  â”‚
â”‚        âš¡ DÃ©finit apnLoadedFromNVS                              â”‚
â”‚                                                                 â”‚
â”‚  2. startModem()                                                â”‚
â”‚     â””â”€ DÃ©tection auto opÃ©rateur/SIM                            â”‚
â”‚        âš ï¸ Peut modifier APN (si apnManual=false)              â”‚
â”‚                                                                 â”‚
â”‚  3. attachNetworkWithRetry()                                   â”‚
â”‚     â””â”€ Correction si REG_DENIED                                â”‚
â”‚        âš ï¸ Peut modifier APN (si apnManual=false)              â”‚
â”‚        âœ… VÃ©rifie apnManual avant correction                   â”‚
â”‚                                                                 â”‚
â”‚  4. connectData()                                               â”‚
â”‚     â””â”€ Liste fallback APN                                      â”‚
â”‚        âœ… Ne modifie pas NETWORK_APN                           â”‚
â”‚                                                                 â”‚
â”‚  5. UPDATE_CONFIG (USB/OTA)                                    â”‚
â”‚     â””â”€ Configuration manuelle                                  â”‚
â”‚        âš¡ DÃ©finit apnManual = true                              â”‚
â”‚                                                                 â”‚
â”‚  6. RESET_CONFIG                                               â”‚
â”‚     â””â”€ RÃ©initialisation                                        â”‚
â”‚        âš¡ DÃ©finit apnManual = false                             â”‚
â”‚                                                                 â”‚
â”‚  7. saveNetworkParams()                                        â”‚
â”‚     â””â”€ Sauvegarde opÃ©rateur/APN dÃ©tectÃ©s                       â”‚
â”‚        âš ï¸ Peut modifier APN (si apnManual=false)              â”‚
â”‚        âœ… DÃ©tecte changement d'opÃ©rateur                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## RÃ¨gle d'or

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘  "Si l'utilisateur a configurÃ© un APN                        â•‘
â•‘   (manuellement ou via NVS),                                  â•‘
â•‘   le conserver sauf changement explicite                      â•‘
â•‘   de carte SIM ET apnManual=false"                            â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```
