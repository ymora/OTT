# ================================================================================
# Configuration Render - OTT API Backend
# ================================================================================
# HAPPLYZ MEDICAL SAS
# Configuration pour d√©ploiement sur Render.com
# ================================================================================

services:
  - type: web
    name: ott-api
    env: php
    buildCommand: |
      # ‚ö†Ô∏è CRITIQUE: arduino-cli est OBLIGATOIRE - la compilation ne doit JAMAIS √™tre simul√©e
      echo "üîß Installation d'arduino-cli (OBLIGATOIRE)..."
      bash scripts/install_arduino_cli.sh
      # V√©rifier que arduino-cli est disponible et fonctionnel
      if ! command -v arduino-cli &> /dev/null; then
        echo "‚ùå ERREUR CRITIQUE: arduino-cli n'est pas disponible apr√®s installation"
        echo "‚ùå Le build est interrompu - la compilation ne peut pas √™tre simul√©e"
        exit 1
      fi
      # V√©rifier que arduino-cli fonctionne
      if ! arduino-cli version &> /dev/null; then
        echo "‚ùå ERREUR CRITIQUE: arduino-cli est install√© mais ne fonctionne pas"
        exit 1
      fi
      echo "‚úÖ arduino-cli disponible et fonctionnel: $(arduino-cli version)"
      echo "‚úÖ La compilation sera R√âELLE, jamais simul√©e"
    startCommand: php -S 0.0.0.0:$PORT -t .
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: SENDGRID_API_KEY
        sync: false
      - key: SENDGRID_FROM_EMAIL
        sync: false
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false
      - key: TWILIO_FROM_NUMBER
        sync: false

